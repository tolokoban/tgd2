/**
 * Warning! This code has been generated automatically.
 */
import React from "react"
import { ViewButton } from "@tolokoban/ui"
import CodeViewer from "@/components/demo/CodeViewer"
import Demo from "./painter-stars.demo"

const FOCUS = {"Detail #1":"function init(ctx: TgdContext) {\n\tnew TgdControllerCameraOrbit(ctx, {\n\t\tinertiaOrbit: 1000,\n\t})\n\tctx.add(new TgdPainterClear(ctx, { color: [0, 0, 0, 1] }))\n\tctx.paint()\n\ttgdLoadArrayBuffer(dataURL).then((buff) => {\n\t\tif (!buff) return\n\n\t\tconst data = new Float32Array(buff)\n\t\tconst painter = new PainterStars(ctx, data)\n\t\tctx.add(\n\t\t\tnew TgdPainterState(ctx, {\n\t\t\t\tblend: webglPresetBlend.alpha,\n\t\t\t\tchildren: [new PainterNames(ctx), painter],\n\t\t\t}),\n\t\t)\n\t\tctx.paint()\n\t})\n}","Class PainterStars":"export class PainterStars extends TgdPainter {\n\t// Number of stars\n\tprivate readonly count: number\n\tprivate readonly prg: TgdProgram\n\tprivate readonly vao: TgdVertexArray\n\n\tprivate readonly fixedCamera = new TgdCameraPerspective({\n\t\ttransfo: { distance: 0 },\n\t\tnear: 0.1,\n\t\tfar: 2.0,\n\t\tfovy: Math.PI / 3,\n\t})\n\n\t/**\n\t *\n\t * @param data A sequence of 4 floats: longitude, latitude, brightness and color.\n\t */\n\tconstructor(\n\t\tprivate readonly context: TgdContext,\n\t\tdata: Float32Array,\n\t) {\n\t\tsuper()\n\t\tthis.count = data.length >> 2\n\t\tthis.prg = new TgdProgram(context.gl, {\n\t\t\tvert,\n\t\t\tfrag,\n\t\t})\n\t\tconst dataset = new TgdDataset({\n\t\t\tattStar: \"vec4\",\n\t\t})\n\t\tdataset.set(\"attStar\", data)\n\t\tthis.vao = new TgdVertexArray(context.gl, this.prg, [dataset])\n\t}\n\n\tpaint() {\n\t\tconst { context, prg, vao, fixedCamera } = this\n\t\tconst { camera, gl } = context\n\t\tfixedCamera.transfo.orientation = camera.transfo.orientation\n\t\tprg.use()\n\t\tprg.uniformMatrix4fv(\"uniModelViewMatrix\", fixedCamera.matrixModelView)\n\t\tprg.uniformMatrix4fv(\"uniProjectionMatrix\", fixedCamera.matrixProjection)\n\t\tprg.uniform1f(\n\t\t\t\"uniVegaSizeInPixels\",\n\t\t\tMath.max(context.width, context.height) * 0.05,\n\t\t)\n\t\tvao.bind()\n\t\tgl.drawArrays(gl.POINTS, 0, this.count)\n\t}\n\n\tdelete() {\n\t\tthis.prg.delete()\n\t\tthis.vao.delete()\n\t}\n}","Fragment shader \"./painter-stars.frag\"":"#version 300 es\n\nprecision mediump float;\n\nin vec4 varColor;\nin float varRadiusLimit;\n\nout vec4 FragColor;\n\nvoid main() {\n    vec2 point = 2.0 * gl_PointCoord.xy - vec2(1.0);\n    float radius = length(point);\n    if (radius > 1.0) discard;\n    \n    float alpha = varColor.a;\n    alpha *= 1.0 - pow(radius, 2.0);\n    float fade = 1.0 - smoothstep(varRadiusLimit, varRadiusLimit * 2.0, radius) * 0.9;\n    alpha *= fade;\n    FragColor = vec4(varColor.rgb, alpha);\n}","Vertex shader \"./painter-stars.vert\"":"#version 300 es\n\nprecision mediump float;\n\nuniform mat4 uniModelViewMatrix;\nuniform mat4 uniProjectionMatrix;\nuniform float uniVegaSizeInPixels;\n\nin vec4 attStar;\n\nout vec4 varColor;\nout float varRadiusLimit;\n\nvoid main() {\n    float longitude = attStar.x;\n    float latitude = attStar.y;\n    float brightness = attStar.z;\n    float temperature = attStar.w;\n    \n    vec3 color = mix(\n        vec3(.5, .1, .1), \n        vec3(.1, .2, .5), \n        temperature\n    ) * (2.0 + brightness * 5.0);\n    varColor = vec4(color, 0.1 + 0.9 * brightness);\n\n    float r = cos(latitude);\n    float z = sin(latitude);\n    float x = cos(longitude) * r;\n    float y = sin(longitude) * r;\n    gl_Position = uniProjectionMatrix * uniModelViewMatrix * vec4(x, y, z, 1.0);\n    gl_Position.z = gl_Position.w;\n    \n    gl_PointSize = max(uniVegaSizeInPixels * brightness, 1.0);\n    float radiusLimit = clamp(sqrt(gl_PointSize), 0.2, 10.0);\n    varRadiusLimit = radiusLimit / gl_PointSize;\n}\n"}
const FULL = "import {\n\tTgdCameraPerspective,\n\ttype TgdContext,\n\tTgdControllerCameraOrbit,\n\tTgdDataset,\n\tTgdPainter,\n\tTgdPainterClear,\n\tTgdPainterState,\n\tTgdProgram,\n\tTgdVertexArray,\n\ttgdLoadArrayBuffer,\n\twebglPresetBlend,\n} from \"@tolokoban/tgd\"\n\nimport View from \"@/components/demo/Tgd\"\nimport dataURL from \"../stars.dat\"\nimport { PainterNames } from \"./painter-names\"\nimport frag from \"./painter-stars.frag\"\nimport vert from \"./painter-stars.vert\"\n\nfunction init(ctx: TgdContext) {\n\tnew TgdControllerCameraOrbit(ctx, {\n\t\tinertiaOrbit: 1000,\n\t})\n\tctx.add(new TgdPainterClear(ctx, { color: [0, 0, 0, 1] }))\n\tctx.paint()\n\ttgdLoadArrayBuffer(dataURL).then((buff) => {\n\t\tif (!buff) return\n\n\t\tconst data = new Float32Array(buff)\n\t\tconst painter = new PainterStars(ctx, data)\n\t\tctx.add(\n\t\t\tnew TgdPainterState(ctx, {\n\t\t\t\tblend: webglPresetBlend.alpha,\n\t\t\t\tchildren: [new PainterNames(ctx), painter],\n\t\t\t}),\n\t\t)\n\t\tctx.paint()\n\t})\n}\n\nexport default function Demo() {\n\treturn <View onReady={init} />\n}\n\nexport class PainterStars extends TgdPainter {\n\t// Number of stars\n\tprivate readonly count: number\n\tprivate readonly prg: TgdProgram\n\tprivate readonly vao: TgdVertexArray\n\n\tprivate readonly fixedCamera = new TgdCameraPerspective({\n\t\ttransfo: { distance: 0 },\n\t\tnear: 0.1,\n\t\tfar: 2.0,\n\t\tfovy: Math.PI / 3,\n\t})\n\n\t/**\n\t *\n\t * @param data A sequence of 4 floats: longitude, latitude, brightness and color.\n\t */\n\tconstructor(\n\t\tprivate readonly context: TgdContext,\n\t\tdata: Float32Array,\n\t) {\n\t\tsuper()\n\t\tthis.count = data.length >> 2\n\t\tthis.prg = new TgdProgram(context.gl, {\n\t\t\tvert,\n\t\t\tfrag,\n\t\t})\n\t\tconst dataset = new TgdDataset({\n\t\t\tattStar: \"vec4\",\n\t\t})\n\t\tdataset.set(\"attStar\", data)\n\t\tthis.vao = new TgdVertexArray(context.gl, this.prg, [dataset])\n\t}\n\n\tpaint() {\n\t\tconst { context, prg, vao, fixedCamera } = this\n\t\tconst { camera, gl } = context\n\t\tfixedCamera.transfo.orientation = camera.transfo.orientation\n\t\tprg.use()\n\t\tprg.uniformMatrix4fv(\"uniModelViewMatrix\", fixedCamera.matrixModelView)\n\t\tprg.uniformMatrix4fv(\"uniProjectionMatrix\", fixedCamera.matrixProjection)\n\t\tprg.uniform1f(\n\t\t\t\"uniVegaSizeInPixels\",\n\t\t\tMath.max(context.width, context.height) * 0.05,\n\t\t)\n\t\tvao.bind()\n\t\tgl.drawArrays(gl.POINTS, 0, this.count)\n\t}\n\n\tdelete() {\n\t\tthis.prg.delete()\n\t\tthis.vao.delete()\n\t}\n}\n"

export default function DemoContainer() {
    const [full, setFull] = React.useState(false)
    return <>
        <div className="half-left"><Demo /></div>
        <div className="half-right">
            <div>
                <ViewButton variant="elevated" onClick={() => setFull(!full)}>
                    {full ? "Show code details" : "Show full code"}
                </ViewButton>
            </div>
            <CodeViewer language="tsx" value={full ? FULL : FOCUS} />
        </div>
    </>
}