/**
 * Warning! This code has been generated automatically.
 */
import React from "react"
import { ViewButton } from "@tolokoban/ui"
import CodeViewer from "@/components/demo/CodeViewer"
import Demo from "./painter-stars.demo"

const FOCUS = {"Detail #1":"function init(ctx: TgdContext): TgdContext {\n    new TgdControllerCameraOrbit(ctx, {\n        inertiaOrbit: 1000,\n    })\n    ctx.add(new TgdPainterClear(ctx, { color: [0, 0, 0, 1] }))\n    ctx.paint()\n    tgdLoadArrayBuffer(dataURL).then(buff => {\n        if (!buff) return\n\n        const data = new Float32Array(buff)\n        const painter = new PainterStars(ctx, data)\n        ctx.add(\n            new TgdPainterState(ctx, {\n                blend: webglPresetBlend.alpha,\n                children: [new PainterNames(ctx), painter],\n            })\n        )\n        ctx.paint()\n    })\n    return ctx\n}","Class PainterStars":"export class PainterStars extends TgdPainter {\n    // Number of stars\n    private readonly count: number\n    private readonly prg: TgdProgram\n    private readonly vao: TgdVertexArray\n\n    private readonly fixedCamera = new TgdCameraPerspective({\n        distance: 0,\n        near: 0.1,\n        far: 2.0,\n        target: [0, 0, 0],\n        fovy: Math.PI / 3,\n    })\n\n    /**\n     *\n     * @param data A sequence of 4 floats: longitude, latitude, brightness and color.\n     */\n    constructor(private readonly context: TgdContext, data: Float32Array) {\n        super()\n        this.count = data.length >> 2\n        this.prg = context.programs.create(\n            {\n                vert,\n                frag,\n            },\n            \"PainterStars\"\n        )\n        const dataset = new TgdDataset({\n            attStar: \"vec4\",\n        })\n        dataset.set(\"attStar\", data)\n        this.vao = context.createVAO(this.prg, [dataset])\n    }\n\n    paint() {\n        const { context, prg, vao, fixedCamera } = this\n        const { camera, gl } = context\n        fixedCamera.orientation = camera.orientation\n        prg.use()\n        prg.uniformMatrix4fv(\"uniModelViewMatrix\", fixedCamera.matrixModelView)\n        prg.uniformMatrix4fv(\n            \"uniProjectionMatrix\",\n            fixedCamera.matrixProjection\n        )\n        prg.uniform1f(\n            \"uniVegaSizeInPixels\",\n            Math.max(context.width, context.height) * 0.05\n        )\n        vao.bind()\n        gl.drawArrays(gl.POINTS, 0, this.count)\n    }\n\n    delete() {\n        this.context.programs.delete(this.prg)\n        this.vao.delete()\n    }\n}","Vertex shader \"./painter-stars.vert\"":"#version 300 es\n\nprecision mediump float;\n\nuniform mat4 uniModelViewMatrix;\nuniform mat4 uniProjectionMatrix;\nuniform float uniVegaSizeInPixels;\n\nin vec4 attStar;\n\nout vec4 varColor;\nout float varRadiusLimit;\n\nvoid main() {\n    float longitude = attStar.x;\n    float latitude = attStar.y;\n    float brightness = attStar.z;\n    float temperature = attStar.w;\n    \n    vec3 color = mix(\n        vec3(.5, .1, .1), \n        vec3(.1, .2, .5), \n        temperature\n    ) * (2.0 + brightness * 5.0);\n    varColor = vec4(color, 0.1 + 0.9 * brightness);\n\n    float r = cos(latitude);\n    float z = sin(latitude);\n    float x = cos(longitude) * r;\n    float y = sin(longitude) * r;\n    gl_Position = uniProjectionMatrix * uniModelViewMatrix * vec4(x, y, z, 1.0);\n    gl_Position.z = gl_Position.w;\n    \n    gl_PointSize = max(uniVegaSizeInPixels * brightness, 1.0);\n    float radiusLimit = clamp(sqrt(gl_PointSize), 0.2, 10.0);\n    varRadiusLimit = radiusLimit / gl_PointSize;\n}\n","Fragment shader \"./painter-stars.frag\"":"#version 300 es\n\nprecision mediump float;\n\nin vec4 varColor;\nin float varRadiusLimit;\n\nout vec4 FragColor;\n\nvoid main() {\n    vec2 point = 2.0 * gl_PointCoord.xy - vec2(1.0);\n    float radius = length(point);\n    if (radius > 1.0) discard;\n    \n    float alpha = varColor.a;\n    alpha *= 1.0 - pow(radius, 2.0);\n    float fade = 1.0 - smoothstep(varRadiusLimit, varRadiusLimit * 2.0, radius) * 0.9;\n    alpha *= fade;\n    FragColor = vec4(varColor.rgb, alpha);\n}"}
const FULL = "import {\n    TgdPainter,\n    TgdContext,\n    TgdProgram,\n    TgdDataset,\n    TgdVertexArray,\n    TgdPainterClear,\n    tgdLoadArrayBuffer,\n    TgdControllerCameraOrbit,\n    TgdCameraPerspective,\n    TgdPainterState,\n    webglPresetBlend,\n} from \"@tolokoban/tgd\"\n\nimport View from \"@/components/demo/Tgd\"\nimport { PainterNames } from \"./painter-names\"\n\nimport dataURL from \"../stars.dat\"\nimport vert from \"./painter-stars.vert\"\nimport frag from \"./painter-stars.frag\"\n\nfunction init(ctx: TgdContext): TgdContext {\n    new TgdControllerCameraOrbit(ctx, {\n        inertiaOrbit: 1000,\n    })\n    ctx.add(new TgdPainterClear(ctx, { color: [0, 0, 0, 1] }))\n    ctx.paint()\n    tgdLoadArrayBuffer(dataURL).then(buff => {\n        if (!buff) return\n\n        const data = new Float32Array(buff)\n        const painter = new PainterStars(ctx, data)\n        ctx.add(\n            new TgdPainterState(ctx, {\n                blend: webglPresetBlend.alpha,\n                children: [new PainterNames(ctx), painter],\n            })\n        )\n        ctx.paint()\n    })\n    return ctx\n}\n\nexport default function Demo() {\n    return <View onReady={init} />\n}\n\nexport class PainterStars extends TgdPainter {\n    // Number of stars\n    private readonly count: number\n    private readonly prg: TgdProgram\n    private readonly vao: TgdVertexArray\n\n    private readonly fixedCamera = new TgdCameraPerspective({\n        distance: 0,\n        near: 0.1,\n        far: 2.0,\n        target: [0, 0, 0],\n        fovy: Math.PI / 3,\n    })\n\n    /**\n     *\n     * @param data A sequence of 4 floats: longitude, latitude, brightness and color.\n     */\n    constructor(private readonly context: TgdContext, data: Float32Array) {\n        super()\n        this.count = data.length >> 2\n        this.prg = context.programs.create(\n            {\n                vert,\n                frag,\n            },\n            \"PainterStars\"\n        )\n        const dataset = new TgdDataset({\n            attStar: \"vec4\",\n        })\n        dataset.set(\"attStar\", data)\n        this.vao = context.createVAO(this.prg, [dataset])\n    }\n\n    paint() {\n        const { context, prg, vao, fixedCamera } = this\n        const { camera, gl } = context\n        fixedCamera.orientation = camera.orientation\n        prg.use()\n        prg.uniformMatrix4fv(\"uniModelViewMatrix\", fixedCamera.matrixModelView)\n        prg.uniformMatrix4fv(\n            \"uniProjectionMatrix\",\n            fixedCamera.matrixProjection\n        )\n        prg.uniform1f(\n            \"uniVegaSizeInPixels\",\n            Math.max(context.width, context.height) * 0.05\n        )\n        vao.bind()\n        gl.drawArrays(gl.POINTS, 0, this.count)\n    }\n\n    delete() {\n        this.context.programs.delete(this.prg)\n        this.vao.delete()\n    }\n}\n"

export default function DemoContainer() {
    const [full, setFull] = React.useState(false)
    return <>
        <div className="half-left"><Demo /></div>
        <div className="half-right">
            <div>
                <ViewButton variant="elevated" onClick={() => setFull(!full)}>
                    {full ? "Show code details" : "Show full code"}
                </ViewButton>
            </div>
            <CodeViewer language="tsx" value={full ? FULL : FOCUS} />
        </div>
    </>
}