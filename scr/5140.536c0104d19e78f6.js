"use strict";(self.webpackChunk_tolokoban_tgd=self.webpackChunk_tolokoban_tgd||[]).push([["5140"],{3172(e,t,n){n.d(t,{A:()=>p});var r=n(4848),a=n(6540),s=n(6671);function i({className:e,label:t,min:n,max:a,value:i,onChange:l}){return(0,r.jsxs)("div",{className:s.Sxu.classNames.join(e,"u8HaymDuvmcx5Xlm"),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{children:t}),(0,r.jsx)("div",{children:(0,r.jsx)("strong",{children:i.toFixed(2)})})]}),(0,r.jsx)("input",{type:"range",step:(a-n)/100,min:n,max:a,value:i,onChange:e=>{l(parseFloat(e.target.value))}})]})}function l({className:e,values:t,onChange:n}){let[l,o]=a.useState(!1);return(0,r.jsxs)("div",{className:s.Sxu.classNames.join(e,"O3eUw2E6kJAY5Kzb",l?"fh6L2aMFrodrLYWv":"LFyaXnIfeqU4RizM"),children:[(0,r.jsx)("button",{type:"button",onClick:()=>o(!l),children:(0,r.jsx)("svg",{style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24",preserveAspectRatio:"xMidYMid meet","stroke-width":"1.5",children:(0,r.jsx)("path",{d:"M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",stroke:"none",fill:"#fff"})})}),(0,r.jsx)("div",{children:Object.keys(t).map(e=>{let a=t[e];if(!a)return null;let s=a.min??0,l=a.max??1;return(0,r.jsx)(i,{label:a.label,min:s,max:l,value:a.value,onChange:r=>{n({...t,[e]:{...t[e],value:r}})}},e)})})]})}var o=n(2155),c=n(3289);let u="NwIHvuh9THszhNCj",d="OvO7uXOT0RoimVco",h="r0e5CaWIlKI2oFZu",g="qgsDNUq3iYtpdR4I";function p({className:e,options:t,onReady:n,gizmo:i=!1,width:p="640px",height:m="480px",noBorder:b=!1,assets:x,controller:j,settings:v,children:y,disableDefaultDoubleTap:w=!1}){let C=a.useRef(null),[k,O]=a.useState(v),P=a.useCallback(()=>{if(!k)return{};let e={};for(let t of Object.keys(k))e[t]=k[t].value;return e},[k]);a.useEffect(()=>{if(k){let e={};for(let t of Object.keys(k))e[t]=k[t].value;C.current?.(P())}},[k,P]);let[L,S]=a.useState(null),[T,N]=a.useState(!0),[M,R]=a.useState(!1),E=a.useRef(null),D=a.useRef(null),I=a.useRef(null),A=a.useRef(null),B=a.useRef(null),[F,W]=a.useState(!0);p.endsWith("px")&&m.endsWith("px")&&(p.substring(p.length-2),m.substring(m.length-2));let z=e=>{if(!e||D.current)return;D.current=e;let r=new o.TgdContext(e,t);console.log("Depht buffer bits:",r.gl.getParameter(r.gl.DEPTH_BITS)),E.current=r,W(!0),f(x).then(e=>{try{if(j){let e=new o.TgdControllerCameraOrbit(r,{debug:!0,inertiaOrbit:1e3,inertiaZoom:500,inertiaPanning:500,...j});B.current=e,r.inputs.pointer.eventTapMultiple.addListener(t=>{console.log("\uD83D\uDE80 [tgd] evt.tapsCount =",t.tapsCount),t.preventTap(),2!==t.tapsCount||w||e.reset((j.inertiaOrbit??500)*.001)})}C.current=n(r,e),C.current?.(P()),r.paint()}catch(e){S(e instanceof Error?e.message:JSON.stringify(e)),console.error(e)}W(!1)}).catch(e=>{console.error("Unable to initialize the scene!",e),W(!1)});let a=I.current;a&&a.attachContext(r)},q=e=>{let t=new o.TgdCanvasGizmo({canvas:e});I.current=t,t.eventTipClick.addListener(({to:e})=>{let t=E.current;t&&t.animSchedule({duration:.2,easingFunction:o.tgdEasingFunctionInOutCubic,action:(0,o.tgdActionCreateCameraInterpolation)(t.camera,{orientation:e})})});let n=E.current;n&&t.attachContext(n)};return(a.useEffect(()=>{let e=D.current,t=E.current;if(!e||!t)return;let n=new ResizeObserver(()=>t.paint());return n.observe(e),e.requestFullscreen||(e.requestFullscreen=e.webkitRequestFullscreen),R(!!e.requestFullscreen),()=>n.unobserve(e)},[E.current,D.current]),b)?(0,r.jsxs)("div",{ref:A,className:u,style:{width:T?p:m,height:T?m:p},children:[(0,r.jsx)("canvas",{className:d,ref:z}),i&&(0,r.jsx)("canvas",{className:h,ref:q}),k&&(0,r.jsx)(l,{values:k,onChange:O}),L&&(0,r.jsx)("div",{className:g,children:L})]}):(0,r.jsxs)("div",{className:s.Sxu.classNames.join(e,"MESVmxyHbYMu0P0r"),children:[(0,r.jsxs)("div",{className:s.Sxu.classNames.join("OBhA17iAKaUaAbSS",!F&&"dxtnW6vkWWweMZbP"),children:[(0,r.jsx)("div",{children:(0,r.jsx)(s.I64,{onClick:()=>N(!T)})}),(0,r.jsx)("div",{children:(0,r.jsx)(s.kRc,{onClick:()=>{let e=E.current;e&&e.takeSnapshot().then(e=>{let t=document.createElement("a");document.body.appendChild(t),t.style.display="none",t.href=e.src,t.download="snapshot.png",t.click(),window.setTimeout(()=>document.body.removeChild(t),3e4)})}})}),M&&(0,r.jsx)("div",{children:(0,r.jsx)(s.L9n,{onClick:()=>{let e=A.current;e&&e.requestFullscreen()}})}),j&&(0,r.jsx)("div",{children:(0,r.jsx)(s.zgT,{onClick:()=>{let e=B.current,t=E.current;t&&e&&(e.cameraInitialState=t.camera.getCurrentState(),e.resetZoom())}})})]}),(0,r.jsxs)("div",{className:"IctJ7LNrbc0x_gIB",children:[(0,r.jsxs)("div",{ref:A,className:u,style:{width:T?p:m,height:T?m:p},children:[(0,r.jsx)("canvas",{className:d,ref:z}),i&&(0,r.jsx)("canvas",{className:h,ref:q}),k&&(0,r.jsx)(l,{values:k,onChange:O}),L&&(0,r.jsx)("div",{className:g,children:L})]}),(0,r.jsx)("div",{className:s.Sxu.classNames.join("w7EXkaA82Y850o5V",F&&"c4TMDjqUWvQOmkt9"),children:(0,r.jsx)(c.A,{})}),y]})]})}async function f({glb:e,data:t,text:n,image:r}={}){let a={glb:{},data:{},text:{},image:{}},s=[];return r&&Object.keys(r).forEach(e=>{s.push(async()=>{let t=r[e];console.log("Loading image:",t);let n=await (0,o.tgdLoadImage)(t);n&&(a.image[e]=n)})}),e&&Object.keys(e).forEach(t=>{s.push(async()=>{let n=e[t];console.log("Loading GLB:",n);let r=await (0,o.tgdLoadGlb)(n);r&&(a.glb[t]=r)})}),t&&Object.keys(t).forEach(e=>{s.push(async()=>{let n=t[e],r=await (0,o.tgdLoadArrayBuffer)(n);r&&(a.data[e]=r)})}),n&&Object.keys(n).forEach(e=>{s.push(async()=>{let t=n[e],r=await (0,o.tgdLoadText)(t);r&&(a.text[e]=r)})}),await Promise.all(s.map(e=>e())),a}},2784(e,t,n){n.r(t),n.d(t,{default:()=>h});var r=n(4848),a=n(8453);n(6540);var s=n(2155),i=n(3172);let l=n.p+"img/background.94860ce4a0297491.webp",o=n.p+"bin/background.49be5e8ef07a359b.glb";function c(){return(0,r.jsx)(i.A,{onReady:(e,t)=>{let n,r,a,i;e.camera=t.glb.background.createCameraByName("Camera"),e.camera.far=100,n=new s.TgdPainterState(e,{cull:s.webglPresetCull.back,children:[(0,s.tgdMakeMeshGlbPainter)({context:e,data:t.glb.background,node:"Building",overrideMaterial:()=>()=>new s.TgdMaterialDepth}).painter]}),r=new s.TgdPainterBackgroundWithDepth(e,{background:new s.TgdTexture2D(e).loadBitmap(t.image.background),children:[n]}),(a=new s.TgdPainterMesh(e)).transfo.setPosition(11.02,0,-8.75).setScale(4),(i=new s.TgdPainterMesh(e)).transfo.setPosition(.02,0,-4).setScale(4),e.add(r,new s.TgdPainterState(e,{depth:s.webglPresetDepth.less,children:[a,i]}),new s.TgdPainterLogic(e=>{let t=(0,s.tgdCalcModulo)(.1*e,0,2),n=0;n=t<1?25*t:25*(2-t);let{x:r,z:l}=a.transfo.position;a.transfo.setPosition(r,n,l),a.transfo.setEulerRotation(e,47*e,-(120*e));let o=0;o=t<1?30*t:30*(2-t);let{x:c,z:u}=i.transfo.position;i.transfo.setPosition(c,o,u),i.transfo.setEulerRotation(e,57*e,-(103*e))})),e.play()},options:{antialias:!1},assets:{glb:{background:o},image:{background:l}}})}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function d(e){var t=u({a:"a",h1:"h1",h2:"h2",p:"p"},(0,a.R)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{children:(0,r.jsx)(t.a,{href:"docs/classes/TgdPainterBackgroundWithDepth.html",children:"TgdPainterBackgroundWithDepth"})}),"\n",(0,r.jsx)(t.p,{children:"In case you have a fixed camera and a complex environment you can optimize the\npainting by pre-rendering it in Blender and generating the depth buffer with simple/fast material."}),"\n",(0,r.jsx)(t.p,{children:"TgdPainterBackgroundWithDepth will paint the high definition image and fill the\ndepth buffer with the meshes you give it as children. If the canvas size doesn't change, then the\nmeshes won't even been rendered. That's why you can use high poly meshes if you need accuracy."}),"\n",(0,r.jsx)(t.p,{children:"In the following example, we used a very low-poly mesh. You can see this when the left cube is on the top.\nThe hemi-sphere at the top of the tower is bulky, and the cube acts strange in this area."}),"\n",(0,r.jsx)(t.p,{children:"But if you know where your moving objects will be, then you can have high definition in these places\nand low poly everywhere else."}),"\n",(0,r.jsx)(t.h2,{children:"Example"}),"\n",(0,r.jsx)(c,{})]})}function h(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=u({},(0,a.R)(),n.components).wrapper;return s?(0,r.jsx)(s,(e=u({},n),t=t={children:(0,r.jsx)(d,u({},n))},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e)):d(n)}},8453(e,t,n){n.d(t,{R:()=>s});var r=n(6540);let a=r.createContext({});function s(e){let t=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}}}]);