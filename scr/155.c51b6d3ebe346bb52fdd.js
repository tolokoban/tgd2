"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[155],{155:(t,i,e)=>{e.d(i,{EK:()=>Q,Op:()=>q,Ui:()=>J,Uj:()=>Z,WM:()=>$,Yp:()=>G,Zc:()=>B,a7:()=>H,l4:()=>O,ts:()=>K,tz:()=>C,yr:()=>W});var s={d:(t,i)=>{for(var e in i)s.o(i,e)&&!s.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)},r={};function n(t,i=6){const e=Math.pow(10,i),s=[];let r=0;for(const n of t){const t=(Math.round(n*e)/e).toFixed(i);r=Math.max(r,t.length),s.push(t)}return s.map((t=>t.padStart(r," ")))}s.d(r,{OE:()=>M,QF:()=>k,Ev:()=>d,op:()=>f,_G:()=>T,ED:()=>R,sT:()=>L,wB:()=>h,gR:()=>I,ck:()=>S,Wk:()=>F,Yv:()=>x,cL:()=>X,mI:()=>j,wn:()=>y,aW:()=>c,E7:()=>P,yo:()=>o,qM:()=>a});class o extends Float32Array{constructor(t=0,i=0,e=0){if(super(3),"number"!=typeof t)return this.x=t.x,this.y=t.y,void(this.z=t.z);this.x=t,this.y=i,this.z=e}clone(){return new o(this)}isEqual({x:t,y:i,z:e}){return t===this.x&&i===this.y&&e===this.z}isClose({x:t,y:i,z:e},s=1e-6){return!(Math.abs(t-this.x)>s||Math.abs(i-this.y)>s||Math.abs(e-this.z)>s)}rotateAround(t,i){const e=Math.cos(i),s=Math.sin(i),[r,n,o]=this,[h,a,c]=t,u=a*o-c*n,m=c*r-h*o,l=h*n-a*r,d=(r*h+n*a+o*c)*(1-e);return this.x=r*e+u*s+h*d,this.y=n*e+m*s+a*d,this.z=o*e+l*s+c*d,this}applyMatrix(t){const{x:i,y:e,z:s}=this;return this.x=i*t.m00+e*t.m10+s*t.m20,this.y=i*t.m01+e*t.m11+s*t.m21,this.z=i*t.m02+e*t.m12+s*t.m22,this}from({x:t,y:i,z:e}){return this.x=t,this.y=i,this.z=e,this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}add(...t){for(const i of t)this[0]+=i[0],this[1]+=i[1],this[2]+=i[2];return this}addWithScale({x:t,y:i,z:e},s=1){return this[0]+=t*s,this[1]+=i*s,this[2]+=e*s,this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}get size(){return Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2])}normalize(){const t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2];return 0===t?this:this.scale(1/Math.sqrt(t))}debug(t="vec3"){const{x:i,y:e,z:s}=this,r=[i,e,s].map((t=>t.toFixed(6)));console.log(`${t}:   `,r.join(" | "))}}class h extends Float32Array{constructor(t=1,i=0,e=0,s=0,r=0,n=1,o=0,h=0,a=0,c=0,u=1,m=0,l=0,d=0,f=0,g=1){super("number"==typeof t?[t,i,e,s,r,n,o,h,a,c,u,m,l,d,f,g]:t)}get translation(){const{m30:t,m31:i,m32:e}=this;return new o(t,i,e)}set translation(t){this.m30=t.x,this.m31=t.y,this.m32=t.z}fromMat3(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this}toAxis(t,i,e){return this.toAxisX(t),this.toAxisY(i),this.toAxisZ(e)}toAxisX(t){return t.x=this.m00,t.y=this.m01,t.z=this.m02,this}toAxisY(t){return t.x=this.m10,t.y=this.m11,t.z=this.m12,this}toAxisZ(t){return t.x=this.m20,t.y=this.m21,t.z=this.m22,this}fromQuat({x:t,y:i,z:e,w:s}){const r=t+t,n=i+i,o=e+e,h=t*r,a=i*r,c=i*n,u=e*r,m=e*n,l=e*o,d=s*r,f=s*n,g=s*o;return this.m00=1-c-l,this.m10=a-g,this.m20=u+f,this.m01=a+g,this.m11=1-h-l,this.m21=m-d,this.m02=u-f,this.m12=m+d,this.m22=1-h-c,this}get m00(){return this[0]}set m00(t){this[0]=t}get m01(){return this[1]}set m01(t){this[1]=t}get m02(){return this[2]}set m02(t){this[2]=t}get m03(){return this[3]}set m03(t){this[3]=t}get m10(){return this[4]}set m10(t){this[4]=t}get m11(){return this[5]}set m11(t){this[5]=t}get m12(){return this[6]}set m12(t){this[6]=t}get m13(){return this[7]}set m13(t){this[7]=t}get m20(){return this[8]}set m20(t){this[8]=t}get m21(){return this[9]}set m21(t){this[9]=t}get m22(){return this[10]}set m22(t){this[10]=t}get m23(){return this[11]}set m23(t){this[11]=t}get m30(){return this[12]}set m30(t){this[12]=t}get m31(){return this[13]}set m31(t){this[13]=t}get m32(){return this[14]}set m32(t){this[14]=t}get m33(){return this[15]}set m33(t){this[15]=t}debug(t="Mat4"){const i=n([this.m00,this.m01,this.m02,this.m03]),e=n([this.m10,this.m11,this.m12,this.m13]),s=n([this.m20,this.m21,this.m22,this.m23]),r=n([this.m30,this.m31,this.m32,this.m33]);console.log(t),console.log("   ",[i[0],e[0],s[0],r[0]].join(" | ")),console.log("   ",[i[1],e[1],s[1],r[1]].join(" | ")),console.log("   ",[i[2],e[2],s[2],r[2]].join(" | ")),console.log("   ",[i[3],e[3],s[3],r[3]].join(" | "))}}class a extends Float32Array{constructor(t=0,i=0,e=0,s=1){return super(4),t instanceof a?(this.x=t.x,this.y=t.y,this.z=t.z,void(this.w=t.w)):t instanceof o?(this.x=t.x,this.y=t.y,this.z=t.z,void(this.w=s)):(this.x=t,this.y=i,this.z=e,void(this.w=s))}reset(t=0,i=0,e=0,s=1){return this.x=t,this.y=i,this.z=e,this.w=s,this}from(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new a(this)}isEqual({x:t,y:i,z:e,w:s}){return t===this.x&&i===this.y&&e===this.z&&s===this.w}isClose({x:t,y:i,z:e,w:s},r=1e-6){return!(Math.abs(t-this.x)>r||Math.abs(i-this.y)>r||Math.abs(e-this.z)>r||Math.abs(s-this.w)>r)}applyMatrix(t){const{x:i,y:e,z:s,w:r}=this;return this.x=i*t.m00+e*t.m10+s*t.m20+r*t.m30,this.y=i*t.m01+e*t.m11+s*t.m21+r*t.m31,this.z=i*t.m02+e*t.m12+s*t.m22+r*t.m32,this.w=i*t.m03+e*t.m13+s*t.m23+r*t.m33,this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}add(...t){for(const i of t)this[0]+=i[0],this[1]+=i[1],this[2]+=i[2],this[3]+=i[3];return this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this[3]-=t[3],this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}get size(){return Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]+this[3]*this[3])}normalize(){const t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2]+this[3]*this[3];return 0===t?this:this.scale(1/Math.sqrt(t))}debug(t="vec4"){const{x:i,y:e,z:s,w:r}=this,n=[i,e,s,r].map((t=>t.toFixed(6)));console.log(`${t}:   `,n.join(" | "))}}class c extends a{constructor(t=0,i=0,e=0,s=1){"number"==typeof t?super(t,i,e,s):super(t)}clone(){return new c(this)}multiply(t){const[i,e,s,r]=this,[n,o,h,a]=t;return this[0]=a*i+n*r-o*s+h*e,this[1]=a*e+n*s+o*r-h*i,this[2]=a*s-n*e+o*i+h*r,this[3]=a*r-n*i-o*e-h*s,this}fromAxis(t,i,e){const s=t.x+i.y+e.z;if(s>0){const r=Math.sqrt(s+1);this.w=.5*r;const n=.5/r;this.x=(i.z-e.y)*n,this.y=(e.x-t.z)*n,this.z=(t.y-i.x)*n}else{const s=[t,i,e];let r=0;i.y>t.x&&(r=1),e.z>s[r][r]&&(r=2);const n=(r+1)%3,o=(r+2)%3;let h=Math.sqrt(s[r][r]-s[n][n]-s[o][o]+1);this[r]=.5*h,h=.5/h,this[3]=(s[n][o]-s[o][n])*h,this[n]=(s[n][r]+s[r][n])*h,this[o]=(s[o][r]+s[r][o])*h}}rotateAroundX(t){const i=.5*t,e=this[0],s=this[1],r=this[2],n=this[3],o=Math.sin(i),h=Math.cos(i);return this[0]=e*h+n*o,this[1]=s*h+r*o,this[2]=r*h-s*o,this[3]=n*h-e*o,this}rotateAroundY(t){const i=.5*t,e=this[0],s=this[1],r=this[2],n=this[3],o=Math.sin(i),h=Math.cos(i);return this[0]=e*h-r*o,this[1]=s*h+n*o,this[2]=r*h+e*o,this[3]=n*h-s*o,this}rotateAroundZ(t){const i=.5*t,e=this[0],s=this[1],r=this[2],n=this[3],o=Math.sin(i),h=Math.cos(i);return this[0]=e*h+s*o,this[1]=s*h-e*o,this[2]=r*h+n*o,this[3]=n*h-r*o,this}toAxisZ(t){const{x:i,y:e,z:s,w:r}=this,n=i+i,o=e+e,h=i*n,a=e*o,c=s*n,u=s*o,m=r*n,l=r*o;return t.x=c+l,t.y=u-m,t.z=1-h-a,t}face(t="+X+Y+Z"){const[i,e,s,r]=m[t];return this.x=i,this.y=e,this.z=s,this.w=r,this}}const u=Math.sqrt(2)/2,m={"+X+Y+Z":[0,0,0,1],"-Z+Y+X":[0,+u,0,+u],"-X+Y-Z":[0,1,0,0],"+Z+Y-X":[0,-u,0,+u]};class l extends Float32Array{constructor(t=1,i=0,e=0,s=0,r=1,n=0,o=0,h=0,a=1){super("number"==typeof t?[t,i,e,s,r,n,o,h,a]:t)}transpose(){let t=this.m10;return this.m10=this.m01,this.m01=t,t=this.m20,this.m20=this.m02,this.m02=t,t=this.m21,this.m21=this.m12,this.m12=t,this}fromQuat({x:t,y:i,z:e,w:s}){const r=t+t,n=i+i,o=e+e,h=t*r,a=i*r,c=i*n,u=e*r,m=e*n,l=e*o,d=s*r,f=s*n,g=s*o;return this.m00=1-c-l,this.m10=a-g,this.m20=u+f,this.m01=a+g,this.m11=1-h-l,this.m21=m-d,this.m02=u-f,this.m12=m+d,this.m22=1-h-c,this}toAxis(t,i,e){return this.toAxisX(t),this.toAxisY(i),this.toAxisZ(e)}toAxisX(t){return t.x=this.m00,t.y=this.m01,t.z=this.m02,this}toAxisY(t){return t.x=this.m10,t.y=this.m11,t.z=this.m12,this}toAxisZ(t){return t.x=this.m20,t.y=this.m21,t.z=this.m22,this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this[4]*=t,this[5]*=t,this[6]*=t,this[7]*=t,this[8]*=t,this}get m00(){return this[0]}set m00(t){this[0]=t}get m01(){return this[1]}set m01(t){this[1]=t}get m02(){return this[2]}set m02(t){this[2]=t}get m10(){return this[3]}set m10(t){this[3]=t}get m11(){return this[4]}set m11(t){this[4]=t}get m12(){return this[5]}set m12(t){this[5]=t}get m20(){return this[6]}set m20(t){this[6]=t}get m21(){return this[7]}set m21(t){this[7]=t}get m22(){return this[8]}set m22(t){this[8]=t}debug(t="Mat3"){const i=n([this.m00,this.m01,this.m02]),e=n([this.m10,this.m11,this.m12]),s=n([this.m20,this.m21,this.m22]);console.log(t),console.log("   ",[i[0],e[0],s[0]].join(" | ")),console.log("   ",[i[1],e[1],s[1]].join(" | ")),console.log("   ",[i[2],e[2],s[2]].join(" | "))}}class d{constructor(){this.dirty=!0,this.dirtyAxis=!0,this.axisX=new o,this.axisY=new o,this.axisZ=new o,this._matrixViewModel=new h,this.orientation=new c(0,0,0,1),this.target=new o(0,0,0),this._distance=10,this._zoom=1,this.tmpMat3=new l,this.tmpVec3=new o,this.orientation.face("+X+Y+Z"),this.orbitAroundY(Math.PI),this.updateAxisIfNeeded(),console.log("****************************************"),this.axisX.debug("X"),this.axisY.debug("Y"),this.axisZ.debug("Z"),this.matrixViewModel.debug(),this.orientation.debug("Quat");const t=(t,i)=>Math.abs(t-i)<1e-5,i=({x:i,y:e,z:s})=>t(i,1)?"+X":t(i,-1)?"-X":t(e,1)?"+Y":t(e,-1)?"-Y":t(s,1)?"+Z":t(s,-1)?"-Z":void 0,e=Math.sqrt(2)/2,s=({x:i,y:s,z:r,w:n})=>[i,s,r,n].map((i=>t(i,0)?"+0":t(i,1)?"+1":t(i,-1)?"-1":t(i,+e)?"+A":t(i,-e)?"-A":i)).join(", "),r=[];for(let t=0;t<4;t++)this.orientation.face("+X+Y+Z"),this.orbitAroundY(t*(Math.PI/2)),this.updateAxisIfNeeded(),this.updateIfNeeded(),r.push(`\n"${i(this.axisX)}${i(this.axisY)}${i(this.axisZ)}": [${s(this.orientation)}],`);console.log(r.join("")),this.orientation.face()}from({orientation:t,target:i,distance:e,zoom:s}){return this.orientation.from(t),this.target.from(i),this.distance=e,this.zoom=s,this.dirty=!0,this.dirtyAxis=!0,this}toAxisZ(t){return this.orientation.toAxisZ(t),this}get matrixViewModel(){return this.updateIfNeeded(),this._matrixViewModel}setOrientation(t){const{orientation:i}=this;if(t.isEqual(i))return;const[e,s,r,n]=t;i.x=e,i.y=s,i.z=r,i.w=n,this.dirty=!0,this.dirtyAxis=!0}setTarget(t){const{target:i}=this;if(t.isEqual(i))return;const[e,s,r]=t;i.x=e,i.y=s,i.z=r,this.dirty=!0}get x(){return this.target.x}set x(t){const{target:i}=this;t!==i.x&&(this.x=t,this.dirty=!0)}get y(){return this.target.y}set y(t){const{target:i}=this;t!==i.y&&(this.y=t,this.dirty=!0)}get z(){return this.target.z}set z(t){const{target:i}=this;t!==i.z&&(this.z=t,this.dirty=!0)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t,this.dirty=!0)}get zoom(){return this._zoom}set zoom(t){this._zoom!==t&&(this._zoom=t,this.dirty=!0)}moveTarget(t,i,e){const{target:s}=this;this.updateAxisIfNeeded();const{axisX:r,axisY:n,axisZ:o,tmpVec3:h}=this;h.from(r).scale(t).addWithScale(n,i).addWithScale(o,e),s.x+=h.x,s.y+=h.y,s.z+=h.z,this.dirty=!0}orbitAroundX(t){this.updateAxisIfNeeded();const{axisX:i,axisY:e,axisZ:s,orientation:r}=this;return e.rotateAround(i,t),s.rotateAround(i,t),r.fromAxis(i,e,s),this.dirty=!0,this}orbitAroundY(t){this.updateAxisIfNeeded();const{axisX:i,axisY:e,axisZ:s,orientation:r}=this;return i.rotateAround(e,t),s.rotateAround(e,t),r.fromAxis(i,e,s),this.dirty=!0,this}orbitAroundZ(t){this.updateAxisIfNeeded();const{axisX:i,axisY:e,axisZ:s,orientation:r}=this;return i.rotateAround(s,t),e.rotateAround(s,t),r.fromAxis(i,e,s),this.dirty=!0,this}updateAxisIfNeeded(){if(!this.dirtyAxis)return;const{tmpMat3:t}=this;t.fromQuat(this.orientation),t.toAxis(this.axisX,this.axisY,this.axisZ),this.dirtyAxis=!1}updateIfNeeded(){if(!this.dirty)return;const{tmpMat3:t,tmpVec3:i}=this,e=this._matrixViewModel;this.dirtyAxis=!0,this.updateAxisIfNeeded();const s=this._distance,{x:r,y:n,z:o}=this.target,{x:h,y:a,z:c}=this.axisZ;i.x=r+s*h,i.y=n+s*a,i.z=o+s*c,i.applyMatrix(t.transpose()).scale(-1),e.m30=i.x,e.m31=i.y,e.m32=i.z;const u=this._zoom;1!==u&&t.scale(u),e.fromMat3(t),this.dirty=!1}}class f extends d{constructor(){super(),this.dirtyProjection=!0,this._matrixProjection=new h,this._width=1920,this._height=1080,this._fovy=Math.PI/4,this._near=.001,this._far=1/0}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this.dirtyProjection=!0)}get height(){return this._height}set height(t){t!==this._height&&(this._height=t,this.dirtyProjection=!0)}get fovy(){return this._fovy}set fovy(t){t!==this._fovy&&(this._fovy=t,this.dirtyProjection=!0)}get near(){return this._near}set near(t){t!==this._near&&(this._near=t,this.dirtyProjection=!0)}get far(){return this._far}set far(t){t!==this._far&&(this._far=t,this.dirtyProjection=!0)}get matrixProjection(){return this.updateProjectionIfNeeded(),this._matrixProjection}updateProjectionIfNeeded(){if(!this.dirtyProjection)return;const t=this._fovy,i=this._width/this._height,e=this._near,s=this._far,r=this._matrixProjection,n=1/Math.tan(t/2);if(r[0]=n/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,s!==1/0){const t=1/(e-s);r[10]=(s+e)*t,r[14]=2*s*e*t}else r[10]=-1,r[14]=-2*e;this.dirtyProjection=!0}}class g{constructor(t){this.factory=t,this.keys=new Map,this.objects=new Map,this.factories=new Map,this.references=new Map}create(t){var i;const{factory:e}=this,s=e.key(t),r=null!==(i=this.references.get(s))&&void 0!==i?i:0;if(r<1){const i=e.create(t);return this.keys.set(i,s),this.objects.set(s,i),this.factories.set(s,e),this.references.set(s,1),i}const n=this.objects.get(s);if(!n)throw Error("[TgdResource.create] Panic!");return this.references.set(s,r+1),n}delete(t){var i;const e=this.keys.get(t);if(!e)return;const s=null!==(i=this.references.get(e))&&void 0!==i?i:0;if(s<1)return;if(s>1)return void this.references.set(e,s-1);const r=this.factories.get(e);if(!r)throw Error("[TgdResource.delete] Panic!");this.keys.delete(t),this.objects.delete(e),this.factories.delete(e),this.references.delete(e),r.delete(t)}}class x{constructor(t=[]){this.enabled=!0,this.painters=[...t]}add(...t){for(const i of t)this.painters.push(i)}remove(...t){for(const i of t){const t=this.painters.indexOf(i);t<0||(this.painters.splice(t,1),i.delete())}}delete(){for(const t of this.painters)t.delete();this.painters.splice(0,this.painters.length)}paint(t,i){if(this.enabled)for(const e of this.painters)e.paint(t,i)}update(t,i){if(this.enabled)for(const e of this.painters)e.update(t,i)}}class y{constructor(t,i){var e;this.gl=t;const s=t.createProgram();if(!s)throw Error("Unable to create WebGLProgram!");const r=this.createShader("VERTEX_SHADER",i.vert);t.attachShader(s,r);const n=this.createShader("FRAGMENT_SHADER",i.frag);if(t.attachShader(s,n),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)){var o=null!==(e=t.getProgramInfoLog(s))&&void 0!==e?e:"";console.warn(o);const r=v(o);throw b("Vertex Shader",i.vert,...r),b("Fragment Shader",i.frag,...r),new Error("Could NOT link WebGL2 program!\n"+o)}this.program=s,this.shaders=[r,n],this.uniformsLocations=this.getUniformsLocations()}getAttribLocation(t){const{gl:i,program:e}=this,s=i.getAttribLocation(e,t);if(s<0)throw Error(`Attribute "${t}" not found!`);return s}getUniformLocation(t){const{uniformsLocations:i}=this,e=Object.keys(i);if(0===t.length)throw Error(`Uniform "${t}" has not been found: there is no active uniform in this program!`);const s=i[t];if(!s)throw Error(`No active uniform found with name "${t}"!\nAvailable names are: ${e.join(", ")}.`);return s}uniform1f(t,i){const{gl:e}=this;e.uniform1f(this.getUniformLocation(t),i)}uniform2f(t,i,e){const{gl:s}=this;s.uniform2f(this.getUniformLocation(t),i,e)}uniform3f(t,i,e,s){const{gl:r}=this;r.uniform3f(this.getUniformLocation(t),i,e,s)}uniform3fv(t,i){const{gl:e}=this;e.uniform3fv(this.getUniformLocation(t),i)}uniform4f(t,i,e,s,r){const{gl:n}=this;n.uniform4f(this.getUniformLocation(t),i,e,s,r)}uniform4fv(t,i){const{gl:e}=this;e.uniform4fv(this.getUniformLocation(t),i)}uniform1i(t,i){const{gl:e}=this;e.uniform1i(this.getUniformLocation(t),i)}uniform2i(t,i,e){const{gl:s}=this;s.uniform2i(this.getUniformLocation(t),i,e)}uniform3i(t,i,e,s){const{gl:r}=this;r.uniform3i(this.getUniformLocation(t),i,e,s)}uniform4i(t,i,e,s,r){const{gl:n}=this;n.uniform4i(this.getUniformLocation(t),i,e,s,r)}uniform1ui(t,i){const{gl:e}=this;e.uniform1ui(this.getUniformLocation(t),i)}uniform2ui(t,i,e){const{gl:s}=this;s.uniform2ui(this.getUniformLocation(t),i,e)}uniform3ui(t,i,e,s){const{gl:r}=this;r.uniform3ui(this.getUniformLocation(t),i,e,s)}uniform4ui(t,i,e,s,r){const{gl:n}=this;n.uniform4ui(this.getUniformLocation(t),i,e,s,r)}uniformMatrix4fv(t,i){const{gl:e}=this;e.uniformMatrix4fv(this.getUniformLocation(t),!1,i)}use(){const{gl:t,program:i}=this;t.useProgram(i)}delete(){const{gl:t}=this;this.shaders.forEach((i=>t.deleteShader(i))),t.deleteProgram(this.program)}createShader(t,i){const{gl:e}=this,s=e.createShader(e[t]);if(!s)throw Error(`Unable to create a WebGLShader of type "${t}"!`);e.shaderSource(s,i),e.compileShader(s);const r=e.getShaderInfoLog(s);if(r)throw console.error(`Error in ${t} code:`,r),b(t,i,...v(r)),Error(`Unable to compile ${t}!`);return s}getUniformsLocations(){const{gl:t,program:i}=this,e=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);if("number"!=typeof e)throw Error("Unable to get the number of uniforms in a WebGLProgram!");const s={};for(let r=0;r<e;r++){const e=t.getActiveUniform(i,r);if(!e)continue;const n=t.getUniformLocation(i,e.name);if(null===n)throw Error(`Unable to get location for uniform "${e.name}"!`);s[e.name]=n}return s}}const p=/^ERROR:[ \t]+([0-9]+):([0-9]+):/g;function v(t){const i=[];for(const e of t.split("\n")){p.lastIndex=-1;const t=p.exec(e);t&&i.push(parseInt(t[2],10))}return i}function w(t,i=!1){return`color:#fff;background:${t};font-family:monospace;font-size:80%;font-weight:${i?"bolder":"100"}`}function b(t,i,...e){console.log(`%c${t}`,"font-weight:bolder;font-size:120%"),i.split("\n").forEach(((t,i)=>{const s=i+1,r=(1e-4*s).toFixed(4).substring(2),n=e.includes(s)?"#f00":"#000";console.log(`%c${r}  %c${t}`,w(n),w(n,!0))}))}class E{key(t){return JSON.stringify(t)}}class A extends E{constructor(t){super(),this.gl=t}create(t){return new y(this.gl,t)}delete(t){t.delete()}}class _{constructor(t,i,e){var s,r;this.gl=t;const n=t.createBuffer();if(!n)throw Error("Unable to create WebGLBuffer!");this._target=null!==(s=null==e?void 0:e.target)&&void 0!==s?s:"ARRAY_BUFFER",this._usage=null!==(r=null==e?void 0:e.usage)&&void 0!==r?r:"STATIC_DRAW",this.buffer=n,i&&this.bufferData(i,e)}get target(){return this._target}bind(t){const{gl:i,buffer:e}=this;this._target=null!=t?t:this._target,i.bindBuffer(i[this._target],e)}bufferData(t,i={}){var e;const{gl:s}=this;this.bind(i.target),this._usage=null!==(e=i.usage)&&void 0!==e?e:this._usage,s.bufferData(s[this._target],t,s[this._usage])}delete(){const{gl:t,buffer:i}=this;t.deleteBuffer(i)}}class P{constructor(t,i,e,s){this.gl=t,this.drawBuffers=[],this.elemBuffer=null;const r=t.createVertexArray();if(!r)throw Error("Unable to create VertexArrayObject!");if(this.vao=r,i&&e){if(t.bindVertexArray(r),this.drawBuffers=e.map((e=>{const s=new _(t,e.dataView,{target:e.target,usage:e.usage});return s.bind(),e.defineAttributes(t,i),s})),s){const i=new _(t,s,{target:"ELEMENT_ARRAY_BUFFER"});i.bind(),this.elemBuffer=i}t.bindVertexArray(null)}}bind(){this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}delete(){const{gl:t,vao:i,drawBuffers:e,elemBuffer:s}=this;t.deleteVertexArray(i),e.forEach((t=>t.delete())),s&&s.delete()}}class T{constructor(t,i={}){var e;this.canvas=t,this.painters=new x,this.isPlaying=!1,this.requestAnimationFrame=-1,this.lastTime=-1,this.paint=()=>{window.cancelAnimationFrame(this.requestAnimationFrame),this.requestAnimationFrame=window.requestAnimationFrame(this.actualPaint)},this.actualPaint=t=>{const{lastTime:i}=this;if(i<0)return this.lastTime=t,void this.paint();const e=t-this.lastTime;this.lastTime=t,this.painters.paint(t,e),this.painters.update(t,e),this.isPlaying&&this.paint()};const s=t.getContext("webgl2",i);if(!s)throw Error("Unable to create a WebGL2 context!");this.gl=s,this.programs=new g(new A(s));const r=null!==(e=i.onResize)&&void 0!==e?e:z;this.observer=new ResizeObserver((()=>{r(s,t.clientWidth,t.clientHeight)})),this.observer.observe(t)}get width(){return this.gl.drawingBufferWidth}get height(){return this.gl.drawingBufferHeight}get playing(){return this.isPlaying}set playing(t){t!==this.isPlaying&&(t&&this.paint(),this.isPlaying=t)}play(){this.playing=!0}pause(){this.playing=!1}add(...t){this.painters.add(...t)}remove(...t){this.painters.remove(...t)}createBuffer(t,i){return new _(this.gl,t,i)}createVAO(t,i,e){return new P(this.gl,t,i,e)}destroy(){window.cancelAnimationFrame(this.requestAnimationFrame),this.playing=!1,this.painters.delete(),this.observer.unobserve(this.canvas)}}function z(t,i,e){const s=t.canvas;s.width=i,s.height=e,t.viewport(0,0,i,e)}class M{constructor(){this.keys=new Set,this.attached=!1,this.handleKeyDown=t=>{this.keys.add(t.key)},this.handleKeyUp=t=>{this.keys.delete(t.key)},document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),this.attached=!0}detach(){this.attached&&(document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.attached=!1)}isPressed(...t){for(const i of t)if(!this.keys.has(i))return!1;return!0}}class U{constructor(t){this.options=t,this.start={x:0,y:0,t:0},this.current={x:0,y:0,t:0},this.previous={x:0,y:0,t:0},this.canvas=null,this.active=!1,this.canvasX=0,this.canvasY=0,this.screenX=0,this.screenY=0,this.handleCanvasWheel=t=>{const{onZoom:i}=this.options;i&&i(t.deltaY,(()=>t.preventDefault()))},this.handleCanvasPointerDown=t=>{this.canvasX=t.clientX,this.canvasY=t.clientY,this.active=!0},this.handlePointerDown=t=>{var i,e;if(!this.active)return;this.screenX=t.clientX,this.screenY=t.clientY;const s=this.getPoint(t);this.start=this.current=s,null===(e=(i=this.options).onMoveStart)||void 0===e||e.call(i,s)},this.handlePointerMove=t=>{var i,e;this.active&&this.canvas&&(this.previous=this.current,this.current=this.getPoint(t),null===(e=(i=this.options).onMove)||void 0===e||e.call(i,this))},this.handlePointerUp=t=>{var i,e;this.active&&(null===(e=(i=this.options).onMoveEnd)||void 0===e||e.call(i,this.getPoint(t)),this.active=!1)},t.canvas&&this.attach(t.canvas)}get element(){return this.canvas}attach(t){this.detach(),this.canvas=t,t.addEventListener("pointerdown",this.handleCanvasPointerDown,!0),t.addEventListener("wheel",this.handleCanvasWheel),document.addEventListener("pointerdown",this.handlePointerDown),document.addEventListener("pointermove",this.handlePointerMove),document.addEventListener("pointerup",this.handlePointerUp)}detach(){const{canvas:t}=this;t&&(t.removeEventListener("pointerdown",this.handleCanvasPointerDown),t.removeEventListener("wheel",this.handleCanvasWheel),document.removeEventListener("pointerdown",this.handlePointerDown),document.removeEventListener("pointermove",this.handlePointerMove),document.removeEventListener("pointerup",this.handlePointerUp),this.canvas=null)}getPoint(t){if(!this.canvas)throw Error("No canvas has been defined!");const{left:i,top:e,width:s,height:r}=this.canvas.getBoundingClientRect();return{x:2*((this.canvasX+t.clientX-this.screenX-i)/s-.5),y:-2*((this.canvasY+t.clientY-this.screenY-e)/r-.5),t:t.timeStamp}}}class R{constructor(t){this.camera=t,this.pointer=null,this.keyboard=new M,this.handleMoveStart=({x:t,y:i,t:e})=>{},this.handleMove=t=>{const{camera:i,keyboard:e}=this,s=t.current.t-t.previous.t;if(s<=0)return;if(e.isPressed("z")){const e=t.previous.x,s=t.previous.y;if(Math.abs(e)+Math.abs(s)===0)return;const r=t.current.x,n=t.current.y;if(Math.abs(r)+Math.abs(n)===0)return;const o=e*r+s*n,h=e*n-s*r,a=Math.atan2(h,o);return void i.orbitAroundZ(-a)}const r=25/s,n=(t.current.x-t.previous.x)*r,o=(t.current.y-t.previous.y)*r;e.isPressed("x")||i.orbitAroundY(-n),e.isPressed("y")||i.orbitAroundX(o)},this.handleZoom=(t,i)=>{const{camera:e}=this,s=.001*-t;e.zoom=Math.max(1,e.zoom+s),i()}}attach(t){this.pointer&&this.pointer.detach(),this.pointer=new U({canvas:t,onMoveStart:this.handleMoveStart,onMove:this.handleMove,onZoom:this.handleZoom})}detach(){this.pointer&&(this.pointer.detach(),this.pointer=null)}}class L{constructor(t,i={}){var e,s,r;this.data=null,this.count=0,this.target=null!==(e=i.target)&&void 0!==e?e:"ARRAY_BUFFER",this.usage=null!==(s=i.usage)&&void 0!==s?s:"STATIC_DRAW";const n=null!==(r=i.divisor)&&void 0!==r?r:0;let o=0;const h={},a={};for(const i of Object.keys(t)){const e=i;h[i]=new ArrayBuffer(0);const s={dimension:N[t[e]],bytesOffset:o,bytesPerElement:Float32Array.BYTES_PER_ELEMENT,divisor:n,getter:(t,i)=>(i>=t.byteLength&&(i%=t.byteLength),t.getFloat32(i)),setter(t,i,e){t.setFloat32(i,e)}};a[i]=s,o+=s.bytesPerElement*s.dimension}this.dataPerAttribute=h,this.definitions=a,this.stride=o}set(t,i){var e;if((e=i)&&"object"==typeof e&&i.buffer instanceof ArrayBuffer&&(i=i.buffer),this.dataPerAttribute[t]===i)return;this.dataPerAttribute[t]=i;const{bytesPerElement:s,dimension:r}=this.definitions[t];this.count=Math.max(this.count,Math.ceil(i.byteLength/(s*r))),this.data=null}get dataView(){if(!this.data){const t=new ArrayBuffer(this.stride*this.count),i=new DataView(t);let e=0;const{dataPerAttribute:s,definitions:r}=this;for(let t=0;t<this.count;t++)for(const n of Object.keys(r)){const o=r[n],h=s[n],a=new DataView(h);let c=o.bytesPerElement*o.dimension*t;for(let t=0;t<o.dimension;t++)o.setter(i,e,o.getter(a,c)),c+=o.bytesPerElement,e+=o.bytesPerElement}this.data=new DataView(t)}return this.data}defineAttributes(t,i){let e=0;const{definitions:s}=this;for(const r of Object.keys(s)){const n=s[r],o=i.getAttribLocation(r);t.enableVertexAttribArray(o),t.vertexAttribPointer(o,n.dimension,t.FLOAT,!1,this.stride,e),t.vertexAttribDivisor(o,n.divisor),e+=n.dimension*n.bytesPerElement}}}const N={float:1,vec2:2,vec3:3,vec4:4};class I{}class S{constructor(t,i,{x:e=0,y:s=0,z:r=1,zoom:n=1}={}){this.context=t,this.zoom=1,this.x=0,this.y=0,this.z=1,this.x=e,this.y=s,this.z=r,this.zoom=n,this.texture=i,this.program=t.programs.create({vert:"#version 300 es\n\nuniform float uniZoom;\nuniform vec2 uniScale;\nuniform vec2 uniScroll;\nuniform float uniZ;\nin vec2 attPoint;\nin vec2 attUV;\nout vec2 varUV;\n\nvoid main() {\n    varUV = (attUV + uniScroll) * uniZoom;\n    float x = uniScale.x * attPoint.x;\n    float y = uniScale.y * attPoint.y;\n    gl_Position = vec4(x, y, uniZ, 1.0);\n}",frag:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D uniTexture;\nin vec2 varUV;\nout vec4 FragColor;\n\nvoid main() {\n    FragColor = texture(uniTexture, varUV);\n}"});const o=new L({attPoint:"vec2",attUV:"vec2"});o.set("attPoint",new Float32Array([-1,1,1,1,-1,-1,1,-1])),o.set("attUV",new Float32Array([0,0,1,0,0,1,1,1])),this.vao=t.createVAO(this.program,[o])}delete(){const{vao:t}=this;t.delete}paint(t,i){const{gl:e}=this.context,{vao:s,program:r,texture:n,zoom:o,x:h,y:a,z:c}=this;r.use();const{width:u,height:m}=this.context,l=n.width*m>n.height*u,d=l?n.width*m/(u*n.height):1,f=l?1:n.height*u/(m*n.width);r.uniform2f("uniScale",d,f),r.uniform2f("uniScroll",h,a),r.uniform1f("uniZoom",1/o),r.uniform1f("uniZ",c),n.activate(r,"uniTexture"),s.bind(),e.drawArrays(e.TRIANGLE_STRIP,0,4)}update(t,i){}}class F{constructor(t,i={}){var e,s;this.context=t,this.clearMask=0,this.red=1,this.green=.7,this.blue=0,this.alpha=1,this.depth=1;const{gl:r}=t,n=null!==(e=i.color)&&void 0!==e?e:[0,0,0,1],o=null!==(s=i.depth)&&void 0!==s?s:1;this.clearMask=0;let h=!1;if(i.color&&(this.clearMask|=r.COLOR_BUFFER_BIT,h=!0),"number"==typeof i.depth&&(this.clearMask|=r.DEPTH_BUFFER_BIT,h=!0),!h)throw Error("[TgdPainterClear] You must give at least a color or a depth in the constructor!");[this.red,this.green,this.blue,this.alpha]=n,this.depth=o}delete(){}paint(t,i){const{clearMask:e,context:s,red:r,green:n,blue:o,alpha:h,depth:a}=this,{gl:c}=s;c.clearColor(r,n,o,h),c.clearDepth(a),c.clear(e)}update(t,i){}}class X{constructor(t){this.logicFunction=t}delete(){}paint(t,i){}update(t,i){this.logicFunction(t,i)}}class j{constructor(){this.name="Mesh",this.attPosition=[],this.attNormal=[],this.attUV=[],this.elements=[],this.elementIndex=0,this.vertices=[],this.normals=[],this.uvs=[],this.map=new Map,this.onObject=t=>{this.name=t},this.onVertex=(t,i,e)=>{this.vertices.push([t,i,e])},this.onNormal=(t,i,e)=>{this.normals.push([t,i,e])},this.onTexture=(t,i)=>{this.uvs.push([t,i])},this.onFace=t=>{if(3!==t.length)throw Error("We can only deal with triangles!");t.forEach((t=>this.elements.push(this.getElem(t))))}}parse(t){this.reset();const{onVertex:i,onNormal:e,onTexture:s,onFace:r,onObject:n,name:o,elements:h}=this;!function(t,i={}){const{onVertex:e,onNormal:s,onTexture:r,onFace:n,onObject:o}=i;for(const i of function*(t){const i=t.length;let e=0,s=0;for(;e>-1&&e<i&&(e=t.indexOf("\n",s),!(e<0));)yield t.substring(s,e).trim(),s=e+1;return t.substring(s).trim()}(t)){const t=i.trimStart();if(e&&t.startsWith("v ")){const i=t.substring(2).split(" ").map((t=>Number(t)));Y(i)&&e(...i)}else if(n&&t.startsWith("f "))n(t.substring(2).split(" ").map((t=>{const[i,e,s]=t.split("/");return{vertex:Number(i)-1,normal:s?Number(s)-1:void 0,uv:e?Number(e)-1:void 0}})));else if(s&&t.startsWith("vn ")){const i=t.substring(3).split(" ").map((t=>Number(t)));Y(i)&&s(...i)}else if(r&&t.startsWith("vt ")){const[i,e,s]=t.substring(3).split(" ").map((t=>Number(t)));r(i,e,s)}else o&&t.startsWith("o ")&&o(t.substring(2))}}(t,{onVertex:i,onNormal:e,onTexture:s,onFace:r,onObject:n});const a={name:o,count:Math.floor(h.length/3),attPosition:new Float32Array(this.attPosition)};this.attNormal.length>0&&(a.attNormal=new Float32Array(this.attNormal)),this.attUV.length>0&&(a.attUV=new Float32Array(this.attUV)),console.log("🚀 [wavefront] this.attUV = ",this.attUV);const{elementIndex:c}=this;return c<=256?(console.log("UNSIGNED_BYTE"),Object.assign(Object.assign({},a),{type:"UNSIGNED_BYTE",elements:new Uint8Array(h)})):c<=65536?(console.log("UNSIGNED_SHORT"),Object.assign(Object.assign({},a),{type:"UNSIGNED_SHORT",elements:new Uint16Array(h)})):(console.log("UNSIGNED_INT"),Object.assign(Object.assign({},a),{type:"UNSIGNED_INT",elements:new Uint32Array(h)}))}reset(){this.name="Mesh",this.attPosition=[],this.attNormal=[],this.attUV=[],this.elements=[],this.elementIndex=0,this.vertices=[],this.normals=[],this.uvs=[],this.map.clear()}getElem(t){var i;const e=this.key(t),s=null!==(i=this.map.get(e))&&void 0!==i?i:-1;if(s>-1)return s;const[r,n,o]=this.vertices[t.vertex];if(this.attPosition.push(r,n,o),"number"==typeof t.normal){const[i,e,s]=this.normals[t.normal];this.attNormal.push(i,e,s)}if("number"==typeof t.uv){const[i,e]=this.uvs[t.uv];this.attUV.push(i,e)}return this.map.set(e,this.elementIndex),this.elementIndex++}key(t){return`${t.vertex}/${t.normal}`}}function Y(t){return 3===t.length}var D=function(t,i,e,s){return new(e||(e=Promise))((function(r,n){function o(t){try{a(s.next(t))}catch(t){n(t)}}function h(t){try{a(s.throw(t))}catch(t){n(t)}}function a(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(o,h)}a((s=s.apply(t,i||[])).next())}))};class V{static image(t){return D(this,void 0,void 0,(function*(){return new Promise((i=>{const e=new Image;e.onload=()=>i(e),e.onerror=()=>{console.error("Unable to load image: ",t),i(null)},e.src=t}))}))}static canvas(t){return D(this,void 0,void 0,(function*(){const i=yield V.image(t);if(!i)return null;const e=document.createElement("canvas");e.width=i.naturalWidth,e.height=i.naturalHeight;const s=e.getContext("2d");if(!s)throw Error("Unable to get a 2D context!");return s.drawImage(i,0,0),e}))}}class k{constructor(t,i={}){this.context=t,this._width=0,this._height=0,this._image=null;const{gl:e}=t;this.options=Object.assign({wrapS:"REPEAT",wrapT:"REPEAT",wrapR:"REPEAT",minFilter:"NEAREST_MIPMAP_LINEAR",magFilter:"LINEAR"},i);const s=e.createTexture();if(!s)throw Error("Unable to create a WebGLTexture!");this.texture=s,e.bindTexture(e.TEXTURE_2D,s);const{wrapS:r,wrapT:n,wrapR:o,minFilter:h,magFilter:a}=this.options;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e[r]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e[n]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_R,e[o]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e[h]),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e[a]),i.image&&this.loadImage(i.image)}get image(){return this._image}get width(){return this._width}get height(){return this._height}bind(){const{gl:t}=this.context;t.bindTexture(t.TEXTURE_2D,this.texture)}activate(t,i,e=0){const{context:s,texture:r}=this,{gl:n}=s;n.activeTexture(n.TEXTURE0+e),n.bindTexture(n.TEXTURE_2D,r),t.uniform1i(i,e)}loadImage(t){if("string"==typeof t)return void V.image(t).then((i=>{i?this.loadImage(i):console.error("[TgdTexture2D]Unable to load image:",t)})).catch(console.error);const{context:i,texture:e}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_2D,e),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!0),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t),s.generateMipmap(s.TEXTURE_2D),this._width=t.width,this._height=t.height,this._image=t,this.context.paint()}}var Z=r.OE,O=r.QF,W=r.op,B=r._G,C=r.ED,G=r.sT,$=r.ck,q=r.Wk,K=r.cL,H=r.mI,Q=r.aW,J=r.yo}}]);