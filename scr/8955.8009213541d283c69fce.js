"use strict";(self.webpackChunk_tolokoban_tgd=self.webpackChunk_tolokoban_tgd||[]).push([[8955],{5290:(n,e,t)=>{t.r(e),t.d(e,{default:()=>b});var a=t(4848),s=t(8453),r=t(6540),i=t(5968),l=t(2212),c=t(4461),o=t(6989),d=t(4859);const h=t.p+"bin/ring.9d185b8088f5442e28c1.glb";var u=t(1278);function g(n,e){const t=new c.xNY({transfo:{distance:3},far:100,near:.01,fovy:Math.PI/4,zoom:1});n.camera=t,new c.pwt(n,{speedPanning:0,inertiaOrbit:1e3}),n.add(new c.o57(n,{depth:1,stencil:0}),new c.b6h(n,{texture:new c.HTX(n).loadBitmap(d)}),new c.Ipk(n,{color:!1,depth:c.Eg5.off,cull:c.TfJ.back,stencil:c.d7A.write(1),children:[new c.dRj(n,{asset:e.glb.ring,materialFactory:()=>new c.M3Z})]}),new c.Ipk(n,{depth:c.Eg5.less,cull:c.TfJ.back,stencil:c.d7A.paintIfEqual(0),children:[new c.dRj(n,{asset:e.glb.suzanne})]})),n.paint()}function p(){return(0,a.jsx)(o.A,{onReady:g,options:{depth:!0,stencil:!0,antialias:!0},assets:{glb:{suzanne:u,ring:h}}})}const w={"Detail #1":"    const camera = new TgdCameraPerspective({\n        transfo: { distance: 3 },\n        far: 100,\n        near: 0.01,\n        fovy: Math.PI / 4,\n        zoom: 1,\n    })\n    ctx.camera = camera\n    new TgdControllerCameraOrbit(ctx, {\n        speedPanning: 0,\n        inertiaOrbit: 1000,\n    })\n    ctx.add(\n        new TgdPainterClear(ctx, {\n            depth: 1,\n            stencil: 0,\n        }),\n        new TgdPainterBackground(ctx, {\n            texture: new TgdTexture2D(ctx).loadBitmap(BackgroundURL),\n        }),\n        new TgdPainterState(ctx, {\n            color: false,\n            depth: webglPresetDepth.off,\n            cull: webglPresetCull.back,\n            stencil: webglPresetStencil.write(1),\n            children: [\n                new TgdPainterMeshGltf(ctx, {\n                    asset: assets.glb.ring,\n                    materialFactory: () => new TgdMaterialSolid(),\n                }),\n            ],\n        }),\n        new TgdPainterState(ctx, {\n            depth: webglPresetDepth.less,\n            cull: webglPresetCull.back,\n            stencil: webglPresetStencil.paintIfEqual(0),\n            children: [\n                new TgdPainterMeshGltf(ctx, {\n                    asset: assets.glb.suzanne,\n                }),\n            ],\n        })\n    )\n    ctx.paint()"},x='import {\n    TgdCameraPerspective,\n    TgdContext,\n    TgdControllerCameraOrbit,\n    TgdMaterialSolid,\n    TgdPainterBackground,\n    TgdPainterClear,\n    TgdPainterDebugStencil,\n    TgdPainterMeshGltf,\n    TgdPainterState,\n    TgdTexture2D,\n    webglPresetCull,\n    webglPresetDepth,\n    webglPresetStencil,\n} from "@tolokoban/tgd"\nimport View, { Assets } from "@/components/demo/Tgd"\n\nimport BackgroundURL from "@/assets/image/dino.webp"\nimport RingURL from "@/assets/mesh/ring.glb"\nimport SuzanneURL from "@/assets/mesh/suzanne.glb"\n\nfunction init(ctx: TgdContext, assets: Assets) {\n    const camera = new TgdCameraPerspective({\n        transfo: { distance: 3 },\n        far: 100,\n        near: 0.01,\n        fovy: Math.PI / 4,\n        zoom: 1,\n    })\n    ctx.camera = camera\n    new TgdControllerCameraOrbit(ctx, {\n        speedPanning: 0,\n        inertiaOrbit: 1000,\n    })\n    ctx.add(\n        new TgdPainterClear(ctx, {\n            depth: 1,\n            stencil: 0,\n        }),\n        new TgdPainterBackground(ctx, {\n            texture: new TgdTexture2D(ctx).loadBitmap(BackgroundURL),\n        }),\n        new TgdPainterState(ctx, {\n            color: false,\n            depth: webglPresetDepth.off,\n            cull: webglPresetCull.back,\n            stencil: webglPresetStencil.write(1),\n            children: [\n                new TgdPainterMeshGltf(ctx, {\n                    asset: assets.glb.ring,\n                    materialFactory: () => new TgdMaterialSolid(),\n                }),\n            ],\n        }),\n        new TgdPainterState(ctx, {\n            depth: webglPresetDepth.less,\n            cull: webglPresetCull.back,\n            stencil: webglPresetStencil.paintIfEqual(0),\n            children: [\n                new TgdPainterMeshGltf(ctx, {\n                    asset: assets.glb.suzanne,\n                }),\n            ],\n        })\n    )\n    ctx.paint()\n}\n\nexport default function Demo() {\n    return (\n        <View\n            onReady={init}\n            options={{\n                depth: true,\n                stencil: true,\n                antialias: true,\n            }}\n            assets={{\n                glb: {\n                    suzanne: SuzanneURL,\n                    ring: RingURL,\n                },\n            }}\n        />\n    )\n}\n';function f(){const[n,e]=r.useState(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"half-left",children:(0,a.jsx)(p,{})}),(0,a.jsxs)("div",{className:"half-right",children:[(0,a.jsx)("div",{children:(0,a.jsx)(i.yQN,{variant:"elevated",onClick:()=>e(!n),children:n?"Show code details":"Show full code"})}),(0,a.jsx)(l.A,{language:"tsx",value:n?x:w})]})]})}function m(n){const e={a:"a",h1:"h1",hr:"hr",li:"li",ol:"ol",p:"p",...(0,s.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h1,{children:"Stencil"}),"\n",(0,a.jsx)(e.p,{children:"Here is a demo of a simple masking technique done with stencils."}),"\n",(0,a.jsx)(e.p,{children:"This render has three passes:"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsx)(e.li,{children:"Paint the background"}),"\n",(0,a.jsx)(e.li,{children:"Paint an invisible ring that will set the stencil."}),"\n",(0,a.jsx)(e.li,{children:"Use the stencil to know where to paint the monkey."}),"\n"]}),"\n",(0,a.jsx)(f,{}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.a,{href:"#/articles/state",children:"Back"})})]})}function b(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(m,{...n})}):m(n)}},3469:(n,e,t)=>{t.d(e,{A:()=>l});var a=t(1601),s=t.n(a),r=t(6314),i=t.n(r)()(s());i.push([n.id,".hgIjhDQIuBCJEQ4ZgLXp {\n    display: inline-block;\n    margin: 1em;\n}\n\n.hgIjhDQIuBCJEQ4ZgLXp canvas {\n    box-shadow: 0 0.25em 0.5em #fff1;\n    max-width: 100vw;\n    max-height: 100vh;\n}\n\n.efOyHCihw9wfMB6AaAqw {\n    position: relative;\n}\n\n.ywC8N0Uxbvm2Ug2DwPkE {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    background-color: var(--theme-color-primary-1);\n    opacity: 0;\n    transition: opacity 0.3s;\n}\n\n.ywC8N0Uxbvm2Ug2DwPkE.PBWSRsbiwEqGpeL0hEfm {\n    opacity: 1;\n}\n\n.BErChOLWGtciKhh3IFud {\n    position: relative;    \n}\n\n.BErChOLWGtciKhh3IFud > canvas.fT7FcYouYlPbElIAEXRP {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n}\n\n.BErChOLWGtciKhh3IFud > canvas.uAPfWt_Dhe7RaRrnmIu0 {\n    position: absolute;\n    right: 0;\n    top: 0;\n    width: 128px;\n    height: 128px;\n    box-shadow: none;\n    border: none;\n}",""]),i.locals={Tgd:"hgIjhDQIuBCJEQ4ZgLXp",relative:"efOyHCihw9wfMB6AaAqw",overlay:"ywC8N0Uxbvm2Ug2DwPkE",loading:"PBWSRsbiwEqGpeL0hEfm",screen:"BErChOLWGtciKhh3IFud",canvas:"fT7FcYouYlPbElIAEXRP",gizmo:"uAPfWt_Dhe7RaRrnmIu0"};const l=i},6989:(n,e,t)=>{t.d(e,{A:()=>T});var a=t(4848),s=t(6540),r=t(4461),i=t(5968),l=t(5670),c=t(5072),o=t.n(c),d=t(7825),h=t.n(d),u=t(7659),g=t.n(u),p=t(5056),w=t.n(p),x=t(540),f=t.n(x),m=t(1113),b=t.n(m),v=t(3469),P={};P.styleTagTransform=b(),P.setAttributes=w(),P.insert=g().bind(null,"head"),P.domAPI=h(),P.insertStyleElement=f(),o()(v.A,P);const j=v.A&&v.A.locals?v.A.locals:void 0;function T({className:n,options:e,onReady:t,gizmo:c=!1,width:o="640px",height:d="480px",noBorder:h=!1,assets:u,children:g}){const[p,w]=s.useState(!0),[x,f]=s.useState(!1),m=s.useRef(null),b=s.useRef(null),v=s.useRef(null),P=s.useRef(null),[T,C]=s.useState(!0);let y="auto";o.endsWith("px")&&d.endsWith("px")&&(o.substring(o.length-2),d.substring(d.length-2));const k=n=>{if(!n)return;if(b.current)return;b.current=n;const a=new r.tfp(n,e);m.current=a,C(!0),async function({glb:n,data:e,text:t,image:a}={}){console.log("ðŸš€ [Tgd] glb, data, text, image = ",n,e,t,a);const s={glb:{},data:{},text:{},image:{}},i=[];return a&&Object.keys(a).forEach((n=>{i.push((async()=>{const e=a[n];console.log("Loading image:",e);const t=await(0,r.V_9)(e);t&&(s.image[n]=t)}))})),n&&Object.keys(n).forEach((e=>{i.push((async()=>{const t=n[e];console.log("Loading GLB:",t);const a=await(0,r.TCe)(t);a&&(s.glb[e]=a)}))})),e&&Object.keys(e).forEach((n=>{i.push((async()=>{const t=e[n],a=await(0,r.vSU)(t);a&&(s.data[n]=a)}))})),t&&Object.keys(t).forEach((n=>{i.push((async()=>{const e=t[n],a=await(0,r.jWq)(e);a&&(s.text[n]=a)}))})),await Promise.all(i.map((n=>n()))),s}(u).then((n=>{console.log("Ready!"),t(a,n),a.paint(),C(!1)})).catch((n=>{console.error("Unable to initialize the scene!",n),C(!1)}));const s=v.current;s&&s.attachContext(a)},R=n=>{const e=new r.GbF({canvas:n});v.current=e,e.eventTipClick.addListener((({to:n})=>{const e=m.current;console.log("ðŸš€ [tgd] to, context =",n,e),e&&e.animSchedule({duration:.2,easingFunction:r.Wcc,action:(0,r.vRM)(e.camera,{orientation:n})})}));const t=m.current;t&&e.attachContext(t)};return s.useEffect((()=>{const n=b.current,e=m.current;if(!n||!e)return;const t=new ResizeObserver((()=>e.paint()));return t.observe(n),n.requestFullscreen||(n.requestFullscreen=n.webkitRequestFullscreen),f(Boolean(n.requestFullscreen)),()=>t.unobserve(n)}),[m.current,b.current]),h?(0,a.jsxs)("div",{ref:P,className:j.screen,style:{width:p?o:d,height:p?d:o},children:[(0,a.jsx)("canvas",{className:j.canvas,ref:k}),c&&(0,a.jsx)("canvas",{className:j.gizmo,ref:R})]}):(0,a.jsxs)("div",{className:i.Sxu.classNames.join(n,j.Tgd),children:[(0,a.jsxs)(i.sWC,{display:"flex",justifyContent:"space-between",children:[(0,a.jsx)(i.yQN,{variant:"elevated",onClick:()=>w(!p),enabled:!T,children:p?"Switch to Portrait":"Switch to Landscape"}),x&&(0,a.jsx)(i.yQN,{variant:"elevated",onClick:()=>{const n=P.current;n&&n.requestFullscreen()},enabled:!T,children:"Fullscreen"})]}),(0,a.jsxs)("div",{className:j.relative,children:[(0,a.jsxs)("div",{ref:P,className:j.screen,style:{width:p?o:d,height:p?d:o},children:[(0,a.jsx)("canvas",{className:j.canvas,ref:k}),c&&(0,a.jsx)("canvas",{className:j.gizmo,ref:R})]}),(0,a.jsx)("div",{className:i.Sxu.classNames.join(j.overlay,T&&j.loading),children:(0,a.jsx)(l.A,{})}),g]})]})}},4859:(n,e,t)=>{n.exports=t.p+"img/dino.a892a1760dcaac9618a1.webp"},1278:(n,e,t)=>{n.exports=t.p+"bin/suzanne.d3b099acbd7623177bf6.glb"},8453:(n,e,t)=>{t.d(e,{R:()=>r});var a=t(6540);const s=a.createContext({});function r(n){const e=a.useContext(s);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}}}]);