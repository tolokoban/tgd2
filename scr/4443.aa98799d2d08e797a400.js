"use strict";(self.webpackChunk_tolokoban_tgd=self.webpackChunk_tolokoban_tgd||[]).push([[4443],{1710:(t,e,r)=>{r.r(e),r.d(e,{default:()=>M});var a=r(4848),i=r(6540),n=r(7289),o=r(3608),s=r(5667);const c=new Uint8Array([0,1,0,2,0,4,1,3,1,5,2,3,2,6,3,7,4,5,4,6,5,7,6,7]),l=-1,u=new Float32Array([l,l,l,l,l,1,l,1,l,l,1,1,1,l,l,1,l,1,1,1,l,1,1,1]),d=[];for(let t=0;t<c.length;t+=2){const e=3*c[t],r=3*c[t+1],a=.5*(u[e+0]+u[r+0]),i=.5*(u[e+1]+u[r+1]),n=.5*(u[e+2]+u[r+2]);d.push(a,i,n)}const g=new Float32Array(d);function h(t){const e=[];for(const r of t.trim().toUpperCase())r<"A"||r>"L"||e.push(r.charCodeAt(0)-"A".charCodeAt(0));return e}function m(t){const e=[];for(let r=0;r<8;r++){const a=1<<r;e.push(t&a?1:0)}return e}class x extends s.TgdPainter{constructor(t){super(),this.context=t,this.dataset=this.createDataset(),this.program=this.createProgram();const e=c;this.vao=new s.TgdVertexArray(t.gl,this.program,[this.dataset],e)}delete(){this.program.delete(),this.vao.delete()}paint(){const{context:t,program:e,vao:r}=this,{gl:a,camera:i}=t;e.use(),e.uniformMatrix4fv("uniModelViewMatrix",i.matrixModelView),e.uniformMatrix4fv("uniProjectionMatrix",i.matrixProjection),r.bind(),a.drawElements(a.LINES,24,a.UNSIGNED_BYTE,0),r.unbind()}createDataset(){const t=new s.TgdDataset({attPoint:"vec3"});return t.set("attPoint",u),t}createProgram(){const t=new s.TgdShaderVertex({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4"},attributes:{attPoint:"vec4"},varying:{varColor:"vec3"},mainCode:["varColor = abs(attPoint.xyz);","gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;"]}).code,e=new s.TgdShaderFragment({uniforms:{uniTexture:"sampler2D"},varying:{varColor:"vec3"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(varColor, 1.0);"]}).code;return new s.TgdProgram(this.context.gl,{vert:t,frag:e})}}class f extends s.TgdPainter{constructor(t){super(),this.context=t,this._caseNumber=0,this.dataset=this.createDataset(),this.program=this.createProgram(),this.vao=new s.TgdVertexArray(t.gl,this.program,[this.dataset]),this.texture=this.createTexture()}get caseNumber(){return this._caseNumber}set caseNumber(t){if(t===this._caseNumber)return;this._caseNumber=t;const e=m(t),r=[];for(let t=0;t<12;t++){const a=e[c[2*t]],i=e[c[2*t+1]];r.push(a===i?0:1)}this.dataset.set("attVisible",new Float32Array(r)),this.vao.updateDataset(this.dataset),this.context.paint()}delete(){this.texture.delete(),this.program.delete(),this.vao.delete()}paint(){const{context:t,program:e,vao:r,texture:a}=this,{gl:i,camera:n}=t;e.use(),a.activate(0,e,"uniTexture"),e.uniform1f("uniHalfScreenHeightInPixels",.5*t.height),e.uniformMatrix4fv("uniModelViewMatrix",n.matrixModelView),e.uniformMatrix4fv("uniProjectionMatrix",n.matrixProjection),r.bind(),i.drawArrays(i.POINTS,0,12),r.unbind()}createDataset(){const t=new s.TgdDataset({attPoint:"vec3",attVisible:"float"});return t.set("attPoint",g),t}createProgram(){const t=new s.TgdShaderVertex({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniHalfScreenHeightInPixels:"float"},attributes:{attPoint:"vec4",attVisible:"float"},varying:{varU:"float"},mainCode:["varU = float(gl_VertexID) / 12.0;","gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;","gl_PointSize = 0.2 * uniHalfScreenHeightInPixels / gl_Position.w;","gl_PointSize *= attVisible;"]}).code,e=new s.TgdShaderFragment({uniforms:{uniTexture:"sampler2D"},varying:{varU:"float"},outputs:{FragColor:"vec4"},mainCode:["vec2 uv = vec2(varU, 0.0) + gl_PointCoord.xy * vec2(1.0 / 12.0, 1.0);","FragColor = texture(uniTexture, uv);","if (FragColor.a < .1) discard;"]}).code;return new s.TgdProgram(this.context.gl,{vert:t,frag:e})}createTexture(){const t=new s.TgdTexture2D(this.context);t.setParams({magFilter:"LINEAR",minFilter:"LINEAR"});const{ctx:e,canvas:r}=(0,s.tgdCanvasCreateWithContext2D)(768,64);e.font="bold 64px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#0f0";for(let t=0;t<12;t++){const r="ABCDEFGHIJKL".charAt(t),a=(t+.5)/12,i=.5;e.fillText(r,768*a,64*i)}return t.loadBitmap(r),t}}class P extends s.TgdPainter{constructor(t){super(),this.context=t,this._caseNumber=-1,this.dataset=this.createDataset(),this.program=this.createProgram(),this.vao=new s.TgdVertexArray(t.gl,this.program,[this.dataset]),this.texture=this.createTexture(),this.caseNumber=0}get caseNumber(){return this._caseNumber}set caseNumber(t){if(t===this._caseNumber)return;this._caseNumber=t;const e=m(t);this.dataset.set("attColor",new Float32Array(e)),this.vao.updateDataset(this.dataset),this.context.paint()}delete(){this.texture.delete(),this.program.delete(),this.vao.delete()}paint(){const{context:t,program:e,vao:r,texture:a}=this,{gl:i,camera:n}=t;e.use(),a.activate(0,e,"uniTexture"),e.uniform1f("uniHalfScreenHeightInPixels",.5*t.height),e.uniformMatrix4fv("uniModelViewMatrix",n.matrixModelView),e.uniformMatrix4fv("uniProjectionMatrix",n.matrixProjection),r.bind(),i.drawArrays(i.POINTS,0,8),r.unbind()}createDataset(){const t=new s.TgdDataset({attPoint:"vec3",attColor:"float"});return t.set("attPoint",u),t.set("attColor",new Float32Array(u.length)),t}createProgram(){const t=new s.TgdShaderVertex({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniHalfScreenHeightInPixels:"float"},attributes:{attPoint:"vec4",attColor:"float"},varying:{varColor:"float"},mainCode:["varColor = attColor;","gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;","gl_PointSize = 0.2 * uniHalfScreenHeightInPixels / gl_Position.w;"]}).code,e=new s.TgdShaderFragment({uniforms:{uniTexture:"sampler2D"},varying:{varColor:"float"},outputs:{FragColor:"vec4"},mainCode:["vec2 pos = 2.0 * (gl_PointCoord.xy - vec2(.5));","float radius = dot(pos, pos);","if (radius > 1.0) discard;","vec2 uv = vec2(varColor, .5);","FragColor = texture(uniTexture, uv);"]}).code;return new s.TgdProgram(this.context.gl,{vert:t,frag:e})}createTexture(){const t=new s.TgdTexture2D(this.context);return t.setParams({magFilter:"NEAREST",minFilter:"NEAREST",wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE"}),t.loadBitmap((0,s.tgdCanvasCreatePalette)(["#07f","#f00"])),t}}class v extends s.TgdPainter{constructor(t){super(),this.context=t,this.elementsCount=0,this._triangles="",this.dataset=this.createDataset(),this.program=this.createProgram();const e=new Uint8Array;this.vao=new s.TgdVertexArray(t.gl,this.program,[this.dataset],e)}set triangles(t){const e=h(t);this.vao.updateElements(e),this.elementsCount=e.length,this.context.paint()}delete(){this.program.delete(),this.vao.delete()}paint(){const{context:t,program:e,vao:r,elementsCount:a}=this,{gl:i,camera:n}=t;e.use(),e.uniformMatrix4fv("uniModelViewMatrix",n.matrixModelView),e.uniformMatrix4fv("uniProjectionMatrix",n.matrixProjection),r.bind(),i.drawElements(i.TRIANGLES,a,i.UNSIGNED_BYTE,0),r.unbind()}createDataset(){const t=new s.TgdDataset({attPoint:"vec3"});return t.set("attPoint",g),t}createProgram(){const t=new s.TgdShaderVertex({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniLight:"float"},attributes:{attPoint:"vec4"},mainCode:["gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;"]}).code,e=new s.TgdShaderFragment({uniforms:{uniTexture:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["float a = 1.0;","FragColor = vec4(","  .8 * (gl_FrontFacing ? vec3(0, .5, 1) : vec3(1, 0, 0)),","  a",");"]}).code;return new s.TgdProgram(this.context.gl,{vert:t,frag:e})}}class p extends s.TgdPainter{constructor(t){super(),this.context=t,this.elementsCount=0,this.dataset=this.createDataset(),this.program=this.createProgram();const e=new Uint8Array;this.vao=new s.TgdVertexArray(t.gl,this.program,[this.dataset],e)}set triangles(t){const e=h(t),r=[];for(let t=0;t<e.length;t+=3){const a=e[t],i=e[t+1],n=e[t+2];r.push(a,i,n,a)}this.vao.updateElements(r),this.elementsCount=r.length,this.context.paint()}delete(){this.program.delete(),this.vao.delete()}paint(){const{context:t,program:e,vao:r,elementsCount:a}=this,{gl:i,camera:n}=t;e.use(),e.uniformMatrix4fv("uniModelViewMatrix",n.matrixModelView),e.uniformMatrix4fv("uniProjectionMatrix",n.matrixProjection),r.bind(),i.drawElements(i.LINES,a,i.UNSIGNED_BYTE,0),r.unbind()}createDataset(){const t=new s.TgdDataset({attPoint:"vec3"});return t.set("attPoint",g),t}createProgram(){const t=new s.TgdShaderVertex({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniLight:"float"},attributes:{attPoint:"vec4"},mainCode:["gl_Position = uniProjectionMatrix * ","  (uniModelViewMatrix * attPoint + vec4(0, 0, 0.02, 0));"]}).code,e=new s.TgdShaderFragment({uniforms:{uniTexture:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(0,0,0,1);"]}).code;return new s.TgdProgram(this.context.gl,{vert:t,frag:e})}}class w{constructor(){this._context=null,this.midPointsPainter=null,this.cornersPainter=null,this.trianglesPainter=null,this.wireframePainter=null}set context(t){const{camera:e}=t;e instanceof s.TgdCameraPerspective&&(e.fovy=(0,s.tgdCalcDegToRad)(90),e.transfo.distance=3),new s.TgdControllerCameraOrbit(t,{inertiaOrbit:1e3}),this._context&&this._context.delete(),this._context=t;const r=new s.TgdPainterClear(t,{color:[0,0,0,1],depth:1}),a=new s.TgdPainterState(t,{depth:s.webglPresetDepth.less,cull:s.webglPresetCull.off}),i=new p(t);this.wireframePainter=i;const n=new f(t);this.midPointsPainter=n;const o=new P(t);this.cornersPainter=o;const c=new v(t);this.trianglesPainter=c,a.add(new x(t),i,new s.TgdPainterState(t,{blend:s.webglPresetBlend.premultipliedAlpha,children:[n,o,c]})),t.add(r,a),t.paint()}set caseNumber(t){const{cornersPainter:e,midPointsPainter:r}=this;e&&(e.caseNumber=t),r&&(r.caseNumber=t)}get caseNumber(){return this.cornersPainter?.caseNumber??0}set triangles(t){const{trianglesPainter:e,wireframePainter:r}=this;e&&(e.triangles=t),r&&(r.triangles=t)}}var C=r(2197);const b={flex1:"Uy8T6WEsJrgBv6l3yOc5"},T=(0,s.tgdDataMarchingCubesConfigurations)().map(t=>t.map(t=>"ABCDEFGHIJKL".charAt(t)).join(""));function M(){const[t,e]=(0,o.Vcb)(0,"volume-to-mesh/caseNumber",t=>(0,s.tgdCalcClamp)(Math.floor((0,C.GB)(t,0)),0,255)),[r,c]=i.useState(""),l=`volume-to-mesh/triangles/${t}`;i.useEffect(()=>{c(globalThis.localStorage.getItem(l)??T[t]),u.caseNumber=t},[t]),i.useEffect(()=>{globalThis.localStorage.setItem(l,r.trim().toUpperCase()),u.triangles=r},[r]);const u=function(){const t=i.useRef(null);return t.current||(t.current=new w),t.current}();return(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{children:"Marching cubes"}),(0,a.jsxs)("p",{children:[(0,a.jsx)("a",{href:"https://en.wikipedia.org/wiki/Marching_cubes",children:"Marching cubes"})," ","is a technique to generate meshes from a volume.",(0,a.jsx)("br",{}),"A volume is a function that tells you, for each point in a box, it you are inside or outside an object."]}),(0,a.jsxs)("p",{children:["A voxel is a unit cube. Each corner of a voxel is either inside the volume (",(0,a.jsx)("b",{children:"red"}),") or outside (",(0,a.jsx)("b",{children:"blue"}),"). With triangles, touching the edges of the voxel, we need to separate the space between red and blue corners."]}),(0,a.jsx)("p",{children:"A voxel has 8 corners, so we have 256 configurations."}),(0,a.jsx)(n.A,{onReady:t=>u.context=t}),(0,a.jsx)(o.BAW,{className:b.flex1,wide:!0,text:`${t}`,value:t,onChange:e,min:0,max:255,step:1}),(0,a.jsx)("br",{}),(0,a.jsxs)(o.sWC,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsxs)(o.sWC,{display:"flex",alignItems:"center",fullwidth:!0,gap:"M",children:[(0,a.jsx)(o.Hqg,{label:"Triangles (from mid points ABCDEFGHIJKL)",value:r,onChange:c}),(0,a.jsx)(o.qxP,{icon:o.Gk,onClick:()=>{e(t+255&255)}}),(0,a.jsx)(o.qxP,{icon:o.hIg,onClick:()=>{e(t+1&255)}})]}),(0,a.jsx)(o.yQN,{onClick:j,icon:o.Pwl,children:"Reset"})]}),(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsxs)("details",{children:[(0,a.jsx)("summary",{children:"List of triangles per configuration"}),(0,a.jsx)("pre",{children:A()})]})]})}function j(){const t=(0,s.tgdDataMarchingCubesConfigurations)();for(let e=0;e<t.length;e++){const r=t[e].map(t=>"ABCDEFGHIJKL".charAt(t)).join("");globalThis.localStorage.setItem(`volume-to-mesh/triangles/${e}`,r)}location.reload()}function A(){const t=[];for(let e=0;e<256;e++){const r=globalThis.localStorage.getItem(`volume-to-mesh/triangles/${e}`)??"?";if("?"===r)t.push("[ /* N/A /* ],");else{const e=h(r);t.push(`${JSON.stringify(e)},`)}}return t.join("\n")}}}]);