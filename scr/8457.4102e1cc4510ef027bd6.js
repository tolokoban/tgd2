"use strict";(self.webpackChunk_tolokoban_tgd=self.webpackChunk_tolokoban_tgd||[]).push([[8457],{1444:(e,n,t)=>{t.r(n),t.d(n,{default:()=>u});var a=t(4848),s=t(8453),r=(t(6540),t(5667)),o=t(7289);const i=t.p+"img/background.37e683adb425595486a4.webp",c=t.p+"bin/background.f32a984c3dae8299d635.glb";function l(){return(0,a.jsx)(o.A,{onReady:(e,n)=>{!function(e,n){e.camera=n.glb.background.createCameraByName("Camera"),e.camera.far=100;const t=new r.TgdPainterState(e,{cull:r.webglPresetCull.back,children:[(0,r.tgdMakeMeshGlbPainter)({context:e,data:n.glb.background,node:"Building",overrideMaterial:()=>()=>new r.TgdMaterialDepth}).painter]}),a=new r.TgdPainterBackgroundWithDepth(e,{background:new r.TgdTexture2D(e).loadBitmap(n.image.background),children:[t]}),s=new r.TgdPainterMesh(e);s.transfo.setPosition(11.02,0,-8.75).setScale(4);const o=new r.TgdPainterMesh(e);o.transfo.setPosition(.02,0,-4).setScale(4),e.add(a,new r.TgdPainterState(e,{depth:r.webglPresetDepth.less,children:[s,o]}),new r.TgdPainterLogic(e=>{const n=(0,r.tgdCalcModulo)(.1*e,0,2);let t=0;t=n<1?25*n:25*(2-n);const{x:a,z:i}=s.transfo.position;s.transfo.setPosition(a,t,i),s.transfo.setEulerRotation(e,47*e,120*-e);let c=0;c=n<1?30*n:30*(2-n);const{x:l,z:d}=o.transfo.position;o.transfo.setPosition(l,c,d),o.transfo.setEulerRotation(e,57*e,103*-e)})),e.play()}(e,n)},options:{antialias:!1},assets:{glb:{background:c},image:{background:i}}})}function d(e){const n={a:"a",h1:"h1",h2:"h2",p:"p",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{children:(0,a.jsx)(n.a,{href:"docs/classes/TgdPainterBackgroundWithDepth.html",children:"TgdPainterBackgroundWithDepth"})}),"\n",(0,a.jsx)(n.p,{children:"In case you have a fixed camera and a complex environment you can optimize the\npainting by pre-rendering it in Blender and generating the depth buffer with simple/fast material."}),"\n",(0,a.jsx)(n.p,{children:"TgdPainterBackgroundWithDepth will paint the high definition image and fill the\ndepth buffer with the meshes you give it as children. If the canvas size doesn't change, then the\nmeshes won't even been rendered. That's why you can use high poly meshes if you need accuracy."}),"\n",(0,a.jsx)(n.p,{children:"In the following example, we used a very low-poly mesh. You can see this when the left cube is on the top.\nThe hemi-sphere at the top of the tower is bulky, and the cube acts strange in this area."}),"\n",(0,a.jsx)(n.p,{children:"But if you know where your moving objects will be, then you can have high definition in these places\nand low poly everywhere else."}),"\n",(0,a.jsx)(n.h2,{children:"Example"}),"\n",(0,a.jsx)(l,{})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},7289:(e,n,t)=>{t.d(n,{A:()=>l});var a=t(4848),s=t(6540),r=t(5667),o=t(3608),i=t(3686);const c={Tgd:"hgIjhDQIuBCJEQ4ZgLXp",relative:"efOyHCihw9wfMB6AaAqw",overlay:"ywC8N0Uxbvm2Ug2DwPkE",loading:"PBWSRsbiwEqGpeL0hEfm",screen:"BErChOLWGtciKhh3IFud",canvas:"fT7FcYouYlPbElIAEXRP",gizmo:"uAPfWt_Dhe7RaRrnmIu0",actions:"Ia9jfUO3OevcIh2fV6R6",enabled:"dZYZScZBbWV2Pm3ftXcG",error:"J6dIEMXVMCzdFWF9UHio"};function l({className:e,options:n,onReady:t,gizmo:l=!1,width:d="640px",height:u="480px",noBorder:h=!1,assets:g,controller:p,children:m}){const[f,b]=s.useState(null),[x,w]=s.useState(!0),[v,y]=s.useState(!1),j=s.useRef(null),k=s.useRef(null),C=s.useRef(null),T=s.useRef(null),P=s.useRef(null),[E,R]=s.useState(!0);let B="auto";d.endsWith("px")&&u.endsWith("px")&&(d.substring(d.length-2),u.substring(u.length-2));const N=e=>{if(!e)return;if(k.current)return;k.current=e;const a=new r.TgdContext(e,n),s=a.gl.getParameter(a.gl.DEPTH_BITS);console.log("Depht buffer bits:",s),j.current=a,R(!0),async function({glb:e,data:n,text:t,image:a}={}){console.log("ðŸš€ [Tgd] glb, data, text, image = ",e,n,t,a);const s={glb:{},data:{},text:{},image:{}},o=[];return a&&Object.keys(a).forEach(e=>{o.push(async()=>{const n=a[e];console.log("Loading image:",n);const t=await(0,r.tgdLoadImage)(n);t&&(s.image[e]=t)})}),e&&Object.keys(e).forEach(n=>{o.push(async()=>{const t=e[n];console.log("Loading GLB:",t);const a=await(0,r.tgdLoadGlb)(t);a&&(s.glb[n]=a)})}),n&&Object.keys(n).forEach(e=>{o.push(async()=>{const t=n[e],a=await(0,r.tgdLoadArrayBuffer)(t);a&&(s.data[e]=a)})}),t&&Object.keys(t).forEach(e=>{o.push(async()=>{const n=t[e],a=await(0,r.tgdLoadText)(n);a&&(s.text[e]=a)})}),await Promise.all(o.map(e=>e())),s}(g).then(e=>{try{if(p){const e=new r.TgdControllerCameraOrbit(a,{debug:!0,inertiaOrbit:1e3,inertiaZoom:500,inertiaPanning:500,...p});P.current=e,a.inputs.pointer.eventTapMultiple.addListener(n=>{console.log("ðŸš€ [tgd] evt.tapsCount =",n.tapsCount),n.preventTap(),2===n.tapsCount&&e.reset(.001*(p.inertiaOrbit??500))})}t(a,e),a.paint()}catch(e){b(e instanceof Error?e.message:JSON.stringify(e))}R(!1)}).catch(e=>{console.error("Unable to initialize the scene!",e),R(!1)});const o=C.current;o&&o.attachContext(a)},S=e=>{const n=new r.TgdCanvasGizmo({canvas:e});C.current=n,n.eventTipClick.addListener(({to:e})=>{const n=j.current;n&&n.animSchedule({duration:.2,easingFunction:r.tgdEasingFunctionInOutCubic,action:(0,r.tgdActionCreateCameraInterpolation)(n.camera,{orientation:e})})});const t=j.current;t&&n.attachContext(t)};return s.useEffect(()=>{const e=k.current,n=j.current;if(!e||!n)return;const t=new ResizeObserver(()=>n.paint());return t.observe(e),e.requestFullscreen||(e.requestFullscreen=e.webkitRequestFullscreen),y(Boolean(e.requestFullscreen)),()=>t.unobserve(e)},[j.current,k.current]),h?(0,a.jsxs)("div",{ref:T,className:c.screen,style:{width:x?d:u,height:x?u:d},children:[(0,a.jsx)("canvas",{className:c.canvas,ref:N}),l&&(0,a.jsx)("canvas",{className:c.gizmo,ref:S}),f&&(0,a.jsx)("div",{className:c.error,children:f})]}):(0,a.jsxs)("div",{className:o.Sxu.classNames.join(e,c.Tgd),children:[(0,a.jsxs)("div",{className:o.Sxu.classNames.join(c.actions,!E&&c.enabled),children:[(0,a.jsx)("div",{children:(0,a.jsx)(o.I64,{onClick:()=>w(!x)})}),(0,a.jsx)("div",{children:(0,a.jsx)(o.kRc,{onClick:()=>{const e=j.current;e&&e.takeSnapshot().then(e=>{const n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=e.src,n.download="snapshot.png",n.click(),window.setTimeout(()=>document.body.removeChild(n),3e4)})}})}),v&&(0,a.jsx)("div",{children:(0,a.jsx)(o.L9n,{onClick:()=>{const e=T.current;e&&e.requestFullscreen()}})}),p&&(0,a.jsx)("div",{children:(0,a.jsx)(o.zgT,{onClick:()=>{const e=P.current,n=j.current;n&&e&&(e.cameraInitialState=n.camera.getCurrentState(),e.resetZoom())}})})]}),(0,a.jsxs)("div",{className:c.relative,children:[(0,a.jsxs)("div",{ref:T,className:c.screen,style:{width:x?d:u,height:x?u:d},children:[(0,a.jsx)("canvas",{className:c.canvas,ref:N}),l&&(0,a.jsx)("canvas",{className:c.gizmo,ref:S}),f&&(0,a.jsx)("div",{className:c.error,children:f})]}),(0,a.jsx)("div",{className:o.Sxu.classNames.join(c.overlay,E&&c.loading),children:(0,a.jsx)(i.A,{})}),m]})]})}},8453:(e,n,t)=>{t.d(n,{R:()=>r});var a=t(6540);const s=a.createContext({});function r(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}}}]);