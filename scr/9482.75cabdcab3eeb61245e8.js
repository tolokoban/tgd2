"use strict";(self.webpackChunk_tolokoban_tgd=self.webpackChunk_tolokoban_tgd||[]).push([[9482],{329:(t,e,n)=>{n.d(e,{A:()=>o});var a=n(1601),i=n.n(a),r=n(6314),s=n.n(r)()(i());s.push([t.id,".Uy8T6WEsJrgBv6l3yOc5 {\n    flex: 1 1 auto;\n}\n",""]),s.locals={flex1:"Uy8T6WEsJrgBv6l3yOc5"};const o=s},3469:(t,e,n)=>{n.d(e,{A:()=>o});var a=n(1601),i=n.n(a),r=n(6314),s=n.n(r)()(i());s.push([t.id,".hgIjhDQIuBCJEQ4ZgLXp {\n    display: inline-block;\n    margin: 1em;\n}\n\n.hgIjhDQIuBCJEQ4ZgLXp canvas {\n    box-shadow: 0 0.25em 0.5em #fff1;\n    max-width: 100vw;\n    max-height: 100vh;\n}\n\n.efOyHCihw9wfMB6AaAqw {\n    position: relative;\n}\n\n.ywC8N0Uxbvm2Ug2DwPkE {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    background-color: var(--theme-color-primary-1);\n    opacity: 0;\n    transition: opacity 0.3s;\n}\n\n.ywC8N0Uxbvm2Ug2DwPkE.PBWSRsbiwEqGpeL0hEfm {\n    opacity: 1;\n}\n\n.BErChOLWGtciKhh3IFud {\n    position: relative;    \n}\n\n.BErChOLWGtciKhh3IFud > canvas.fT7FcYouYlPbElIAEXRP {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n}\n\n.BErChOLWGtciKhh3IFud > canvas.uAPfWt_Dhe7RaRrnmIu0 {\n    position: absolute;\n    right: 0;\n    top: 0;\n    width: 128px;\n    height: 128px;\n    box-shadow: none;\n    border: none;\n}",""]),s.locals={Tgd:"hgIjhDQIuBCJEQ4ZgLXp",relative:"efOyHCihw9wfMB6AaAqw",overlay:"ywC8N0Uxbvm2Ug2DwPkE",loading:"PBWSRsbiwEqGpeL0hEfm",screen:"BErChOLWGtciKhh3IFud",canvas:"fT7FcYouYlPbElIAEXRP",gizmo:"uAPfWt_Dhe7RaRrnmIu0"};const o=s},9482:(t,e,n)=>{n.r(e),n.d(e,{default:()=>k});var a=n(4848),i=n(6540),r=n(6989),s=n(5968),o=n(5788);const c=new Uint8Array([0,1,0,2,0,4,1,3,1,5,2,3,2,6,3,7,4,5,4,6,5,7,6,7]),l=-1,u=new Float32Array([l,l,l,l,l,1,l,1,l,l,1,1,1,l,l,1,l,1,1,1,l,1,1,1]),h=[];for(let t=0;t<c.length;t+=2){const e=3*c[t],n=3*c[t+1],a=.5*(u[e+0]+u[n+0]),i=.5*(u[e+1]+u[n+1]),r=.5*(u[e+2]+u[n+2]);h.push(a,i,r)}const d=new Float32Array(h);function m(t){const e=[];for(const n of t.trim().toUpperCase())n<"A"||n>"L"||e.push(n.charCodeAt(0)-"A".charCodeAt(0));return e}function g(t){const e=[];for(let n=0;n<8;n++){const a=1<<n;e.push(t&a?1:0)}return e}class x extends o.tbm{constructor(t){super(),this.context=t,this.dataset=this.createDataset(),this.program=this.createProgram();const e=c;this.vao=new o.ZV_(t.gl,this.program,[this.dataset],e)}delete(){this.program.delete(),this.vao.delete()}paint(){const{context:t,program:e,vao:n}=this,{gl:a,camera:i}=t;e.use(),e.uniformMatrix4fv("uniModelViewMatrix",i.matrixModelView),e.uniformMatrix4fv("uniProjectionMatrix",i.matrixProjection),n.bind(),a.drawElements(a.LINES,24,a.UNSIGNED_BYTE,0),n.unbind()}createDataset(){const t=new o.I9j({attPoint:"vec3"});return t.set("attPoint",u),t}createProgram(){const t=new o.dLJ({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4"},attributes:{attPoint:"vec4"},varying:{varColor:"vec3"},mainCode:["varColor = abs(attPoint.xyz);","gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;"]}).code,e=new o.NI6({uniforms:{uniTexture:"sampler2D"},varying:{varColor:"vec3"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(varColor, 1.0);"]}).code;return new o.a6X(this.context.gl,{vert:t,frag:e})}}class f extends o.tbm{constructor(t){super(),this.context=t,this._caseNumber=0,this.dataset=this.createDataset(),this.program=this.createProgram(),this.vao=new o.ZV_(t.gl,this.program,[this.dataset]),this.texture=this.createTexture()}get caseNumber(){return this._caseNumber}set caseNumber(t){if(t===this._caseNumber)return;this._caseNumber=t;const e=g(t),n=[];for(let t=0;t<12;t++){const a=e[c[2*t]],i=e[c[2*t+1]];n.push(a===i?0:1)}this.dataset.set("attVisible",new Float32Array(n)),this.vao.updateDataset(this.dataset),this.context.paint()}delete(){this.texture.delete(),this.program.delete(),this.vao.delete()}paint(){const{context:t,program:e,vao:n,texture:a}=this,{gl:i,camera:r}=t;e.use(),a.activate(0,e,"uniTexture"),e.uniform1f("uniHalfScreenHeightInPixels",.5*t.height),e.uniformMatrix4fv("uniModelViewMatrix",r.matrixModelView),e.uniformMatrix4fv("uniProjectionMatrix",r.matrixProjection),n.bind(),i.drawArrays(i.POINTS,0,12),n.unbind()}createDataset(){const t=new o.I9j({attPoint:"vec3",attVisible:"float"});return t.set("attPoint",d),t}createProgram(){const t=new o.dLJ({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniHalfScreenHeightInPixels:"float"},attributes:{attPoint:"vec4",attVisible:"float"},varying:{varU:"float"},mainCode:["varU = float(gl_VertexID) / 12.0;","gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;","gl_PointSize = 0.2 * uniHalfScreenHeightInPixels / gl_Position.w;","gl_PointSize *= attVisible;"]}).code,e=new o.NI6({uniforms:{uniTexture:"sampler2D"},varying:{varU:"float"},outputs:{FragColor:"vec4"},mainCode:["vec2 uv = vec2(varU, 0.0) + gl_PointCoord.xy * vec2(1.0 / 12.0, 1.0);","FragColor = texture(uniTexture, uv);","if (FragColor.a < .1) discard;"]}).code;return new o.a6X(this.context.gl,{vert:t,frag:e})}createTexture(){const t=new o.HTX(this.context);t.setParams({magFilter:"LINEAR",minFilter:"LINEAR"});const{ctx:e,canvas:n}=(0,o.bj4)(768,64);e.font="bold 64px sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#0f0";for(let t=0;t<12;t++){const n="ABCDEFGHIJKL".charAt(t),a=(t+.5)/12,i=.5;e.fillText(n,768*a,64*i)}return t.loadBitmap(n),t}}class v extends o.tbm{constructor(t){super(),this.context=t,this._caseNumber=-1,this.dataset=this.createDataset(),this.program=this.createProgram(),this.vao=new o.ZV_(t.gl,this.program,[this.dataset]),this.texture=this.createTexture(),this.caseNumber=0}get caseNumber(){return this._caseNumber}set caseNumber(t){if(t===this._caseNumber)return;this._caseNumber=t;const e=g(t);this.dataset.set("attColor",new Float32Array(e)),this.vao.updateDataset(this.dataset),this.context.paint()}delete(){this.texture.delete(),this.program.delete(),this.vao.delete()}paint(){const{context:t,program:e,vao:n,texture:a}=this,{gl:i,camera:r}=t;e.use(),a.activate(0,e,"uniTexture"),e.uniform1f("uniHalfScreenHeightInPixels",.5*t.height),e.uniformMatrix4fv("uniModelViewMatrix",r.matrixModelView),e.uniformMatrix4fv("uniProjectionMatrix",r.matrixProjection),n.bind(),i.drawArrays(i.POINTS,0,8),n.unbind()}createDataset(){const t=new o.I9j({attPoint:"vec3",attColor:"float"});return t.set("attPoint",u),t.set("attColor",new Float32Array(u.length)),t}createProgram(){const t=new o.dLJ({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniHalfScreenHeightInPixels:"float"},attributes:{attPoint:"vec4",attColor:"float"},varying:{varColor:"float"},mainCode:["varColor = attColor;","gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;","gl_PointSize = 0.2 * uniHalfScreenHeightInPixels / gl_Position.w;"]}).code,e=new o.NI6({uniforms:{uniTexture:"sampler2D"},varying:{varColor:"float"},outputs:{FragColor:"vec4"},mainCode:["vec2 pos = 2.0 * (gl_PointCoord.xy - vec2(.5));","float radius = dot(pos, pos);","if (radius > 1.0) discard;","vec2 uv = vec2(varColor, .5);","FragColor = texture(uniTexture, uv);"]}).code;return new o.a6X(this.context.gl,{vert:t,frag:e})}createTexture(){const t=new o.HTX(this.context);return t.setParams({magFilter:"NEAREST",minFilter:"NEAREST",wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE"}),t.loadBitmap((0,o.rY8)(["#07f","#f00"])),t}}class p extends o.tbm{constructor(t){super(),this.context=t,this.elementsCount=0,this._triangles="",this.dataset=this.createDataset(),this.program=this.createProgram();const e=new Uint8Array;this.vao=new o.ZV_(t.gl,this.program,[this.dataset],e)}set triangles(t){const e=m(t);this.vao.updateElements(e),this.elementsCount=e.length,this.context.paint()}delete(){this.program.delete(),this.vao.delete()}paint(){const{context:t,program:e,vao:n,elementsCount:a}=this,{gl:i,camera:r}=t;e.use(),e.uniformMatrix4fv("uniModelViewMatrix",r.matrixModelView),e.uniformMatrix4fv("uniProjectionMatrix",r.matrixProjection),n.bind(),i.drawElements(i.TRIANGLES,a,i.UNSIGNED_BYTE,0),n.unbind()}createDataset(){const t=new o.I9j({attPoint:"vec3"});return t.set("attPoint",d),t}createProgram(){const t=new o.dLJ({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniLight:"float"},attributes:{attPoint:"vec4"},mainCode:["gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;"]}).code,e=new o.NI6({uniforms:{uniTexture:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["float a = 1.0;","FragColor = vec4(","  .8 * (gl_FrontFacing ? vec3(0, .5, 1) : vec3(1, 0, 0)),","  a",");"]}).code;return new o.a6X(this.context.gl,{vert:t,frag:e})}}class w extends o.tbm{constructor(t){super(),this.context=t,this.elementsCount=0,this.dataset=this.createDataset(),this.program=this.createProgram();const e=new Uint8Array;this.vao=new o.ZV_(t.gl,this.program,[this.dataset],e)}set triangles(t){const e=m(t),n=[];for(let t=0;t<e.length;t+=3){const a=e[t],i=e[t+1],r=e[t+2];n.push(a,i,r,a)}this.vao.updateElements(n),this.elementsCount=n.length,this.context.paint()}delete(){this.program.delete(),this.vao.delete()}paint(){const{context:t,program:e,vao:n,elementsCount:a}=this,{gl:i,camera:r}=t;e.use(),e.uniformMatrix4fv("uniModelViewMatrix",r.matrixModelView),e.uniformMatrix4fv("uniProjectionMatrix",r.matrixProjection),n.bind(),i.drawElements(i.LINES,a,i.UNSIGNED_BYTE,0),n.unbind()}createDataset(){const t=new o.I9j({attPoint:"vec3"});return t.set("attPoint",d),t}createProgram(){const t=new o.dLJ({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniLight:"float"},attributes:{attPoint:"vec4"},mainCode:["gl_Position = uniProjectionMatrix * ","  (uniModelViewMatrix * attPoint + vec4(0, 0, 0.02, 0));"]}).code,e=new o.NI6({uniforms:{uniTexture:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(0,0,0,1);"]}).code;return new o.a6X(this.context.gl,{vert:t,frag:e})}}class b{constructor(){this._context=null,this.midPointsPainter=null,this.cornersPainter=null,this.trianglesPainter=null,this.wireframePainter=null}set context(t){const{camera:e}=t;e instanceof o.xNY&&(e.fovy=(0,o.HPH)(90),e.transfo.distance=3),new o.pwt(t,{inertiaOrbit:1e3}),this._context&&this._context.destroy(),this._context=t;const n=new o.o57(t,{color:[0,0,0,1],depth:1}),a=new o.Ipk(t,{depth:o.Eg5.less,cull:o.TfJ.off}),i=new w(t);this.wireframePainter=i;const r=new f(t);this.midPointsPainter=r;const s=new v(t);this.cornersPainter=s;const c=new p(t);this.trianglesPainter=c,a.add(new x(t),i,new o.Ipk(t,{blend:o.aMr.premultipliedAlpha,children:[r,s,c]})),t.add(n,a),t.paint()}set caseNumber(t){const{cornersPainter:e,midPointsPainter:n}=this;e&&(e.caseNumber=t),n&&(n.caseNumber=t)}get caseNumber(){return this.cornersPainter?.caseNumber??0}set triangles(t){const{trianglesPainter:e,wireframePainter:n}=this;e&&(e.triangles=t),n&&(n.triangles=t)}}var P=n(2197),C=n(5072),j=n.n(C),M=n(7825),y=n.n(M),N=n(7659),A=n.n(N),E=n(5056),I=n.n(E),_=n(540),T=n.n(_),F=n(1113),S=n.n(F),D=n(329),L={};L.styleTagTransform=S(),L.setAttributes=I(),L.insert=A().bind(null,"head"),L.domAPI=y(),L.insertStyleElement=T(),j()(D.A,L);const V=D.A&&D.A.locals?D.A.locals:void 0,B=(0,o.mNY)().map((t=>t.map((t=>"ABCDEFGHIJKL".charAt(t))).join("")));function k(){const[t,e]=(0,s.Vcb)(0,"volume-to-mesh/caseNumber",(t=>(0,o.O6b)(Math.floor((0,P.GB)(t,0)),0,255))),[n,c]=i.useState(""),l=`volume-to-mesh/triangles/${t}`;i.useEffect((()=>{c(globalThis.localStorage.getItem(l)??B[t]),u.caseNumber=t}),[t]),i.useEffect((()=>{globalThis.localStorage.setItem(l,n.trim().toUpperCase()),u.triangles=n}),[n]);const u=function(){const t=i.useRef(null);return t.current||(t.current=new b),t.current}();return(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{children:"Marching cubes"}),(0,a.jsxs)("p",{children:[(0,a.jsx)("a",{href:"https://en.wikipedia.org/wiki/Marching_cubes",children:"Marching cubes"})," ","is a technique to generate meshes from a volume.",(0,a.jsx)("br",{}),"A volume is a function that tells you, for each point in a box, it you are inside or outside an object."]}),(0,a.jsxs)("p",{children:["A voxel is a unit cube. Each corner of a voxel is either inside the volume (",(0,a.jsx)("b",{children:"red"}),") or outside (",(0,a.jsx)("b",{children:"blue"}),"). With triangles, touching the edges of the voxel, we need to separate the space between red and blue corners."]}),(0,a.jsx)("p",{children:"A voxel has 8 corners, so we have 256 configurations."}),(0,a.jsx)(r.A,{onReady:t=>u.context=t}),(0,a.jsx)(s.BAW,{className:V.flex1,wide:!0,text:`${t}`,value:t,onChange:e,min:0,max:255,step:1}),(0,a.jsx)("br",{}),(0,a.jsxs)(s.sWC,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsxs)(s.sWC,{display:"flex",alignItems:"center",fullwidth:!0,gap:"M",children:[(0,a.jsx)(s.Hqg,{label:"Triangles (from mid points ABCDEFGHIJKL)",value:n,onChange:c}),(0,a.jsx)(s.qxP,{icon:s.Gk,onClick:()=>{e(t+255&255)}}),(0,a.jsx)(s.qxP,{icon:s.hIg,onClick:()=>{e(t+1&255)}})]}),(0,a.jsx)(s.yQN,{onClick:R,icon:s.Pwl,children:"Reset"})]}),(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsxs)("details",{children:[(0,a.jsx)("summary",{children:"List of triangles per configuration"}),(0,a.jsx)("pre",{children:H()})]})]})}function R(){const t=(0,o.mNY)();for(let e=0;e<t.length;e++){const n=t[e].map((t=>"ABCDEFGHIJKL".charAt(t))).join("");globalThis.localStorage.setItem(`volume-to-mesh/triangles/${e}`,n)}location.reload()}function H(){const t=[];for(let e=0;e<256;e++){const n=globalThis.localStorage.getItem(`volume-to-mesh/triangles/${e}`)??"?";if("?"===n)t.push("[ /* N/A /* ],");else{const e=m(n);t.push(`${JSON.stringify(e)},`)}}return t.join("\n")}},6989:(t,e,n)=>{n.d(e,{A:()=>j});var a=n(4848),i=n(6540),r=n(5788),s=n(5968),o=n(5670),c=n(5072),l=n.n(c),u=n(7825),h=n.n(u),d=n(7659),m=n.n(d),g=n(5056),x=n.n(g),f=n(540),v=n.n(f),p=n(1113),w=n.n(p),b=n(3469),P={};P.styleTagTransform=w(),P.setAttributes=x(),P.insert=m().bind(null,"head"),P.domAPI=h(),P.insertStyleElement=v(),l()(b.A,P);const C=b.A&&b.A.locals?b.A.locals:void 0;function j({className:t,options:e,onReady:n,gizmo:c=!1,width:l="640px",height:u="480px",noBorder:h=!1,assets:d,children:m}){const[g,x]=i.useState(!0),[f,v]=i.useState(!1),p=i.useRef(null),w=i.useRef(null),b=i.useRef(null),P=i.useRef(null),[j,M]=i.useState(!0);let y="auto";l.endsWith("px")&&u.endsWith("px")&&(l.substring(l.length-2),u.substring(u.length-2));const N=t=>{if(!t)return;if(w.current)return;w.current=t;const a=new r.tfp(t,e);p.current=a,M(!0),async function({glb:t,data:e,text:n,image:a}={}){console.log("🚀 [Tgd] glb, data, text, image = ",t,e,n,a);const i={glb:{},data:{},text:{},image:{}},s=[];return a&&Object.keys(a).forEach((t=>{s.push((async()=>{const e=a[t];console.log("Loading image:",e);const n=await(0,r.V_9)(e);n&&(i.image[t]=n)}))})),t&&Object.keys(t).forEach((e=>{s.push((async()=>{const n=t[e];console.log("Loading GLB:",n);const a=await(0,r.TCe)(n);a&&(i.glb[e]=a)}))})),e&&Object.keys(e).forEach((t=>{s.push((async()=>{const n=e[t],a=await(0,r.vSU)(n);a&&(i.data[t]=a)}))})),n&&Object.keys(n).forEach((t=>{s.push((async()=>{const e=n[t],a=await(0,r.jWq)(e);a&&(i.text[t]=a)}))})),await Promise.all(s.map((t=>t()))),i}(d).then((t=>{console.log("Ready!"),n(a,t),a.paint(),M(!1)})).catch((t=>{console.error("Unable to initialize the scene!",t),M(!1)}));const i=b.current;i&&i.attachContext(a)},A=t=>{const e=new r.GbF({canvas:t});b.current=e,e.eventTipClick.addListener((({to:t})=>{const e=p.current;console.log("🚀 [tgd] to, context =",t,e),e&&e.animSchedule({duration:.2,easingFunction:r.Wcc,action:(0,r.vRM)(e.camera,{orientation:t})})}));const n=p.current;n&&e.attachContext(n)};return i.useEffect((()=>{const t=w.current,e=p.current;if(!t||!e)return;const n=new ResizeObserver((()=>e.paint()));return n.observe(t),t.requestFullscreen||(t.requestFullscreen=t.webkitRequestFullscreen),v(Boolean(t.requestFullscreen)),()=>n.unobserve(t)}),[p.current,w.current]),h?(0,a.jsxs)("div",{ref:P,className:C.screen,style:{width:g?l:u,height:g?u:l},children:[(0,a.jsx)("canvas",{className:C.canvas,ref:N}),c&&(0,a.jsx)("canvas",{className:C.gizmo,ref:A})]}):(0,a.jsxs)("div",{className:s.Sxu.classNames.join(t,C.Tgd),children:[(0,a.jsxs)(s.sWC,{display:"flex",justifyContent:"space-between",children:[(0,a.jsx)(s.yQN,{variant:"elevated",onClick:()=>x(!g),enabled:!j,children:g?"Switch to Portrait":"Switch to Landscape"}),f&&(0,a.jsx)(s.yQN,{variant:"elevated",onClick:()=>{const t=P.current;t&&t.requestFullscreen()},enabled:!j,children:"Fullscreen"})]}),(0,a.jsxs)("div",{className:C.relative,children:[(0,a.jsxs)("div",{ref:P,className:C.screen,style:{width:g?l:u,height:g?u:l},children:[(0,a.jsx)("canvas",{className:C.canvas,ref:N}),c&&(0,a.jsx)("canvas",{className:C.gizmo,ref:A})]}),(0,a.jsx)("div",{className:s.Sxu.classNames.join(C.overlay,j&&C.loading),children:(0,a.jsx)(o.A,{})}),m]})]})}}}]);