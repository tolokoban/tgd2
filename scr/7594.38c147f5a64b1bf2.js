"use strict";(self.webpackChunk_tolokoban_tgd=self.webpackChunk_tolokoban_tgd||[]).push([["7594"],{2197(e,t,r){function a(e){return!(!e||Array.isArray(e))&&"object"==typeof e}function n(e){return"number"==typeof e}function i(e,t,r=null){return o(e,t,r)}function o(e,t,r=null){try{return l(e,t),!0}catch(t){return r&&(console.error("[Invalid type]",r),console.error(e),console.debug(t)),!1}}function s(e,t,r="data"){return l(e,t,r)}function l(e,t,r="data"){if("function"==typeof t)return l(e,t(),r);if("unknown"!==t){if("null"===t){if(null!==e)throw console.log("\uD83D\uDE80 [index] data = ",e,typeof e),Error(`Expected ${r} to be a null and not a ${d(e)}!`);return}if("string"==typeof t){if(typeof e!==t)throw Error(`Expected ${r} to be a ${t} and not a ${d(e)}!`);return}if(Array.isArray(t)){let[i]=t;switch(i){case"array":!function(e,t,r){if(!Array.isArray(e))throw Error(`Expected ${t} to be an array and not a ${d(e)}!`);let[,a,i]=r;if(i){let r=e.length;if(n(i)){if(r!==i)throw Error(`Expected ${t}'s length to be ${i} and not ${r}!`)}else{let{min:e,max:a}=i;if(n(e)&&r<e)throw Error(`Expected ${t}'s MIN length to be ${e} and not ${r}!`);if(n(a)&&r>a)throw Error(`Expected ${t}'s MAX length to be ${a} and not ${r}!`)}}for(let r=0;r<e.length;r+=1)l(e[r],a,`${t}[${r}]`)}(e,r,t);return;case"map":!function(e,t,r){if(!a(e))throw Error(`Expected ${t} to be an object and not a ${d(e)}!`);let[,n]=r;for(let r of Object.keys(e))"string"==typeof r&&l(e[r],n,`${t}[${r}]`)}(e,r,t);return;case"?":!function(e,t,r){if(void 0===e)return;let[,a]=r;l(e,a,t)}(e,r,t);return;case"|":!function(e,t,r){let[,...a]=r;if(0===a.length)throw Error(`No type has been defined for this alternative: ${JSON.stringify(r)}!`);let n=[];for(let r of a)try{l(e,r,t);return}catch(e){e instanceof Error&&n.push(e)}throw Error(`All alternatives failed!${n.map(e=>`
${e.message}`)}`)}(e,r,t);return;case"tuple":c(e,r,t);return;case"tuple...":!function(e,t,[,...r]){let a=r.length-1;c(e,t,["tuple",...r.slice(0,a)]);let n=r[a];for(let r=a;r<e.length;r++)l(e[r],n,`${t}[${r}]`)}(e,r,t);return;case"partial":!function(e,t,[,r]){for(let n of(!function(e,t="data"){if(!a(e))throw Error(`${t} was expected to be an object but we got ${typeof e}!`)}(e,t),Object.keys(r))){if("string"!=typeof n)continue;let a=e[n];void 0!==a&&l(a,r[n],`${t}.${n}`)}}(e,r,t);return;case"literal":!function(e,t,r){let[,...a]=r;for(let t of a)if(e===t)return;throw Error(`Expected ${t} to be a literal (${a.map(e=>`"${e}"`).join(" | ")}) and not a ${d(e)}!`)}(e,r,t);return;case"custom":!function(e,t,[,r]){if(!r(e))throw Error(`Expected ${r.name}(${t}) to return true!`)}(e,r,t);return;default:throw Error(`Don't know how to create a type guard for this kind of type: ${JSON.stringify(t)}`)}}if("object"!=typeof e)throw Error(`Expected ${r} to be an object and not a ${d(e)}!`);for(let a of Object.keys(t))"string"==typeof a&&l(e[a],t[a],`${r}.${a}`)}}function c(e,t,[,...r]){if(!function(e,t="data"){if(!Array.isArray(e))throw Error(`${t} was expected to be an Array but we got ${typeof e}!`)}(e),r.length>e.length)throw Error(`Expected ${t}'s length to be at least ${r.length} and not ${e.length}!`);for(let a=0;a<r.length;a++){let n=r[a];l(e[a],n,`${t}[${a}]`)}}function u(e,t){var r;return o(e,r="number")?e:o(t,r)?t:t(e)}function d(e){var t;return null===e?"null":"function"==typeof e?`function ${null!=(t=e.name)?t:""}()`:typeof e}r.d(t,{Et:()=>n,GB:()=>u,Xj:()=>i,j:()=>s})},225(e,t,r){r.r(t),r.d(t,{default:()=>P});var a=r(4848),n=r(6540),i=r(3172),o=r(6671),s=r(2155);let l=new Uint8Array([0,1,0,2,0,4,1,3,1,5,2,3,2,6,3,7,4,5,4,6,5,7,6,7]),c=new Float32Array([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1]),u=[];for(let e=0;e<l.length;e+=2){let t=3*l[e],r=3*l[e+1],a=.5*(c[t+0]+c[r+0]),n=.5*(c[t+1]+c[r+1]),i=.5*(c[t+2]+c[r+2]);u.push(a,n,i)}let d=new Float32Array(u);function h(e){let t=[];for(let r of e.trim().toUpperCase())r<"A"||r>"L"||t.push(r.charCodeAt(0)-65);return t}function g(e){let t=[];for(let r=0;r<8;r++){let a=1<<r;t.push(e&a?1:0)}return t}class f extends s.TgdPainter{constructor(e){super(),this.context=e,this._caseNumber=-1,this.dataset=this.createDataset(),this.program=this.createProgram(),this.vao=new s.TgdVertexArray(e.gl,this.program,[this.dataset]),this.texture=this.createTexture(),this.caseNumber=0}get caseNumber(){return this._caseNumber}set caseNumber(e){if(e===this._caseNumber)return;this._caseNumber=e;let t=g(e);this.dataset.set("attColor",new Float32Array(t)),this.vao.updateDataset(this.dataset),this.context.paint()}delete(){this.texture.delete(),this.program.delete(),this.vao.delete()}paint(){let{context:e,program:t,vao:r,texture:a}=this,{gl:n,camera:i}=e;t.use(),a.activate(0,t,"uniTexture"),t.uniform1f("uniHalfScreenHeightInPixels",.5*e.height),t.uniformMatrix4fv("uniModelViewMatrix",i.matrixModelView),t.uniformMatrix4fv("uniProjectionMatrix",i.matrixProjection),r.bind(),n.drawArrays(n.POINTS,0,8),r.unbind()}createDataset(){let e=new s.TgdDataset({attPoint:"vec3",attColor:"float"});return e.set("attPoint",c),e.set("attColor",new Float32Array(c.length)),e}createProgram(){let e=new s.TgdShaderVertex({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniHalfScreenHeightInPixels:"float"},attributes:{attPoint:"vec4",attColor:"float"},varying:{varColor:"float"},mainCode:["varColor = attColor;","gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;","gl_PointSize = 0.2 * uniHalfScreenHeightInPixels / gl_Position.w;"]}).code,t=new s.TgdShaderFragment({uniforms:{uniTexture:"sampler2D"},varying:{varColor:"float"},outputs:{FragColor:"vec4"},mainCode:["vec2 pos = 2.0 * (gl_PointCoord.xy - vec2(.5));","float radius = dot(pos, pos);","if (radius > 1.0) discard;","vec2 uv = vec2(varColor, .5);","FragColor = texture(uniTexture, uv);"]}).code;return new s.TgdProgram(this.context.gl,{vert:e,frag:t})}createTexture(){let e=new s.TgdTexture2D(this.context);return e.setParams({magFilter:"NEAREST",minFilter:"NEAREST",wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE"}),e.loadBitmap((0,s.tgdCanvasCreatePalette)(["#07f","#f00"])),e}}class m extends s.TgdPainter{constructor(e){super(),this.context=e,this._caseNumber=0,this.dataset=this.createDataset(),this.program=this.createProgram(),this.vao=new s.TgdVertexArray(e.gl,this.program,[this.dataset]),this.texture=this.createTexture()}get caseNumber(){return this._caseNumber}set caseNumber(e){if(e===this._caseNumber)return;this._caseNumber=e;let t=g(e),r=[];for(let e=0;e<12;e++){let a=t[l[2*e]],n=t[l[2*e+1]];r.push(+(a!==n))}this.dataset.set("attVisible",new Float32Array(r)),this.vao.updateDataset(this.dataset),this.context.paint()}delete(){this.texture.delete(),this.program.delete(),this.vao.delete()}paint(){let{context:e,program:t,vao:r,texture:a}=this,{gl:n,camera:i}=e;t.use(),a.activate(0,t,"uniTexture"),t.uniform1f("uniHalfScreenHeightInPixels",.5*e.height),t.uniformMatrix4fv("uniModelViewMatrix",i.matrixModelView),t.uniformMatrix4fv("uniProjectionMatrix",i.matrixProjection),r.bind(),n.drawArrays(n.POINTS,0,12),r.unbind()}createDataset(){let e=new s.TgdDataset({attPoint:"vec3",attVisible:"float"});return e.set("attPoint",d),e}createProgram(){let e=new s.TgdShaderVertex({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniHalfScreenHeightInPixels:"float"},attributes:{attPoint:"vec4",attVisible:"float"},varying:{varU:"float"},mainCode:["varU = float(gl_VertexID) / 12.0;","gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;","gl_PointSize = 0.2 * uniHalfScreenHeightInPixels / gl_Position.w;","gl_PointSize *= attVisible;"]}).code,t=new s.TgdShaderFragment({uniforms:{uniTexture:"sampler2D"},varying:{varU:"float"},outputs:{FragColor:"vec4"},mainCode:["vec2 uv = vec2(varU, 0.0) + gl_PointCoord.xy * vec2(1.0 / 12.0, 1.0);","FragColor = texture(uniTexture, uv);","if (FragColor.a < .1) discard;"]}).code;return new s.TgdProgram(this.context.gl,{vert:e,frag:t})}createTexture(){let e=new s.TgdTexture2D(this.context);e.setParams({magFilter:"LINEAR",minFilter:"LINEAR"});let t="ABCDEFGHIJKL",r=t.length,a=64*r,{ctx:n,canvas:i}=(0,s.tgdCanvasCreateWithContext2D)(a,64);n.font="bold 64px sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillStyle="#0f0";for(let e=0;e<r;e++){let i=t.charAt(e),o=(e+.5)/r;n.fillText(i,o*a,32)}return e.loadBitmap(i),e}}class x extends s.TgdPainter{constructor(e){super(),this.context=e,this.dataset=this.createDataset(),this.program=this.createProgram(),this.vao=new s.TgdVertexArray(e.gl,this.program,[this.dataset],l)}delete(){this.program.delete(),this.vao.delete()}paint(){let{context:e,program:t,vao:r}=this,{gl:a,camera:n}=e;t.use(),t.uniformMatrix4fv("uniModelViewMatrix",n.matrixModelView),t.uniformMatrix4fv("uniProjectionMatrix",n.matrixProjection),r.bind(),a.drawElements(a.LINES,24,a.UNSIGNED_BYTE,0),r.unbind()}createDataset(){let e=new s.TgdDataset({attPoint:"vec3"});return e.set("attPoint",c),e}createProgram(){let e=new s.TgdShaderVertex({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4"},attributes:{attPoint:"vec4"},varying:{varColor:"vec3"},mainCode:["varColor = abs(attPoint.xyz);","gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;"]}).code,t=new s.TgdShaderFragment({uniforms:{uniTexture:"sampler2D"},varying:{varColor:"vec3"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(varColor, 1.0);"]}).code;return new s.TgdProgram(this.context.gl,{vert:e,frag:t})}}class p extends s.TgdPainter{constructor(e){super(),this.context=e,this.elementsCount=0,this._triangles="",this.dataset=this.createDataset(),this.program=this.createProgram();const t=new Uint8Array;this.vao=new s.TgdVertexArray(e.gl,this.program,[this.dataset],t)}set triangles(e){let t=h(e);this.vao.updateElements(t),this.elementsCount=t.length,this.context.paint()}delete(){this.program.delete(),this.vao.delete()}paint(){let{context:e,program:t,vao:r,elementsCount:a}=this,{gl:n,camera:i}=e;t.use(),t.uniformMatrix4fv("uniModelViewMatrix",i.matrixModelView),t.uniformMatrix4fv("uniProjectionMatrix",i.matrixProjection),r.bind(),n.drawElements(n.TRIANGLES,a,n.UNSIGNED_BYTE,0),r.unbind()}createDataset(){let e=new s.TgdDataset({attPoint:"vec3"});return e.set("attPoint",d),e}createProgram(){let e=new s.TgdShaderVertex({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniLight:"float"},attributes:{attPoint:"vec4"},mainCode:["gl_Position = uniProjectionMatrix * uniModelViewMatrix * attPoint;"]}).code,t=new s.TgdShaderFragment({uniforms:{uniTexture:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["float a = 1.0;","FragColor = vec4(","  .8 * (gl_FrontFacing ? vec3(0, .5, 1) : vec3(1, 0, 0)),","  a",");"]}).code;return new s.TgdProgram(this.context.gl,{vert:e,frag:t})}}class v extends s.TgdPainter{constructor(e){super(),this.context=e,this.elementsCount=0,this.dataset=this.createDataset(),this.program=this.createProgram();const t=new Uint8Array;this.vao=new s.TgdVertexArray(e.gl,this.program,[this.dataset],t)}set triangles(e){let t=h(e),r=[];for(let e=0;e<t.length;e+=3){let a=t[e],n=t[e+1],i=t[e+2];r.push(a,n,i,a)}this.vao.updateElements(r),this.elementsCount=r.length,this.context.paint()}delete(){this.program.delete(),this.vao.delete()}paint(){let{context:e,program:t,vao:r,elementsCount:a}=this,{gl:n,camera:i}=e;t.use(),t.uniformMatrix4fv("uniModelViewMatrix",i.matrixModelView),t.uniformMatrix4fv("uniProjectionMatrix",i.matrixProjection),r.bind(),n.drawElements(n.LINES,a,n.UNSIGNED_BYTE,0),r.unbind()}createDataset(){let e=new s.TgdDataset({attPoint:"vec3"});return e.set("attPoint",d),e}createProgram(){let e=new s.TgdShaderVertex({uniforms:{uniModelViewMatrix:"mat4",uniProjectionMatrix:"mat4",uniLight:"float"},attributes:{attPoint:"vec4"},mainCode:["gl_Position = uniProjectionMatrix * ","  (uniModelViewMatrix * attPoint + vec4(0, 0, 0.02, 0));"]}).code,t=new s.TgdShaderFragment({uniforms:{uniTexture:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(0,0,0,1);"]}).code;return new s.TgdProgram(this.context.gl,{vert:e,frag:t})}}class b{constructor(){this._context=null,this.midPointsPainter=null,this.cornersPainter=null,this.trianglesPainter=null,this.wireframePainter=null}set context(e){let{camera:t}=e;t instanceof s.TgdCameraPerspective&&(t.fovy=(0,s.tgdCalcDegToRad)(90),t.transfo.distance=3),new s.TgdControllerCameraOrbit(e,{inertiaOrbit:1e3}),this._context&&this._context.delete(),this._context=e;let r=new s.TgdPainterClear(e,{color:[0,0,0,1],depth:1}),a=new s.TgdPainterState(e,{depth:s.webglPresetDepth.less,cull:s.webglPresetCull.off}),n=new v(e);this.wireframePainter=n;let i=new m(e);this.midPointsPainter=i;let o=new f(e);this.cornersPainter=o;let l=new p(e);this.trianglesPainter=l,a.add(new x(e),n,new s.TgdPainterState(e,{blend:s.webglPresetBlend.premultipliedAlpha,children:[i,o,l]})),e.add(r,a),e.paint()}set caseNumber(e){let{cornersPainter:t,midPointsPainter:r}=this;t&&(t.caseNumber=e),r&&(r.caseNumber=e)}get caseNumber(){return this.cornersPainter?.caseNumber??0}set triangles(e){let{trianglesPainter:t,wireframePainter:r}=this;t&&(t.triangles=e),r&&(r.triangles=e)}}var w=r(2197);let C=(0,s.tgdDataMarchingCubesConfigurations)().map(e=>e.map(e=>"ABCDEFGHIJKL".charAt(e)).join(""));function P(){let e,[t,r]=(0,o.Vcb)(0,"volume-to-mesh/caseNumber",e=>(0,s.tgdCalcClamp)(Math.floor((0,w.GB)(e,0)),0,255)),[l,c]=n.useState(""),u=`volume-to-mesh/triangles/${t}`;n.useEffect(()=>{c(globalThis.localStorage.getItem(u)??C[t]),d.caseNumber=t},[t]),n.useEffect(()=>{globalThis.localStorage.setItem(u,l.trim().toUpperCase()),d.triangles=l},[l]);let d=((e=n.useRef(null)).current||(e.current=new b),e.current);return(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{children:"Marching cubes"}),(0,a.jsxs)("p",{children:[(0,a.jsx)("a",{href:"https://en.wikipedia.org/wiki/Marching_cubes",children:"Marching cubes"})," ","is a technique to generate meshes from a volume.",(0,a.jsx)("br",{}),"A volume is a function that tells you, for each point in a box, it you are inside or outside an object."]}),(0,a.jsxs)("p",{children:["A voxel is a unit cube. Each corner of a voxel is either inside the volume (",(0,a.jsx)("b",{children:"red"}),") or outside (",(0,a.jsx)("b",{children:"blue"}),"). With triangles, touching the edges of the voxel, we need to separate the space between red and blue corners."]}),(0,a.jsx)("p",{children:"A voxel has 8 corners, so we have 256 configurations."}),(0,a.jsx)(i.A,{onReady:e=>{d.context=e}}),(0,a.jsx)(o.BAW,{className:"EI0H1Q3g8KUvqT7R",wide:!0,text:`${t}`,value:t,onChange:r,min:0,max:255,step:1}),(0,a.jsx)("br",{}),(0,a.jsxs)(o.sWC,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsxs)(o.sWC,{display:"flex",alignItems:"center",fullwidth:!0,gap:"M",children:[(0,a.jsx)(o.Hqg,{label:"Triangles (from mid points ABCDEFGHIJKL)",value:l,onChange:c}),(0,a.jsx)(o.qxP,{icon:o.Gk,onClick:()=>{r(t+255&255)}}),(0,a.jsx)(o.qxP,{icon:o.hIg,onClick:()=>{r(t+1&255)}})]}),(0,a.jsx)(o.yQN,{onClick:j,icon:o.Pwl,children:"Reset"})]}),(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsxs)("details",{children:[(0,a.jsx)("summary",{children:"List of triangles per configuration"}),(0,a.jsx)("pre",{children:function(){let e=[];for(let t=0;t<256;t++){let r=globalThis.localStorage.getItem(`volume-to-mesh/triangles/${t}`)??"?";if("?"===r)e.push("[ /* N/A /* ],");else{let t=h(r);e.push(`${JSON.stringify(t)},`)}}return e.join("\n")}()})]})]})}function j(){let e=(0,s.tgdDataMarchingCubesConfigurations)();for(let t=0;t<e.length;t++){let r=e[t].map(e=>"ABCDEFGHIJKL".charAt(e)).join("");globalThis.localStorage.setItem(`volume-to-mesh/triangles/${t}`,r)}location.reload()}},3172(e,t,r){r.d(t,{A:()=>f});var a=r(4848),n=r(6540),i=r(6671);function o({className:e,label:t,min:r,max:n,value:o,onChange:s}){return(0,a.jsxs)("div",{className:i.Sxu.classNames.join(e,"u8HaymDuvmcx5Xlm"),children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:t}),(0,a.jsx)("div",{children:(0,a.jsx)("strong",{children:o.toFixed(2)})})]}),(0,a.jsx)("input",{type:"range",step:(n-r)/100,min:r,max:n,value:o,onChange:e=>{s(parseFloat(e.target.value))}})]})}function s({className:e,values:t,onChange:r}){let[s,l]=n.useState(!1);return(0,a.jsxs)("div",{className:i.Sxu.classNames.join(e,"O3eUw2E6kJAY5Kzb",s?"fh6L2aMFrodrLYWv":"LFyaXnIfeqU4RizM"),children:[(0,a.jsx)("button",{type:"button",onClick:()=>l(!s),children:(0,a.jsx)("svg",{style:{width:"1.5em",height:"1.5em"},viewBox:"0 0 24 24",preserveAspectRatio:"xMidYMid meet","stroke-width":"1.5",children:(0,a.jsx)("path",{d:"M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",stroke:"none",fill:"#fff"})})}),(0,a.jsx)("div",{children:Object.keys(t).map(e=>{let n=t[e];if(!n)return null;let i=n.min??0,s=n.max??1;return(0,a.jsx)(o,{label:n.label,min:i,max:s,value:n.value,onChange:a=>{r({...t,[e]:{...t[e],value:a}})}},e)})})]})}var l=r(2155),c=r(3289);let u="NwIHvuh9THszhNCj",d="OvO7uXOT0RoimVco",h="r0e5CaWIlKI2oFZu",g="qgsDNUq3iYtpdR4I";function f({className:e,options:t,onReady:r,gizmo:o=!1,width:f="640px",height:x="480px",noBorder:p=!1,assets:v,controller:b,settings:w,children:C,disableDefaultDoubleTap:P=!1}){let j=n.useRef(null),[y,T]=n.useState(w),M=n.useCallback(()=>{if(!y)return{};let e={};for(let t of Object.keys(y))e[t]=y[t].value;return e},[y]);n.useEffect(()=>{if(y){let e={};for(let t of Object.keys(y))e[t]=y[t].value;j.current?.(M())}},[y,M]);let[E,N]=n.useState(null),[A,S]=n.useState(!0),[$,D]=n.useState(!1),L=n.useRef(null),I=n.useRef(null),F=n.useRef(null),k=n.useRef(null),_=n.useRef(null),[V,O]=n.useState(!0);f.endsWith("px")&&x.endsWith("px")&&(f.substring(f.length-2),x.substring(x.length-2));let H=e=>{if(!e||I.current)return;I.current=e;let a=new l.TgdContext(e,t);console.log("Depht buffer bits:",a.gl.getParameter(a.gl.DEPTH_BITS)),L.current=a,O(!0),m(v).then(e=>{try{if(b){let e=new l.TgdControllerCameraOrbit(a,{debug:!0,inertiaOrbit:1e3,inertiaZoom:500,inertiaPanning:500,...b});_.current=e,a.inputs.pointer.eventTapMultiple.addListener(t=>{console.log("\uD83D\uDE80 [tgd] evt.tapsCount =",t.tapsCount),t.preventTap(),2!==t.tapsCount||P||e.reset((b.inertiaOrbit??500)*.001)})}j.current=r(a,e),j.current?.(M()),a.paint()}catch(e){N(e instanceof Error?e.message:JSON.stringify(e)),console.error(e)}O(!1)}).catch(e=>{console.error("Unable to initialize the scene!",e),O(!1)});let n=F.current;n&&n.attachContext(a)},R=e=>{let t=new l.TgdCanvasGizmo({canvas:e});F.current=t,t.eventTipClick.addListener(({to:e})=>{let t=L.current;t&&t.animSchedule({duration:.2,easingFunction:l.tgdEasingFunctionInOutCubic,action:(0,l.tgdActionCreateCameraInterpolation)(t.camera,{orientation:e})})});let r=L.current;r&&t.attachContext(r)};return(n.useEffect(()=>{let e=I.current,t=L.current;if(!e||!t)return;let r=new ResizeObserver(()=>t.paint());return r.observe(e),e.requestFullscreen||(e.requestFullscreen=e.webkitRequestFullscreen),D(!!e.requestFullscreen),()=>r.unobserve(e)},[L.current,I.current]),p)?(0,a.jsxs)("div",{ref:k,className:u,style:{width:A?f:x,height:A?x:f},children:[(0,a.jsx)("canvas",{className:d,ref:H}),o&&(0,a.jsx)("canvas",{className:h,ref:R}),y&&(0,a.jsx)(s,{values:y,onChange:T}),E&&(0,a.jsx)("div",{className:g,children:E})]}):(0,a.jsxs)("div",{className:i.Sxu.classNames.join(e,"MESVmxyHbYMu0P0r"),children:[(0,a.jsxs)("div",{className:i.Sxu.classNames.join("OBhA17iAKaUaAbSS",!V&&"dxtnW6vkWWweMZbP"),children:[(0,a.jsx)("div",{children:(0,a.jsx)(i.I64,{onClick:()=>S(!A)})}),(0,a.jsx)("div",{children:(0,a.jsx)(i.kRc,{onClick:()=>{let e=L.current;e&&e.takeSnapshot().then(e=>{let t=document.createElement("a");document.body.appendChild(t),t.style.display="none",t.href=e.src,t.download="snapshot.png",t.click(),window.setTimeout(()=>document.body.removeChild(t),3e4)})}})}),$&&(0,a.jsx)("div",{children:(0,a.jsx)(i.L9n,{onClick:()=>{let e=k.current;e&&e.requestFullscreen()}})}),b&&(0,a.jsx)("div",{children:(0,a.jsx)(i.zgT,{onClick:()=>{let e=_.current,t=L.current;t&&e&&(e.cameraInitialState=t.camera.getCurrentState(),e.resetZoom())}})})]}),(0,a.jsxs)("div",{className:"IctJ7LNrbc0x_gIB",children:[(0,a.jsxs)("div",{ref:k,className:u,style:{width:A?f:x,height:A?x:f},children:[(0,a.jsx)("canvas",{className:d,ref:H}),o&&(0,a.jsx)("canvas",{className:h,ref:R}),y&&(0,a.jsx)(s,{values:y,onChange:T}),E&&(0,a.jsx)("div",{className:g,children:E})]}),(0,a.jsx)("div",{className:i.Sxu.classNames.join("w7EXkaA82Y850o5V",V&&"c4TMDjqUWvQOmkt9"),children:(0,a.jsx)(c.A,{})}),C]})]})}async function m({glb:e,data:t,text:r,image:a}={}){let n={glb:{},data:{},text:{},image:{}},i=[];return a&&Object.keys(a).forEach(e=>{i.push(async()=>{let t=a[e];console.log("Loading image:",t);let r=await (0,l.tgdLoadImage)(t);r&&(n.image[e]=r)})}),e&&Object.keys(e).forEach(t=>{i.push(async()=>{let r=e[t];console.log("Loading GLB:",r);let a=await (0,l.tgdLoadGlb)(r);a&&(n.glb[t]=a)})}),t&&Object.keys(t).forEach(e=>{i.push(async()=>{let r=t[e],a=await (0,l.tgdLoadArrayBuffer)(r);a&&(n.data[e]=a)})}),r&&Object.keys(r).forEach(e=>{i.push(async()=>{let t=r[e],a=await (0,l.tgdLoadText)(t);a&&(n.text[e]=a)})}),await Promise.all(i.map(e=>e())),n}}}]);