"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[155],{155:(t,e,i)=>{i.d(e,{EK:()=>J,Op:()=>K,Ui:()=>tt,Uj:()=>B,WM:()=>q,Yp:()=>$,Zc:()=>C,a7:()=>Q,ts:()=>H,tz:()=>G,yr:()=>W});var s={d:(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},r={};function n(t,e=6){const i=Math.pow(10,e),s=[];let r=0;for(const n of t){const t=(Math.round(n*i)/i).toFixed(e);r=Math.max(r,t.length),s.push(t)}return s.map((t=>t.padStart(r," ")))}s.d(r,{OE:()=>N,Ev:()=>d,op:()=>f,_G:()=>L,ED:()=>F,sT:()=>D,wB:()=>o,gR:()=>j,ck:()=>Y,Wk:()=>V,Yv:()=>g,cL:()=>k,mI:()=>Z,aW:()=>c,E7:()=>R,yo:()=>h,qM:()=>a});class h extends Float32Array{constructor(t=0,e=0,i=0){if(super(3),"number"!=typeof t)return this.x=t.x,this.y=t.y,void(this.z=t.z);this.x=t,this.y=e,this.z=i}clone(){return new h(this)}isEqual({x:t,y:e,z:i}){return t===this.x&&e===this.y&&i===this.z}isClose({x:t,y:e,z:i},s=1e-6){return!(Math.abs(t-this.x)>s||Math.abs(e-this.y)>s||Math.abs(i-this.z)>s)}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),[r,n,h]=this,[o,a,c]=t,u=a*h-c*n,l=c*r-o*h,m=o*n-a*r,d=(r*o+n*a+h*c)*(1-i);return this.x=r*i+u*s+o*d,this.y=n*i+l*s+a*d,this.z=h*i+m*s+c*d,this}applyMatrix(t){const{x:e,y:i,z:s}=this;return this.x=e*t.m00+i*t.m10+s*t.m20,this.y=e*t.m01+i*t.m11+s*t.m21,this.z=e*t.m02+i*t.m12+s*t.m22,this}from({x:t,y:e,z:i}){return this.x=t,this.y=e,this.z=i,this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}add(...t){for(const e of t)this[0]+=e[0],this[1]+=e[1],this[2]+=e[2];return this}addWithScale({x:t,y:e,z:i},s=1){return this[0]+=t*s,this[1]+=e*s,this[2]+=i*s,this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}get size(){return Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2])}normalize(){const t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2];return 0===t?this:this.scale(1/Math.sqrt(t))}debug(t="vec3"){const{x:e,y:i,z:s}=this,r=[e,i,s].map((t=>t.toFixed(6)));console.log(`${t}:   `,r.join(" | "))}}class o extends Float32Array{constructor(t=1,e=0,i=0,s=0,r=0,n=1,h=0,o=0,a=0,c=0,u=1,l=0,m=0,d=0,f=0,g=1){super("number"==typeof t?[t,e,i,s,r,n,h,o,a,c,u,l,m,d,f,g]:t)}get translation(){const{m30:t,m31:e,m32:i}=this;return new h(t,e,i)}set translation(t){this.m30=t.x,this.m31=t.y,this.m32=t.z}fromMat3(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this}toAxis(t,e,i){return this.toAxisX(t),this.toAxisY(e),this.toAxisZ(i)}toAxisX(t){return t.x=this.m00,t.y=this.m01,t.z=this.m02,this}toAxisY(t){return t.x=this.m10,t.y=this.m11,t.z=this.m12,this}toAxisZ(t){return t.x=this.m20,t.y=this.m21,t.z=this.m22,this}fromQuat({x:t,y:e,z:i,w:s}){const r=t+t,n=e+e,h=i+i,o=t*r,a=e*r,c=e*n,u=i*r,l=i*n,m=i*h,d=s*r,f=s*n,g=s*h;return this.m00=1-c-m,this.m10=a-g,this.m20=u+f,this.m01=a+g,this.m11=1-o-m,this.m21=l-d,this.m02=u-f,this.m12=l+d,this.m22=1-o-c,this}get m00(){return this[0]}set m00(t){this[0]=t}get m01(){return this[1]}set m01(t){this[1]=t}get m02(){return this[2]}set m02(t){this[2]=t}get m03(){return this[3]}set m03(t){this[3]=t}get m10(){return this[4]}set m10(t){this[4]=t}get m11(){return this[5]}set m11(t){this[5]=t}get m12(){return this[6]}set m12(t){this[6]=t}get m13(){return this[7]}set m13(t){this[7]=t}get m20(){return this[8]}set m20(t){this[8]=t}get m21(){return this[9]}set m21(t){this[9]=t}get m22(){return this[10]}set m22(t){this[10]=t}get m23(){return this[11]}set m23(t){this[11]=t}get m30(){return this[12]}set m30(t){this[12]=t}get m31(){return this[13]}set m31(t){this[13]=t}get m32(){return this[14]}set m32(t){this[14]=t}get m33(){return this[15]}set m33(t){this[15]=t}debug(t="Mat4"){const e=n([this.m00,this.m01,this.m02,this.m03]),i=n([this.m10,this.m11,this.m12,this.m13]),s=n([this.m20,this.m21,this.m22,this.m23]),r=n([this.m30,this.m31,this.m32,this.m33]);console.log(t),console.log("   ",[e[0],i[0],s[0],r[0]].join(" | ")),console.log("   ",[e[1],i[1],s[1],r[1]].join(" | ")),console.log("   ",[e[2],i[2],s[2],r[2]].join(" | ")),console.log("   ",[e[3],i[3],s[3],r[3]].join(" | "))}}class a extends Float32Array{constructor(t=0,e=0,i=0,s=1){return super(4),t instanceof a?(this.x=t.x,this.y=t.y,this.z=t.z,void(this.w=t.w)):t instanceof h?(this.x=t.x,this.y=t.y,this.z=t.z,void(this.w=s)):(this.x=t,this.y=e,this.z=i,void(this.w=s))}reset(t=0,e=0,i=0,s=1){return this.x=t,this.y=e,this.z=i,this.w=s,this}from(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new a(this)}isEqual({x:t,y:e,z:i,w:s}){return t===this.x&&e===this.y&&i===this.z&&s===this.w}isClose({x:t,y:e,z:i,w:s},r=1e-6){return!(Math.abs(t-this.x)>r||Math.abs(e-this.y)>r||Math.abs(i-this.z)>r||Math.abs(s-this.w)>r)}applyMatrix(t){const{x:e,y:i,z:s,w:r}=this;return this.x=e*t.m00+i*t.m10+s*t.m20+r*t.m30,this.y=e*t.m01+i*t.m11+s*t.m21+r*t.m31,this.z=e*t.m02+i*t.m12+s*t.m22+r*t.m32,this.w=e*t.m03+i*t.m13+s*t.m23+r*t.m33,this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}add(...t){for(const e of t)this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],this[3]+=e[3];return this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this[3]-=t[3],this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}get size(){return Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]+this[3]*this[3])}normalize(){const t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2]+this[3]*this[3];return 0===t?this:this.scale(1/Math.sqrt(t))}debug(t="vec4"){const{x:e,y:i,z:s,w:r}=this,n=[e,i,s,r].map((t=>t.toFixed(6)));console.log(`${t}:   `,n.join(" | "))}}class c extends a{constructor(t=0,e=0,i=0,s=1){"number"==typeof t?super(t,e,i,s):super(t)}clone(){return new c(this)}multiply(t){const[e,i,s,r]=this,[n,h,o,a]=t;return this[0]=a*e+n*r-h*s+o*i,this[1]=a*i+n*s+h*r-o*e,this[2]=a*s-n*i+h*e+o*r,this[3]=a*r-n*e-h*i-o*s,this}fromAxis(t,e,i){const s=t.x+e.y+i.z;if(s>0){const r=Math.sqrt(s+1);this.w=.5*r;const n=.5/r;this.x=(e.z-i.y)*n,this.y=(i.x-t.z)*n,this.z=(t.y-e.x)*n}else{const s=[t,e,i];let r=0;e.y>t.x&&(r=1),i.z>s[r][r]&&(r=2);const n=(r+1)%3,h=(r+2)%3;let o=Math.sqrt(s[r][r]-s[n][n]-s[h][h]+1);this[r]=.5*o,o=.5/o,this[3]=(s[n][h]-s[h][n])*o,this[n]=(s[n][r]+s[r][n])*o,this[h]=(s[h][r]+s[r][h])*o}}rotateAroundX(t){const e=.5*t,i=this[0],s=this[1],r=this[2],n=this[3],h=Math.sin(e),o=Math.cos(e);return this[0]=i*o+n*h,this[1]=s*o+r*h,this[2]=r*o-s*h,this[3]=n*o-i*h,this}rotateAroundY(t){const e=.5*t,i=this[0],s=this[1],r=this[2],n=this[3],h=Math.sin(e),o=Math.cos(e);return this[0]=i*o-r*h,this[1]=s*o+n*h,this[2]=r*o+i*h,this[3]=n*o-s*h,this}rotateAroundZ(t){const e=.5*t,i=this[0],s=this[1],r=this[2],n=this[3],h=Math.sin(e),o=Math.cos(e);return this[0]=i*o+s*h,this[1]=s*o-i*h,this[2]=r*o+n*h,this[3]=n*o-r*h,this}toAxisZ(t){const{x:e,y:i,z:s,w:r}=this,n=e+e,h=i+i,o=e*n,a=i*h,c=s*n,u=s*h,l=r*n,m=r*h;return t.x=c+m,t.y=u-l,t.z=1-o-a,t}face(t="+X+Y+Z"){const[e,i,s,r]=l[t];return this.x=e,this.y=i,this.z=s,this.w=r,this}}const u=Math.sqrt(2)/2,l={"+X+Y+Z":[0,0,0,1],"-Z+Y+X":[0,+u,0,+u],"-X+Y-Z":[0,1,0,0],"+Z+Y-X":[0,-u,0,+u]};class m extends Float32Array{constructor(t=1,e=0,i=0,s=0,r=1,n=0,h=0,o=0,a=1){super("number"==typeof t?[t,e,i,s,r,n,h,o,a]:t)}transpose(){let t=this.m10;return this.m10=this.m01,this.m01=t,t=this.m20,this.m20=this.m02,this.m02=t,t=this.m21,this.m21=this.m12,this.m12=t,this}fromQuat({x:t,y:e,z:i,w:s}){const r=t+t,n=e+e,h=i+i,o=t*r,a=e*r,c=e*n,u=i*r,l=i*n,m=i*h,d=s*r,f=s*n,g=s*h;return this.m00=1-c-m,this.m10=a-g,this.m20=u+f,this.m01=a+g,this.m11=1-o-m,this.m21=l-d,this.m02=u-f,this.m12=l+d,this.m22=1-o-c,this}toAxis(t,e,i){return this.toAxisX(t),this.toAxisY(e),this.toAxisZ(i)}toAxisX(t){return t.x=this.m00,t.y=this.m01,t.z=this.m02,this}toAxisY(t){return t.x=this.m10,t.y=this.m11,t.z=this.m12,this}toAxisZ(t){return t.x=this.m20,t.y=this.m21,t.z=this.m22,this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this[4]*=t,this[5]*=t,this[6]*=t,this[7]*=t,this[8]*=t,this}get m00(){return this[0]}set m00(t){this[0]=t}get m01(){return this[1]}set m01(t){this[1]=t}get m02(){return this[2]}set m02(t){this[2]=t}get m10(){return this[3]}set m10(t){this[3]=t}get m11(){return this[4]}set m11(t){this[4]=t}get m12(){return this[5]}set m12(t){this[5]=t}get m20(){return this[6]}set m20(t){this[6]=t}get m21(){return this[7]}set m21(t){this[7]=t}get m22(){return this[8]}set m22(t){this[8]=t}debug(t="Mat3"){const e=n([this.m00,this.m01,this.m02]),i=n([this.m10,this.m11,this.m12]),s=n([this.m20,this.m21,this.m22]);console.log(t),console.log("   ",[e[0],i[0],s[0]].join(" | ")),console.log("   ",[e[1],i[1],s[1]].join(" | ")),console.log("   ",[e[2],i[2],s[2]].join(" | "))}}class d{constructor(){this.dirty=!0,this.dirtyAxis=!0,this.axisX=new h,this.axisY=new h,this.axisZ=new h,this._matrixViewModel=new o,this.orientation=new c(0,0,0,1),this.target=new h(0,0,0),this._distance=10,this._zoom=1,this.tmpMat3=new m,this.tmpVec3=new h,this.orientation.face("+X+Y+Z"),this.orbitAroundY(Math.PI),this.updateAxisIfNeeded(),console.log("****************************************"),this.axisX.debug("X"),this.axisY.debug("Y"),this.axisZ.debug("Z"),this.matrixViewModel.debug(),this.orientation.debug("Quat");const t=(t,e)=>Math.abs(t-e)<1e-5,e=({x:e,y:i,z:s})=>t(e,1)?"+X":t(e,-1)?"-X":t(i,1)?"+Y":t(i,-1)?"-Y":t(s,1)?"+Z":t(s,-1)?"-Z":void 0,i=Math.sqrt(2)/2,s=({x:e,y:s,z:r,w:n})=>[e,s,r,n].map((e=>t(e,0)?"+0":t(e,1)?"+1":t(e,-1)?"-1":t(e,+i)?"+A":t(e,-i)?"-A":e)).join(", "),r=[];for(let t=0;t<4;t++)this.orientation.face("+X+Y+Z"),this.orbitAroundY(t*(Math.PI/2)),this.updateAxisIfNeeded(),this.updateIfNeeded(),r.push(`\n"${e(this.axisX)}${e(this.axisY)}${e(this.axisZ)}": [${s(this.orientation)}],`);console.log(r.join("")),this.orientation.face()}from({orientation:t,target:e,distance:i,zoom:s}){return this.orientation.from(t),this.target.from(e),this.distance=i,this.zoom=s,this.dirty=!0,this.dirtyAxis=!0,this}toAxisZ(t){return this.orientation.toAxisZ(t),this}get matrixViewModel(){return this.updateIfNeeded(),this._matrixViewModel}setOrientation(t){const{orientation:e}=this;if(t.isEqual(e))return;const[i,s,r,n]=t;e.x=i,e.y=s,e.z=r,e.w=n,this.dirty=!0,this.dirtyAxis=!0}setTarget(t){const{target:e}=this;if(t.isEqual(e))return;const[i,s,r]=t;e.x=i,e.y=s,e.z=r,this.dirty=!0}get x(){return this.target.x}set x(t){const{target:e}=this;t!==e.x&&(this.x=t,this.dirty=!0)}get y(){return this.target.y}set y(t){const{target:e}=this;t!==e.y&&(this.y=t,this.dirty=!0)}get z(){return this.target.z}set z(t){const{target:e}=this;t!==e.z&&(this.z=t,this.dirty=!0)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t,this.dirty=!0)}get zoom(){return this._zoom}set zoom(t){this._zoom!==t&&(this._zoom=t,this.dirty=!0)}moveTarget(t,e,i){const{target:s}=this;this.updateAxisIfNeeded();const{axisX:r,axisY:n,axisZ:h,tmpVec3:o}=this;o.from(r).scale(t).addWithScale(n,e).addWithScale(h,i),s.x+=o.x,s.y+=o.y,s.z+=o.z,this.dirty=!0}orbitAroundX(t){this.updateAxisIfNeeded();const{axisX:e,axisY:i,axisZ:s,orientation:r}=this;return i.rotateAround(e,t),s.rotateAround(e,t),r.fromAxis(e,i,s),this.dirty=!0,this}orbitAroundY(t){this.updateAxisIfNeeded();const{axisX:e,axisY:i,axisZ:s,orientation:r}=this;return e.rotateAround(i,t),s.rotateAround(i,t),r.fromAxis(e,i,s),this.dirty=!0,this}orbitAroundZ(t){this.updateAxisIfNeeded();const{axisX:e,axisY:i,axisZ:s,orientation:r}=this;return e.rotateAround(s,t),i.rotateAround(s,t),r.fromAxis(e,i,s),this.dirty=!0,this}updateAxisIfNeeded(){if(!this.dirtyAxis)return;const{tmpMat3:t}=this;t.fromQuat(this.orientation),t.toAxis(this.axisX,this.axisY,this.axisZ),this.dirtyAxis=!1}updateIfNeeded(){if(!this.dirty)return;const{tmpMat3:t,tmpVec3:e}=this,i=this._matrixViewModel;this.dirtyAxis=!0,this.updateAxisIfNeeded();const s=this._distance,{x:r,y:n,z:h}=this.target,{x:o,y:a,z:c}=this.axisZ;e.x=r+s*o,e.y=n+s*a,e.z=h+s*c,e.applyMatrix(t.transpose()).scale(-1),i.m30=e.x,i.m31=e.y,i.m32=e.z;const u=this._zoom;1!==u&&t.scale(u),i.fromMat3(t),this.dirty=!1}}class f extends d{constructor(){super(),this.dirtyProjection=!0,this._matrixProjection=new o,this._width=1920,this._height=1080,this._fovy=Math.PI/4,this._near=.001,this._far=1/0}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this.dirtyProjection=!0)}get height(){return this._height}set height(t){t!==this._height&&(this._height=t,this.dirtyProjection=!0)}get fovy(){return this._fovy}set fovy(t){t!==this._fovy&&(this._fovy=t,this.dirtyProjection=!0)}get near(){return this._near}set near(t){t!==this._near&&(this._near=t,this.dirtyProjection=!0)}get far(){return this._far}set far(t){t!==this._far&&(this._far=t,this.dirtyProjection=!0)}get matrixProjection(){return this.updateProjectionIfNeeded(),this._matrixProjection}updateProjectionIfNeeded(){if(!this.dirtyProjection)return;const t=this._fovy,e=this._width/this._height,i=this._near,s=this._far,r=this._matrixProjection,n=1/Math.tan(t/2);if(r[0]=n/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,s!==1/0){const t=1/(i-s);r[10]=(s+i)*t,r[14]=2*s*i*t}else r[10]=-1,r[14]=-2*i;this.dirtyProjection=!0}}class g{constructor(t=[]){this.enabled=!0,this.painters=[...t]}add(...t){for(const e of t)this.painters.push(e)}remove(...t){for(const e of t){const t=this.painters.indexOf(e);t<0||(this.painters.splice(t,1),e.delete())}}delete(){for(const t of this.painters)t.delete();this.painters.splice(0,this.painters.length)}paint(t,e){if(this.enabled)for(const i of this.painters)i.paint(t,e)}update(t,e){if(this.enabled)for(const i of this.painters)i.update(t,e)}}class x{constructor(){this.keys=new Map,this.objects=new Map,this.references=new Map}create(t){var e;const i=this.makeKeyFromInput(t),s=null!==(e=this.references.get(i))&&void 0!==e?e:0;if(s<1){const e=this.actualCreate(t);return this.keys.set(e,i),this.objects.set(i,e),this.references.set(i,1),e}const r=this.objects.get(i);if(!r)throw Error("[TgdResource.create] Panic!");return this.references.set(i,s+1),r}delete(t){var e;const i=this.keys.get(t);if(!i)return;const s=null!==(e=this.references.get(i))&&void 0!==e?e:0;s<1||(s>1?this.references.set(i,s-1):(this.keys.delete(t),this.objects.delete(i),this.references.delete(i),this.actualDelete(t)))}}class p{constructor(t,e){var i;this.gl=t;const s=t.createProgram();if(!s)throw Error("Unable to create WebGLProgram!");const r=this.createShader("VERTEX_SHADER",e.vert);t.attachShader(s,r);const n=this.createShader("FRAGMENT_SHADER",e.frag);if(t.attachShader(s,n),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)){var h=null!==(i=t.getProgramInfoLog(s))&&void 0!==i?i:"";console.warn(h);const r=v(h);throw b("Vertex Shader",e.vert,...r),b("Fragment Shader",e.frag,...r),new Error("Could NOT link WebGL2 program!\n"+h)}this.program=s,this.shaders=[r,n],this.uniformsLocations=this.getUniformsLocations()}getAttribLocation(t){const{gl:e,program:i}=this,s=e.getAttribLocation(i,t);if(s<0)throw Error(`Attribute "${t}" not found!`);return s}getUniformLocation(t){const{uniformsLocations:e}=this,i=Object.keys(e);if(0===t.length)throw Error(`Uniform "${t}" has not been found: there is no active uniform in this program!`);const s=e[t];if(!s)throw Error(`No active uniform found with name "${t}"!\nAvailable names are: ${i.join(", ")}.`);return s}uniform1f(t,e){const{gl:i}=this;i.uniform1f(this.getUniformLocation(t),e)}uniform2f(t,e,i){const{gl:s}=this;s.uniform2f(this.getUniformLocation(t),e,i)}uniform3f(t,e,i,s){const{gl:r}=this;r.uniform3f(this.getUniformLocation(t),e,i,s)}uniform3fv(t,e){const{gl:i}=this;i.uniform3fv(this.getUniformLocation(t),e)}uniform4f(t,e,i,s,r){const{gl:n}=this;n.uniform4f(this.getUniformLocation(t),e,i,s,r)}uniform4fv(t,e){const{gl:i}=this;i.uniform4fv(this.getUniformLocation(t),e)}uniform1i(t,e){const{gl:i}=this;i.uniform1i(this.getUniformLocation(t),e)}uniform2i(t,e,i){const{gl:s}=this;s.uniform2i(this.getUniformLocation(t),e,i)}uniform3i(t,e,i,s){const{gl:r}=this;r.uniform3i(this.getUniformLocation(t),e,i,s)}uniform4i(t,e,i,s,r){const{gl:n}=this;n.uniform4i(this.getUniformLocation(t),e,i,s,r)}uniform1ui(t,e){const{gl:i}=this;i.uniform1ui(this.getUniformLocation(t),e)}uniform2ui(t,e,i){const{gl:s}=this;s.uniform2ui(this.getUniformLocation(t),e,i)}uniform3ui(t,e,i,s){const{gl:r}=this;r.uniform3ui(this.getUniformLocation(t),e,i,s)}uniform4ui(t,e,i,s,r){const{gl:n}=this;n.uniform4ui(this.getUniformLocation(t),e,i,s,r)}uniformMatrix4fv(t,e){const{gl:i}=this;i.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}use(){const{gl:t,program:e}=this;t.useProgram(e)}delete(){const{gl:t}=this;this.shaders.forEach((e=>t.deleteShader(e))),t.deleteProgram(this.program)}createShader(t,e){const{gl:i}=this,s=i.createShader(i[t]);if(!s)throw Error(`Unable to create a WebGLShader of type "${t}"!`);i.shaderSource(s,e),i.compileShader(s);const r=i.getShaderInfoLog(s);if(r)throw console.error(`Error in ${t} code:`,r),b(t,e,...v(r)),Error(`Unable to compile ${t}!`);return s}getUniformsLocations(){const{gl:t,program:e}=this,i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);if("number"!=typeof i)throw Error("Unable to get the number of uniforms in a WebGLProgram!");const s={};for(let r=0;r<i;r++){const i=t.getActiveUniform(e,r);if(!i)continue;const n=t.getUniformLocation(e,i.name);if(null===n)throw Error(`Unable to get location for uniform "${i.name}"!`);s[i.name]=n}return s}}const y=/^ERROR:[ \t]+([0-9]+):([0-9]+):/g;function v(t){const e=[];for(const i of t.split("\n")){y.lastIndex=-1;const t=y.exec(i);t&&e.push(parseInt(t[2],10))}return e}function w(t,e=!1){return`color:#fff;background:${t};font-family:monospace;font-size:80%;font-weight:${e?"bolder":"100"}`}function b(t,e,...i){console.log(`%c${t}`,"font-weight:bolder;font-size:120%"),e.split("\n").forEach(((t,e)=>{const s=e+1,r=(1e-4*s).toFixed(4).substring(2),n=i.includes(s)?"#f00":"#000";console.log(`%c${r}  %c${t}`,w(n),w(n,!0))}))}class E extends x{constructor(t){super(),this.gl=t}actualCreate(t){return new p(this.gl,t)}actualDelete(t){t instanceof p&&t.delete()}makeKeyFromInput(t){return JSON.stringify(t)}}var A=function(t,e,i,s){return new(i||(i=Promise))((function(r,n){function h(t){try{a(s.next(t))}catch(t){n(t)}}function o(t){try{a(s.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(h,o)}a((s=s.apply(t,e||[])).next())}))};class _{static image(t){return A(this,void 0,void 0,(function*(){return new Promise((e=>{const i=new Image;i.onload=()=>e(i),i.onerror=()=>{console.error("Unable to load image: ",t),e(null)},i.src=t}))}))}static canvas(t){return A(this,void 0,void 0,(function*(){const e=yield _.image(t);if(!e)return null;const i=document.createElement("canvas");i.width=e.naturalWidth,i.height=e.naturalHeight;const s=i.getContext("2d");if(!s)throw Error("Unable to get a 2D context!");return s.drawImage(e,0,0),i}))}}class P{constructor(){this.listeners=new Set}addListener(t){this.listeners.add(t)}removeListener(t){this.listeners.delete(t)}dispatch(t){this.listeners.forEach((e=>e(t)))}}const T=new Uint8Array([200,200,200,255]);class U{constructor(t,e,i={}){this.gl=t,this.refresh=e,this.eventImageUpdate=new P,this._width=0,this._height=0,this._image=null,this.options=Object.assign({wrapS:"REPEAT",wrapT:"REPEAT",wrapR:"REPEAT",minFilter:"NEAREST_MIPMAP_LINEAR",magFilter:"LINEAR"},i);const s=t.createTexture();if(!s)throw Error("Unable to create a WebGLTexture!");this.texture=s,t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,T);const{wrapS:r,wrapT:n,wrapR:h,minFilter:o,magFilter:a}=this.options;t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[r]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[n]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_R,t[h]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[o]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[a]),i.image&&this.loadImage(i.image)}delete(){this.gl.deleteTexture(this.texture)}get image(){return this._image}get width(){return this._width}get height(){return this._height}bind(){const{gl:t}=this;t.bindTexture(t.TEXTURE_2D,this.texture)}activate(t,e,i=0){const{gl:s,texture:r}=this;s.activeTexture(s.TEXTURE0+i),s.bindTexture(s.TEXTURE_2D,r),t.uniform1i(e,i)}loadImage(t){if("string"==typeof t)return void _.image(t).then((e=>{e?(this.loadImage(e),this.refresh()):console.error("[TgdTexture2D]Unable to load image:",t)})).catch(console.error);const{gl:e,texture:i}=this;e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),this._width=t.width,this._height=t.height,this._image=t,this.eventImageUpdate.dispatch(this)}}class z extends x{constructor(t,e){super(),this.gl=t,this.refresh=e}actualCreate(t){return new U(this.gl,this.refresh,t)}actualDelete(t){t instanceof U&&t.delete()}makeKeyFromInput(t){return t}}class M{constructor(t,e,i){var s,r;this.gl=t;const n=t.createBuffer();if(!n)throw Error("Unable to create WebGLBuffer!");this._target=null!==(s=null==i?void 0:i.target)&&void 0!==s?s:"ARRAY_BUFFER",this._usage=null!==(r=null==i?void 0:i.usage)&&void 0!==r?r:"STATIC_DRAW",this.buffer=n,e&&this.bufferData(e,i)}get target(){return this._target}bind(t){const{gl:e,buffer:i}=this;this._target=null!=t?t:this._target,e.bindBuffer(e[this._target],i)}bufferData(t,e={}){var i;const{gl:s}=this;this.bind(e.target),this._usage=null!==(i=e.usage)&&void 0!==i?i:this._usage,s.bufferData(s[this._target],t,s[this._usage])}delete(){const{gl:t,buffer:e}=this;t.deleteBuffer(e)}}class R{constructor(t,e,i,s){this.gl=t,this.drawBuffers=[],this.elemBuffer=null;const r=t.createVertexArray();if(!r)throw Error("Unable to create VertexArrayObject!");if(this.vao=r,e&&i){if(t.bindVertexArray(r),this.drawBuffers=i.map((i=>{const s=new M(t,i.dataView,{target:i.target,usage:i.usage});return s.bind(),i.defineAttributes(t,e),s})),s){const e=new M(t,s,{target:"ELEMENT_ARRAY_BUFFER"});e.bind(),this.elemBuffer=e}t.bindVertexArray(null)}}bind(){this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}delete(){const{gl:t,vao:e,drawBuffers:i,elemBuffer:s}=this;t.deleteVertexArray(e),i.forEach((t=>t.delete())),s&&s.delete()}}class L{constructor(t,e={}){var i;this.canvas=t,this.painters=new g,this.isPlaying=!1,this.requestAnimationFrame=-1,this.lastTime=-1,this.paint=()=>{window.cancelAnimationFrame(this.requestAnimationFrame),this.requestAnimationFrame=window.requestAnimationFrame(this.actualPaint)},this.actualPaint=t=>{const{lastTime:e}=this;if(e<0)return this.lastTime=t,void this.paint();const i=t-this.lastTime;this.lastTime=t,this.painters.paint(t,i),this.painters.update(t,i),this.isPlaying&&this.paint()};const s=t.getContext("webgl2",e);if(!s)throw Error("Unable to create a WebGL2 context!");this.gl=s,this.programs=new E(s),this.textures2D=new z(s,this.paint);const r=null!==(i=e.onResize)&&void 0!==i?i:I;this.observer=new ResizeObserver((()=>{r(s,t.clientWidth,t.clientHeight)})),this.observer.observe(t)}get width(){return this.gl.drawingBufferWidth}get height(){return this.gl.drawingBufferHeight}get playing(){return this.isPlaying}set playing(t){t!==this.isPlaying&&(t&&this.paint(),this.isPlaying=t)}play(){this.playing=!0}pause(){this.playing=!1}add(...t){this.painters.add(...t)}remove(...t){this.painters.remove(...t)}createBuffer(t,e){return new M(this.gl,t,e)}createVAO(t,e,i){return new R(this.gl,t,e,i)}destroy(){window.cancelAnimationFrame(this.requestAnimationFrame),this.playing=!1,this.painters.delete(),this.observer.unobserve(this.canvas)}}function I(t,e,i){const s=t.canvas;s.width=e,s.height=i,t.viewport(0,0,e,i)}class N{constructor(){this.keys=new Set,this.attached=!1,this.handleKeyDown=t=>{this.keys.add(t.key)},this.handleKeyUp=t=>{this.keys.delete(t.key)},document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),this.attached=!0}detach(){this.attached&&(document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.attached=!1)}isPressed(...t){for(const e of t)if(!this.keys.has(e))return!1;return!0}}class S{constructor(t){this.options=t,this.start={x:0,y:0,t:0},this.current={x:0,y:0,t:0},this.previous={x:0,y:0,t:0},this.canvas=null,this.active=!1,this.canvasX=0,this.canvasY=0,this.screenX=0,this.screenY=0,this.handleCanvasWheel=t=>{const{onZoom:e}=this.options;e&&e(t.deltaY,(()=>t.preventDefault()))},this.handleCanvasPointerDown=t=>{this.canvasX=t.clientX,this.canvasY=t.clientY,this.active=!0},this.handlePointerDown=t=>{var e,i;if(!this.active)return;this.screenX=t.clientX,this.screenY=t.clientY;const s=this.getPoint(t);this.start=this.current=s,null===(i=(e=this.options).onMoveStart)||void 0===i||i.call(e,s)},this.handlePointerMove=t=>{var e,i;this.active&&this.canvas&&(this.previous=this.current,this.current=this.getPoint(t),null===(i=(e=this.options).onMove)||void 0===i||i.call(e,this))},this.handlePointerUp=t=>{var e,i;this.active&&(null===(i=(e=this.options).onMoveEnd)||void 0===i||i.call(e,this.getPoint(t)),this.active=!1)},t.canvas&&this.attach(t.canvas)}get element(){return this.canvas}attach(t){this.detach(),this.canvas=t,t.addEventListener("pointerdown",this.handleCanvasPointerDown,!0),t.addEventListener("wheel",this.handleCanvasWheel),document.addEventListener("pointerdown",this.handlePointerDown),document.addEventListener("pointermove",this.handlePointerMove),document.addEventListener("pointerup",this.handlePointerUp)}detach(){const{canvas:t}=this;t&&(t.removeEventListener("pointerdown",this.handleCanvasPointerDown),t.removeEventListener("wheel",this.handleCanvasWheel),document.removeEventListener("pointerdown",this.handlePointerDown),document.removeEventListener("pointermove",this.handlePointerMove),document.removeEventListener("pointerup",this.handlePointerUp),this.canvas=null)}getPoint(t){if(!this.canvas)throw Error("No canvas has been defined!");const{left:e,top:i,width:s,height:r}=this.canvas.getBoundingClientRect();return{x:2*((this.canvasX+t.clientX-this.screenX-e)/s-.5),y:-2*((this.canvasY+t.clientY-this.screenY-i)/r-.5),t:t.timeStamp}}}class F{constructor(t){this.camera=t,this.pointer=null,this.keyboard=new N,this.handleMoveStart=({x:t,y:e,t:i})=>{},this.handleMove=t=>{const{camera:e,keyboard:i}=this;if(t.current.t-t.previous.t<=0)return;if(i.isPressed("z")){const i=t.previous.x,s=t.previous.y;if(Math.abs(i)+Math.abs(s)===0)return;const r=t.current.x,n=t.current.y;if(Math.abs(r)+Math.abs(n)===0)return;const h=i*r+s*n,o=i*n-s*r,a=Math.atan2(o,h);return void e.orbitAroundZ(-a)}const s=2*(t.current.x-t.previous.x),r=2*(t.current.y-t.previous.y);i.isPressed("x")||e.orbitAroundY(-s),i.isPressed("y")||e.orbitAroundX(r)},this.handleZoom=(t,e)=>{const{camera:i}=this,s=.001*-t;i.zoom=Math.max(1,i.zoom+s),e()}}attach(t){this.pointer&&this.pointer.detach(),this.pointer=new S({canvas:t,onMoveStart:this.handleMoveStart,onMove:this.handleMove,onZoom:this.handleZoom})}detach(){this.pointer&&(this.pointer.detach(),this.pointer=null)}}class D{constructor(t,e={}){var i,s,r;this.data=null,this.count=0,this.target=null!==(i=e.target)&&void 0!==i?i:"ARRAY_BUFFER",this.usage=null!==(s=e.usage)&&void 0!==s?s:"STATIC_DRAW";const n=null!==(r=e.divisor)&&void 0!==r?r:0;let h=0;const o={},a={};for(const e of Object.keys(t)){const i=e;o[e]=new ArrayBuffer(0);const s={dimension:X[t[i]],bytesOffset:h,bytesPerElement:Float32Array.BYTES_PER_ELEMENT,divisor:n,getter:(t,e)=>(e>=t.byteLength&&(e%=t.byteLength),t.getFloat32(e)),setter(t,e,i){t.setFloat32(e,i)}};a[e]=s,h+=s.bytesPerElement*s.dimension}this.dataPerAttribute=o,this.definitions=a,this.stride=h}set(t,e){var i;if((i=e)&&"object"==typeof i&&e.buffer instanceof ArrayBuffer&&(e=e.buffer),this.dataPerAttribute[t]===e)return;this.dataPerAttribute[t]=e;const{bytesPerElement:s,dimension:r}=this.definitions[t];this.count=Math.max(this.count,Math.ceil(e.byteLength/(s*r))),this.data=null}get dataView(){if(!this.data){const t=new ArrayBuffer(this.stride*this.count),e=new DataView(t);let i=0;const{dataPerAttribute:s,definitions:r}=this;for(let t=0;t<this.count;t++)for(const n of Object.keys(r)){const h=r[n],o=s[n],a=new DataView(o);let c=h.bytesPerElement*h.dimension*t;for(let t=0;t<h.dimension;t++)h.setter(e,i,h.getter(a,c)),c+=h.bytesPerElement,i+=h.bytesPerElement}this.data=new DataView(t)}return this.data}defineAttributes(t,e){let i=0;const{definitions:s}=this;for(const r of Object.keys(s)){const n=s[r],h=e.getAttribLocation(r);t.enableVertexAttribArray(h),t.vertexAttribPointer(h,n.dimension,t.FLOAT,!1,this.stride,i),t.vertexAttribDivisor(h,n.divisor),i+=n.dimension*n.bytesPerElement}}}const X={float:1,vec2:2,vec3:3,vec4:4};class j{}class Y{constructor(t,e,{x:i=0,y:s=0,z:r=1,zoom:n=1}={}){this.context=t,this.zoom=1,this.x=0,this.y=0,this.z=1,this.x=i,this.y=s,this.z=r,this.zoom=n,this.texture=e,this.program=t.programs.create({vert:"#version 300 es\n\nuniform float uniZoom;\nuniform vec2 uniScale;\nuniform vec2 uniScroll;\nuniform float uniZ;\nin vec2 attPoint;\nin vec2 attUV;\nout vec2 varUV;\n\nvoid main() {\n    varUV = (attUV + uniScroll) * uniZoom;\n    float x = uniScale.x * attPoint.x;\n    float y = uniScale.y * attPoint.y;\n    gl_Position = vec4(x, y, uniZ, 1.0);\n}",frag:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D uniTexture;\nin vec2 varUV;\nout vec4 FragColor;\n\nvoid main() {\n    FragColor = texture(uniTexture, varUV);\n}"});const h=new D({attPoint:"vec2",attUV:"vec2"});h.set("attPoint",new Float32Array([-1,1,1,1,-1,-1,1,-1])),h.set("attUV",new Float32Array([0,0,1,0,0,1,1,1])),this.vao=t.createVAO(this.program,[h])}delete(){const{vao:t}=this;t.delete}paint(t,e){const{gl:i}=this.context,{vao:s,program:r,texture:n,zoom:h,x:o,y:a,z:c}=this;r.use();const{width:u,height:l}=this.context,m=n.width*l>n.height*u,d=m?n.width*l/(u*n.height):1,f=m?1:n.height*u/(l*n.width);r.uniform2f("uniScale",d,f),r.uniform2f("uniScroll",o,a),r.uniform1f("uniZoom",1/h),r.uniform1f("uniZ",c),n.activate(r,"uniTexture"),s.bind(),i.drawArrays(i.TRIANGLE_STRIP,0,4)}update(t,e){}}class V{constructor(t,e={}){var i,s;this.context=t,this.clearMask=0,this.red=1,this.green=.7,this.blue=0,this.alpha=1,this.depth=1;const{gl:r}=t,n=null!==(i=e.color)&&void 0!==i?i:[0,0,0,1],h=null!==(s=e.depth)&&void 0!==s?s:1;this.clearMask=0;let o=!1;if(e.color&&(this.clearMask|=r.COLOR_BUFFER_BIT,o=!0),"number"==typeof e.depth&&(this.clearMask|=r.DEPTH_BUFFER_BIT,o=!0),!o)throw Error("[TgdPainterClear] You must give at least a color or a depth in the constructor!");[this.red,this.green,this.blue,this.alpha]=n,this.depth=h}delete(){}paint(t,e){const{clearMask:i,context:s,red:r,green:n,blue:h,alpha:o,depth:a}=this,{gl:c}=s;c.clearColor(r,n,h,o),c.clearDepth(a),c.clear(i)}update(t,e){}}class k{constructor(t){this.logicFunction=t}delete(){}paint(t,e){}update(t,e){this.logicFunction(t,e)}}class Z{constructor(){this.name="Mesh",this.attPosition=[],this.attNormal=[],this.attUV=[],this.elements=[],this.elementIndex=0,this.vertices=[],this.normals=[],this.uvs=[],this.map=new Map,this.onObject=t=>{this.name=t},this.onVertex=(t,e,i)=>{this.vertices.push([t,e,i])},this.onNormal=(t,e,i)=>{this.normals.push([t,e,i])},this.onTexture=(t,e)=>{this.uvs.push([t,e])},this.onFace=t=>{if(3!==t.length)throw Error("We can only deal with triangles!");t.forEach((t=>this.elements.push(this.getElem(t))))}}parse(t){this.reset();const{onVertex:e,onNormal:i,onTexture:s,onFace:r,onObject:n,name:h,elements:o}=this;!function(t,e={}){const{onVertex:i,onNormal:s,onTexture:r,onFace:n,onObject:h}=e;for(const e of function*(t){const e=t.length;let i=0,s=0;for(;i>-1&&i<e&&(i=t.indexOf("\n",s),!(i<0));)yield t.substring(s,i).trim(),s=i+1;return t.substring(s).trim()}(t)){const t=e.trimStart();if(i&&t.startsWith("v ")){const e=t.substring(2).split(" ").map((t=>Number(t)));O(e)&&i(...e)}else if(n&&t.startsWith("f "))n(t.substring(2).split(" ").map((t=>{const[e,i,s]=t.split("/");return{vertex:Number(e)-1,normal:s?Number(s)-1:void 0,uv:i?Number(i)-1:void 0}})));else if(s&&t.startsWith("vn ")){const e=t.substring(3).split(" ").map((t=>Number(t)));O(e)&&s(...e)}else if(r&&t.startsWith("vt ")){const[e,i,s]=t.substring(3).split(" ").map((t=>Number(t)));r(e,i,s)}else h&&t.startsWith("o ")&&h(t.substring(2))}}(t,{onVertex:e,onNormal:i,onTexture:s,onFace:r,onObject:n});const a={name:h,count:Math.floor(o.length/3),attPosition:new Float32Array(this.attPosition)};this.attNormal.length>0&&(a.attNormal=new Float32Array(this.attNormal)),this.attUV.length>0&&(a.attUV=new Float32Array(this.attUV)),console.log("ðŸš€ [wavefront] this.attUV = ",this.attUV);const{elementIndex:c}=this;return c<=256?(console.log("UNSIGNED_BYTE"),Object.assign(Object.assign({},a),{type:"UNSIGNED_BYTE",elements:new Uint8Array(o)})):c<=65536?(console.log("UNSIGNED_SHORT"),Object.assign(Object.assign({},a),{type:"UNSIGNED_SHORT",elements:new Uint16Array(o)})):(console.log("UNSIGNED_INT"),Object.assign(Object.assign({},a),{type:"UNSIGNED_INT",elements:new Uint32Array(o)}))}reset(){this.name="Mesh",this.attPosition=[],this.attNormal=[],this.attUV=[],this.elements=[],this.elementIndex=0,this.vertices=[],this.normals=[],this.uvs=[],this.map.clear()}getElem(t){var e;const i=this.key(t),s=null!==(e=this.map.get(i))&&void 0!==e?e:-1;if(s>-1)return s;const[r,n,h]=this.vertices[t.vertex];if(this.attPosition.push(r,n,h),"number"==typeof t.normal){const[e,i,s]=this.normals[t.normal];this.attNormal.push(e,i,s)}if("number"==typeof t.uv){const[e,i]=this.uvs[t.uv];this.attUV.push(e,i)}return this.map.set(i,this.elementIndex),this.elementIndex++}key(t){return`${t.vertex}/${t.normal}`}}function O(t){return 3===t.length}var B=r.OE,W=r.op,C=r._G,G=r.ED,$=r.sT,q=r.ck,K=r.Wk,H=r.cL,Q=r.mI,J=r.aW,tt=r.yo}}]);