"use strict";(self.webpackChunk_tolokoban_tgd=self.webpackChunk_tolokoban_tgd||[]).push([[9874],{45:(e,n,t)=>{t.r(n),t.d(n,{default:()=>O});var a=t(4848),s=t(8453),o=t(6540),i=t(5968),c=t(2212),r=t(4461),l=t(6989);const m=t.p+"img/posX.477821fd8ce0371465cf.webp",g=t.p+"img/posY.be8f41edae8403012724.webp",d=t.p+"img/posZ.42b2b232839f49074279.webp",u=t.p+"img/negX.a12236ce5d065e14c8b8.webp",h=t.p+"img/negY.d6cc68c5b1907e80b22e.webp",p=t.p+"img/negZ.e44ef1ce873f6aa34ddc.webp";var x=t(5072),f=t.n(x),b=t(7825),w=t.n(b),y=t(7659),C=t.n(y),j=t(5056),P=t.n(j),v=t(540),N=t.n(v),T=t(1113),k=t.n(T),_=t(5913),X={};X.styleTagTransform=k(),X.setAttributes=P(),X.insert=C().bind(null,"head"),X.domAPI=w(),X.insertStyleElement=N(),f()(_.A,X);const Y=_.A&&_.A.locals?_.A.locals:void 0;function Z(){const[e,n]=o.useState(null),t=o.useRef(null),s=n=>{const a=t.current;if(!e||!a)return;const s=r.HIE.fromFace(n);a.animSchedule({action:(0,r.$4L)(e.transfo,{},{orientation:s}),duration:.3,easingFunction:r.Wcc})};return(0,a.jsx)(l.A,{className:Y.skybox,gizmo:!0,onReady:(e,a)=>{const s=function(e,n){const t=new r.xNY({transfo:{distance:6}});e.camera=t,new r.pwt(e,{inertiaOrbit:1e3}),e.camera.debug();const a=new r.$ff(e,{camera:e.camera,imagePosX:n.image.imagePosX,imagePosY:n.image.imagePosY,imagePosZ:n.image.imagePosZ,imageNegX:n.image.imageNegX,imageNegY:n.image.imageNegY,imageNegZ:n.image.imageNegZ}),s=new r.o57(e,{depth:1}),o=new r.g6h(e),i=new r.SBc(e,{scale:3}),c=new r.Ipk(e,{depth:r.Eg5.lessOrEqual,children:[i,o,a]});return e.add(s,c),e.paint(),{camera:t}}(e,a);n(s.camera),t.current=e},assets:{image:{imagePosX:m,imagePosY:g,imagePosZ:d,imageNegX:u,imageNegY:h,imageNegZ:p}},children:(0,a.jsxs)("footer",{className:Y.footer,children:[(0,a.jsx)(i.yQN,{onClick:()=>s("+X+Y+Z"),children:"Reset"}),(0,a.jsx)(i.yQN,{onClick:()=>s("-Z-Y-X"),children:"+X"}),(0,a.jsx)(i.yQN,{onClick:()=>s("+X+Z-Y"),children:"+Y"}),(0,a.jsx)(i.yQN,{onClick:()=>s("+X-Y-Z"),children:"+Z"}),(0,a.jsx)(i.yQN,{onClick:()=>s("+Z-Y+X"),children:"-X"}),(0,a.jsx)(i.yQN,{onClick:()=>s("+X-Z+Y"),children:"-Y"}),(0,a.jsx)(i.yQN,{onClick:()=>s("-X-Y+Z"),children:"-Z"})]})})}const B={"Detail #1":"    const camera = new TgdCameraPerspective({\n        transfo: {\n            distance: 6,\n        },\n    })\n    context.camera = camera\n    new TgdControllerCameraOrbit(context, {\n        inertiaOrbit: 1000,\n    })\n    context.camera.debug()\n    const skybox = new TgdPainterSkybox(context, {\n        camera: context.camera,\n        imagePosX: assets.image.imagePosX,\n        imagePosY: assets.image.imagePosY,\n        imagePosZ: assets.image.imagePosZ,\n        imageNegX: assets.image.imageNegX,\n        imageNegY: assets.image.imageNegY,\n        imageNegZ: assets.image.imageNegZ,\n    })\n    const clear = new TgdPainterClear(context, {\n        depth: 1,\n    })\n    const cube = new TgdPainterMesh(context)\n    const axes = new TgdPainterAxes(context, { scale: 3 })\n    const state = new TgdPainterState(context, {\n        depth: webglPresetDepth.lessOrEqual,\n        children: [axes, cube, skybox],\n    })\n    context.add(clear, state)\n    context.paint()\n    return { camera }"},A='import React from "react"\nimport {\n    tgdActionCreateTransfoInterpolation,\n    TgdCamera,\n    TgdCameraPerspective,\n    TgdContext,\n    TgdControllerCameraOrbit,\n    tgdEasingFunctionInOutBounce,\n    tgdEasingFunctionInOutCubic,\n    TgdGeometryBox,\n    TgdMat3,\n    TgdPainterAxes,\n    TgdPainterClear,\n    TgdPainterLogic,\n    TgdPainterMesh,\n    TgdPainterSkybox,\n    TgdPainterState,\n    TgdQuat,\n    TgdQuatFace,\n    TgdTransfo,\n    TgdVec3,\n    webglPresetDepth,\n} from "@tolokoban/tgd"\n\nimport View, { Assets } from "@/components/demo/Tgd"\nimport { ViewButton } from "@tolokoban/ui"\n\nimport imagePosX from "./posX.webp" // +X\nimport imagePosY from "./posY.webp" // +Y\nimport imagePosZ from "./posZ.webp" // +Z\nimport imageNegX from "./negX.webp" // -X\nimport imageNegY from "./negY.webp" // -Y\nimport imageNegZ from "./negZ.webp" // -Z\n\nimport styles from "./skybox.demo.module.css"\n\nfunction init(\n    context: TgdContext,\n    assets: Assets\n): {\n    camera: TgdCamera\n} {\n    const camera = new TgdCameraPerspective({\n        transfo: {\n            distance: 6,\n        },\n    })\n    context.camera = camera\n    new TgdControllerCameraOrbit(context, {\n        inertiaOrbit: 1000,\n    })\n    context.camera.debug()\n    const skybox = new TgdPainterSkybox(context, {\n        camera: context.camera,\n        imagePosX: assets.image.imagePosX,\n        imagePosY: assets.image.imagePosY,\n        imagePosZ: assets.image.imagePosZ,\n        imageNegX: assets.image.imageNegX,\n        imageNegY: assets.image.imageNegY,\n        imageNegZ: assets.image.imageNegZ,\n    })\n    const clear = new TgdPainterClear(context, {\n        depth: 1,\n    })\n    const cube = new TgdPainterMesh(context)\n    const axes = new TgdPainterAxes(context, { scale: 3 })\n    const state = new TgdPainterState(context, {\n        depth: webglPresetDepth.lessOrEqual,\n        children: [axes, cube, skybox],\n    })\n    context.add(clear, state)\n    context.paint()\n    return { camera }\n}\n\nexport default function Demo() {\n    const [camera, setCamera] = React.useState<TgdCamera | null>(null)\n    const refContext = React.useRef<TgdContext | null>(null)\n    const handleReady = (context: TgdContext, assets: Assets) => {\n        const resources = init(context, assets)\n        setCamera(resources.camera)\n        refContext.current = context\n    }\n    const face = (value: TgdQuatFace) => {\n        const context = refContext.current\n        if (!camera || !context) return\n\n        const orientation = TgdQuat.fromFace(value)\n        context.animSchedule({\n            action: tgdActionCreateTransfoInterpolation(\n                camera.transfo,\n                {},\n                {\n                    orientation,\n                }\n            ),\n            duration: 0.3,\n            easingFunction: tgdEasingFunctionInOutCubic,\n        })\n    }\n    return (\n        <View\n            className={styles.skybox}\n            gizmo\n            onReady={handleReady}\n            assets={{\n                image: {\n                    imagePosX,\n                    imagePosY,\n                    imagePosZ,\n                    imageNegX,\n                    imageNegY,\n                    imageNegZ,\n                },\n            }}\n        >\n            <footer className={styles.footer}>\n                <ViewButton onClick={() => face("+X+Y+Z")}>Reset</ViewButton>\n                <ViewButton onClick={() => face("-Z-Y-X")}>+X</ViewButton>\n                <ViewButton onClick={() => face("+X+Z-Y")}>+Y</ViewButton>\n                <ViewButton onClick={() => face("+X-Y-Z")}>+Z</ViewButton>\n                <ViewButton onClick={() => face("+Z-Y+X")}>-X</ViewButton>\n                <ViewButton onClick={() => face("+X-Z+Y")}>-Y</ViewButton>\n                <ViewButton onClick={() => face("-X-Y+Z")}>-Z</ViewButton>\n            </footer>\n        </View>\n    )\n}\n';function R(){const[e,n]=o.useState(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"half-left",children:(0,a.jsx)(Z,{})}),(0,a.jsxs)("div",{className:"half-right",children:[(0,a.jsx)("div",{children:(0,a.jsx)(i.yQN,{variant:"elevated",onClick:()=>n(!e),children:e?"Show code details":"Show full code"})}),(0,a.jsx)(c.A,{language:"tsx",value:e?A:B})]})]})}const E=t.p+"img/textures.870cc511ead6a1154c14.jpg";function S(e){const n={a:"a",code:"code",h1:"h1",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{children:"Texture Cube"}),"\n",(0,a.jsx)(R,{}),"\n",(0,a.jsx)(n.p,{children:"To create a TextureCube, you need six square images of the same size."}),"\n",(0,a.jsxs)(n.p,{children:["One easy way to get such images is to get an HDRI environment from\n",(0,a.jsx)(n.a,{href:"https://polyhaven.com/hdris",children:"Polyhaven"})," (or any other free website) and to use\nit in a Blender scene."]}),"\n",(0,a.jsx)(n.p,{children:"Once you are happy with the result, set a square rendering viewport (ex.: 1024x1024)\nand execute this script:"}),"\n",(0,a.jsxs)("details",{children:[(0,a.jsx)("summary",{children:"Blender's Python Script"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"hljs language-python",children:'import bpy\nimport math\nimport mathutils\n\n# Save the current active camera\noriginal_camera = bpy.context.scene.camera\nprint("Quat =", original_camera.rotation_quaternion)\n\n# Check if the collection "SkyboxCameras" exists, if not, create it\ncollection_name = "SkyboxCameras"\nif collection_name not in bpy.data.collections:\n    skybox_collection = bpy.data.collections.new(collection_name)\n    bpy.context.scene.collection.children.link(skybox_collection)\nelse:\n    skybox_collection = bpy.data.collections[collection_name]\n    \nA = 0.7071067811865476\nH = 0.5\nfaces = [\n  [(-H, H, H, -H), "posX"],\n  [(0, -1, 0, 0), "posY"],\n  [(-A, A, 0, 0), "posZ"],\n  [(-H, H, -H, H), "negX"],\n  [(-1, 0, 0, 0), "negY"],\n  [(0, 0, -A, A), "negZ"]\n]\nbpy.context.window_manager.progress_begin(0, len(faces))\nstep = 0\nfor (face, name) in faces:\n    step = step + 1\n    camera_name = f"Camera.{name}"\n    print("Camera name:", camera_name)\n    # Create a new camera for this face\n    if camera_name in bpy.data.objects:\n        camera_object = bpy.data.objects[camera_name]\n    else:\n        # Create a new camera object\n        camera_data = bpy.data.cameras.new(name=camera_name)\n        camera_object = bpy.data.objects.new(camera_name, camera_data)\n        skybox_collection.objects.link(camera_object)\n    # Update the progress bar\n    bpy.context.window_manager.progress_update(step)\n    sensor_width = camera_object.data.sensor_width\n    focal_length = (0.5 * sensor_width) / math.tan(0.25 * math.pi)    \n    camera_object.data.lens = focal_length\n    camera_object.location = (0, 0, 0)\n    camera_object.rotation_mode = \'QUATERNION\'\n    quaternion = mathutils.Quaternion(face)\n    camera_object.rotation_quaternion = quaternion\n    bpy.data.cameras[camera_name].angle = math.pi / 2\n    # Set the camera as the active camera\n    bpy.context.scene.camera = camera_object\n    # Render the scene\n    bpy.context.scene.render.image_settings.file_format = \'WEBP\'\n    bpy.context.scene.render.filepath = f\'//{name}.webp\'\n    bpy.ops.render.render(write_still=True)\n    \nprint("End.")\nbpy.context.window_manager.progress_end()\n\n# Restore the original active camera\nbpy.context.scene.camera = original_camera\n'})})]}),"\n",(0,a.jsx)(n.p,{children:"It will ceate the six needed images in the same folder as your Blender file."}),"\n",(0,a.jsx)("img",{src:E}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Warning!"})," by default, TGD uses the convention where +Y is pointing up, +X pointing right and +Z toward the camera,\nbut for Blender we have +Z pointing up, +X pointing right and -Y toward the camera."]})]})}function O(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(S,{...e})}):S(e)}},5913:(e,n,t)=>{t.d(n,{A:()=>c});var a=t(1601),s=t.n(a),o=t(6314),i=t.n(o)()(s());i.push([e.id,".JaFQCm00ywbzHqhPiROf {\n    position: relative;\n}\n\n.JaFQCm00ywbzHqhPiROf .lN_73TsBtPzrXOpBA3BL {\n    width: 100%;\n    padding: 4px;\n    display: flex;\n    flex-wrap: nowrap;\n    flex-direction: row;\n    justify-content: space-around;\n    align-items: center;\n    gap: 16px;\n}\n",""]),i.locals={skybox:"JaFQCm00ywbzHqhPiROf",footer:"lN_73TsBtPzrXOpBA3BL"};const c=i},3469:(e,n,t)=>{t.d(n,{A:()=>c});var a=t(1601),s=t.n(a),o=t(6314),i=t.n(o)()(s());i.push([e.id,".hgIjhDQIuBCJEQ4ZgLXp {\n    display: inline-block;\n    margin: 1em;\n}\n\n.hgIjhDQIuBCJEQ4ZgLXp canvas {\n    box-shadow: 0 0.25em 0.5em #fff1;\n    max-width: 100vw;\n    max-height: 100vh;\n}\n\n.efOyHCihw9wfMB6AaAqw {\n    position: relative;\n}\n\n.ywC8N0Uxbvm2Ug2DwPkE {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    background-color: var(--theme-color-primary-1);\n    opacity: 0;\n    transition: opacity 0.3s;\n}\n\n.ywC8N0Uxbvm2Ug2DwPkE.PBWSRsbiwEqGpeL0hEfm {\n    opacity: 1;\n}\n\n.BErChOLWGtciKhh3IFud {\n    position: relative;    \n}\n\n.BErChOLWGtciKhh3IFud > canvas.fT7FcYouYlPbElIAEXRP {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n}\n\n.BErChOLWGtciKhh3IFud > canvas.uAPfWt_Dhe7RaRrnmIu0 {\n    position: absolute;\n    right: 0;\n    top: 0;\n    width: 128px;\n    height: 128px;\n    box-shadow: none;\n    border: none;\n}",""]),i.locals={Tgd:"hgIjhDQIuBCJEQ4ZgLXp",relative:"efOyHCihw9wfMB6AaAqw",overlay:"ywC8N0Uxbvm2Ug2DwPkE",loading:"PBWSRsbiwEqGpeL0hEfm",screen:"BErChOLWGtciKhh3IFud",canvas:"fT7FcYouYlPbElIAEXRP",gizmo:"uAPfWt_Dhe7RaRrnmIu0"};const c=i},6989:(e,n,t)=>{t.d(n,{A:()=>P});var a=t(4848),s=t(6540),o=t(4461),i=t(5968),c=t(5670),r=t(5072),l=t.n(r),m=t(7825),g=t.n(m),d=t(7659),u=t.n(d),h=t(5056),p=t.n(h),x=t(540),f=t.n(x),b=t(1113),w=t.n(b),y=t(3469),C={};C.styleTagTransform=w(),C.setAttributes=p(),C.insert=u().bind(null,"head"),C.domAPI=g(),C.insertStyleElement=f(),l()(y.A,C);const j=y.A&&y.A.locals?y.A.locals:void 0;function P({className:e,options:n,onReady:t,gizmo:r=!1,width:l="640px",height:m="480px",noBorder:g=!1,assets:d,children:u}){const[h,p]=s.useState(!0),[x,f]=s.useState(!1),b=s.useRef(null),w=s.useRef(null),y=s.useRef(null),C=s.useRef(null),[P,v]=s.useState(!0);let N="auto";l.endsWith("px")&&m.endsWith("px")&&(l.substring(l.length-2),m.substring(m.length-2));const T=e=>{if(!e)return;if(w.current)return;w.current=e;const a=new o.tfp(e,n);b.current=a,v(!0),async function({glb:e,data:n,text:t,image:a}={}){console.log("🚀 [Tgd] glb, data, text, image = ",e,n,t,a);const s={glb:{},data:{},text:{},image:{}},i=[];return a&&Object.keys(a).forEach((e=>{i.push((async()=>{const n=a[e];console.log("Loading image:",n);const t=await(0,o.V_9)(n);t&&(s.image[e]=t)}))})),e&&Object.keys(e).forEach((n=>{i.push((async()=>{const t=e[n];console.log("Loading GLB:",t);const a=await(0,o.TCe)(t);a&&(s.glb[n]=a)}))})),n&&Object.keys(n).forEach((e=>{i.push((async()=>{const t=n[e],a=await(0,o.vSU)(t);a&&(s.data[e]=a)}))})),t&&Object.keys(t).forEach((e=>{i.push((async()=>{const n=t[e],a=await(0,o.jWq)(n);a&&(s.text[e]=a)}))})),await Promise.all(i.map((e=>e()))),s}(d).then((e=>{console.log("Ready!"),t(a,e),a.paint(),v(!1)})).catch((e=>{console.error("Unable to initialize the scene!",e),v(!1)}));const s=y.current;s&&s.attachContext(a)},k=e=>{const n=new o.GbF({canvas:e});y.current=n,n.eventTipClick.addListener((({to:e})=>{const n=b.current;console.log("🚀 [tgd] to, context =",e,n),n&&n.animSchedule({duration:.2,easingFunction:o.Wcc,action:(0,o.vRM)(n.camera,{orientation:e})})}));const t=b.current;t&&n.attachContext(t)};return s.useEffect((()=>{const e=w.current,n=b.current;if(!e||!n)return;const t=new ResizeObserver((()=>n.paint()));return t.observe(e),e.requestFullscreen||(e.requestFullscreen=e.webkitRequestFullscreen),f(Boolean(e.requestFullscreen)),()=>t.unobserve(e)}),[b.current,w.current]),g?(0,a.jsxs)("div",{ref:C,className:j.screen,style:{width:h?l:m,height:h?m:l},children:[(0,a.jsx)("canvas",{className:j.canvas,ref:T}),r&&(0,a.jsx)("canvas",{className:j.gizmo,ref:k})]}):(0,a.jsxs)("div",{className:i.Sxu.classNames.join(e,j.Tgd),children:[(0,a.jsxs)(i.sWC,{display:"flex",justifyContent:"space-between",children:[(0,a.jsx)(i.yQN,{variant:"elevated",onClick:()=>p(!h),enabled:!P,children:h?"Switch to Portrait":"Switch to Landscape"}),x&&(0,a.jsx)(i.yQN,{variant:"elevated",onClick:()=>{const e=C.current;e&&e.requestFullscreen()},enabled:!P,children:"Fullscreen"})]}),(0,a.jsxs)("div",{className:j.relative,children:[(0,a.jsxs)("div",{ref:C,className:j.screen,style:{width:h?l:m,height:h?m:l},children:[(0,a.jsx)("canvas",{className:j.canvas,ref:T}),r&&(0,a.jsx)("canvas",{className:j.gizmo,ref:k})]}),(0,a.jsx)("div",{className:i.Sxu.classNames.join(j.overlay,P&&j.loading),children:(0,a.jsx)(c.A,{})}),u]})]})}},8453:(e,n,t)=>{t.d(n,{R:()=>o});var a=t(6540);const s=a.createContext({});function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}}}]);