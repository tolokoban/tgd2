"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[768],{8768:(t,i,e)=>{e.d(i,{ED:()=>Q,ML:()=>st,OE:()=>q,Wk:()=>it,_G:()=>K,aW:()=>nt,cL:()=>et,ck:()=>tt,mI:()=>rt,op:()=>H,sT:()=>J,yo:()=>ht});var s={d:(t,i)=>{for(var e in i)s.o(i,e)&&!s.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)},r={};function n(t,i=6){const e=Math.pow(10,i),s=[];let r=0;for(const n of t){const t=(Math.round(n*e)/e).toFixed(i);r=Math.max(r,t.length),s.push(t)}return s.map((t=>t.padStart(r," ")))}s.d(r,{OE:()=>S,sx:()=>R,fS:()=>X,Ev:()=>g,ch:()=>f,op:()=>x,_G:()=>D,ED:()=>Z,sT:()=>F,wB:()=>o,gR:()=>k,ck:()=>C,Wk:()=>B,Yv:()=>p,cL:()=>O,ML:()=>W,mI:()=>G,aW:()=>c,W0:()=>y,CV:()=>A,yo:()=>h,qM:()=>a,y0:()=>Y});class h extends Float32Array{constructor(t=0,i=0,e=0){if(super(3),"number"!=typeof t)return this.x=t.x,this.y=t.y,void(this.z=t.z);this.x=t,this.y=i,this.z=e}clone(){return new h(this)}isEqual({x:t,y:i,z:e}){return t===this.x&&i===this.y&&e===this.z}isClose({x:t,y:i,z:e},s=1e-6){return!(Math.abs(t-this.x)>s||Math.abs(i-this.y)>s||Math.abs(e-this.z)>s)}rotateAround(t,i){const e=Math.cos(i),s=Math.sin(i),[r,n,h]=this,[o,a,c]=t,u=a*h-c*n,m=c*r-o*h,l=o*n-a*r,d=(r*o+n*a+h*c)*(1-e);return this.x=r*e+u*s+o*d,this.y=n*e+m*s+a*d,this.z=h*e+l*s+c*d,this}applyMatrix(t){const{x:i,y:e,z:s}=this;return this.x=i*t.m00+e*t.m10+s*t.m20,this.y=i*t.m01+e*t.m11+s*t.m21,this.z=i*t.m02+e*t.m12+s*t.m22,this}from({x:t,y:i,z:e}){return this.x=t,this.y=i,this.z=e,this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}add(...t){for(const i of t)this[0]+=i[0],this[1]+=i[1],this[2]+=i[2];return this}addWithScale({x:t,y:i,z:e},s=1){return this[0]+=t*s,this[1]+=i*s,this[2]+=e*s,this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}get size(){return Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2])}normalize(){const t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2];return 0===t?this:this.scale(1/Math.sqrt(t))}debug(t="vec3"){const{x:i,y:e,z:s}=this,r=[i,e,s].map((t=>t.toFixed(6)));console.log(`${t}:   `,r.join(" | "),"   length:",Math.sqrt(i*i+e*e+s*s))}}class o extends Float32Array{constructor(t=1,i=0,e=0,s=0,r=0,n=1,h=0,o=0,a=0,c=0,u=1,m=0,l=0,d=0,g=0,f=1){super("number"==typeof t?[t,i,e,s,r,n,h,o,a,c,u,m,l,d,g,f]:t)}multiply(t){const[i,e,s,r,n,h,o,a,c,u,m,l,d,g,f,x]=this,[p,y,v,w,b,E,_,A,T,P,U,M,I,z,R,X]=t;return this.m00=i*p+n*y+c*v+d*w,this.m10=i*b+n*E+c*_+d*A,this.m20=i*T+n*P+c*U+d*M,this.m30=i*I+n*z+c*R+d*X,this.m01=e*p+h*y+u*v+g*w,this.m11=e*b+h*E+u*_+g*A,this.m21=e*T+h*P+u*U+g*M,this.m31=e*I+h*z+u*R+g*X,this.m02=s*p+o*y+m*v+f*w,this.m12=s*b+o*E+m*_+f*A,this.m22=s*T+o*P+m*U+f*M,this.m32=s*I+o*z+m*R+f*X,this.m03=r*p+a*y+l*v+x*w,this.m13=r*b+a*E+l*_+x*A,this.m23=r*T+a*P+l*U+x*M,this.m33=r*I+a*z+l*R+x*X,this}invert(){const[t,i,e,s,r,n,h,o,a,c,u,m,l,d,g,f]=this,x=t*n-i*r,p=t*h-e*r,y=t*o-s*r,v=i*h-e*n,w=i*o-s*n,b=e*o-s*h,E=a*d-c*l,_=a*g-u*l,A=a*f-m*l,T=c*g-u*d,P=c*f-m*d,U=u*f-m*g,M=x*U-p*P+y*T+v*A-w*_+b*E;if(!M)return this;const I=1/M;return this[0]=(n*U-h*P+o*T)*I,this[1]=(e*P-i*U-s*T)*I,this[2]=(d*b-g*w+f*v)*I,this[3]=(u*w-c*b-m*v)*I,this[4]=(h*A-r*U-o*_)*I,this[5]=(t*U-e*A+s*_)*I,this[6]=(g*y-l*b-f*p)*I,this[7]=(a*b-u*y+m*p)*I,this[8]=(r*P-n*A+o*E)*I,this[9]=(i*A-t*P-s*E)*I,this[10]=(l*w-d*y+f*x)*I,this[11]=(c*y-a*w-m*x)*I,this[12]=(n*_-r*T-h*E)*I,this[13]=(t*T-i*_+e*E)*I,this[14]=(d*p-l*v-g*x)*I,this[15]=(a*v-c*p+u*x)*I,this}get translation(){const{m30:t,m31:i,m32:e}=this;return new h(t,i,e)}set translation(t){this.m30=t.x,this.m31=t.y,this.m32=t.z}from(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this.m23=t.m23,this.m30=t.m30,this.m31=t.m31,this.m32=t.m32,this.m33=t.m33,this}fromMat3(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this}toAxis(t,i,e){return this.toAxisX(t),this.toAxisY(i),this.toAxisZ(e)}toAxisX(t){return t.x=this.m00,t.y=this.m01,t.z=this.m02,this}toAxisY(t){return t.x=this.m10,t.y=this.m11,t.z=this.m12,this}toAxisZ(t){return t.x=this.m20,t.y=this.m21,t.z=this.m22,this}fromQuat({x:t,y:i,z:e,w:s}){const r=t+t,n=i+i,h=e+e,o=t*r,a=i*r,c=i*n,u=e*r,m=e*n,l=e*h,d=s*r,g=s*n,f=s*h;return this.m00=1-c-l,this.m10=a-f,this.m20=u+g,this.m01=a+f,this.m11=1-o-l,this.m21=m-d,this.m02=u-g,this.m12=m+d,this.m22=1-o-c,this}get m00(){return this[0]}set m00(t){this[0]=t}get m01(){return this[1]}set m01(t){this[1]=t}get m02(){return this[2]}set m02(t){this[2]=t}get m03(){return this[3]}set m03(t){this[3]=t}get m10(){return this[4]}set m10(t){this[4]=t}get m11(){return this[5]}set m11(t){this[5]=t}get m12(){return this[6]}set m12(t){this[6]=t}get m13(){return this[7]}set m13(t){this[7]=t}get m20(){return this[8]}set m20(t){this[8]=t}get m21(){return this[9]}set m21(t){this[9]=t}get m22(){return this[10]}set m22(t){this[10]=t}get m23(){return this[11]}set m23(t){this[11]=t}get m30(){return this[12]}set m30(t){this[12]=t}get m31(){return this[13]}set m31(t){this[13]=t}get m32(){return this[14]}set m32(t){this[14]=t}get m33(){return this[15]}set m33(t){this[15]=t}debug(t="Mat4"){const i=n([this.m00,this.m01,this.m02,this.m03]),e=n([this.m10,this.m11,this.m12,this.m13]),s=n([this.m20,this.m21,this.m22,this.m23]),r=n([this.m30,this.m31,this.m32,this.m33]);console.log(t),console.log("   ",[i[0],e[0],s[0],r[0]].join(" | ")),console.log("   ",[i[1],e[1],s[1],r[1]].join(" | ")),console.log("   ",[i[2],e[2],s[2],r[2]].join(" | ")),console.log("   ",[i[3],e[3],s[3],r[3]].join(" | "))}}class a extends Float32Array{constructor(t=0,i=0,e=0,s=1){return super(4),t instanceof a?(this.x=t.x,this.y=t.y,this.z=t.z,void(this.w=t.w)):t instanceof h?(this.x=t.x,this.y=t.y,this.z=t.z,void(this.w=s)):(this.x=t,this.y=i,this.z=e,void(this.w=s))}reset(t=0,i=0,e=0,s=1){return this.x=t,this.y=i,this.z=e,this.w=s,this}from(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new a(this)}isEqual({x:t,y:i,z:e,w:s}){return t===this.x&&i===this.y&&e===this.z&&s===this.w}isClose({x:t,y:i,z:e,w:s},r=1e-6){return!(Math.abs(t-this.x)>r||Math.abs(i-this.y)>r||Math.abs(e-this.z)>r||Math.abs(s-this.w)>r)}applyMatrix(t){const{x:i,y:e,z:s,w:r}=this;return this.x=i*t.m00+e*t.m10+s*t.m20+r*t.m30,this.y=i*t.m01+e*t.m11+s*t.m21+r*t.m31,this.z=i*t.m02+e*t.m12+s*t.m22+r*t.m32,this.w=i*t.m03+e*t.m13+s*t.m23+r*t.m33,this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}add(...t){for(const i of t)this[0]+=i[0],this[1]+=i[1],this[2]+=i[2],this[3]+=i[3];return this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this[3]-=t[3],this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}get size(){return Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]+this[3]*this[3])}normalize(){const t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2]+this[3]*this[3];return 0===t?this:this.scale(1/Math.sqrt(t))}debug(t="vec4"){const{x:i,y:e,z:s,w:r}=this,n=[i,e,s,r].map((t=>t.toFixed(6)));console.log(`${t}:   `,n.join(" | "))}}class c extends a{constructor(t=0,i=0,e=0,s=1){"number"==typeof t?super(t,i,e,s):super(t)}clone(){return new c(this)}multiply(t){const[i,e,s,r]=this,[n,h,o,a]=t;return this[0]=a*i+n*r-h*s+o*e,this[1]=a*e+n*s+h*r-o*i,this[2]=a*s-n*e+h*i+o*r,this[3]=a*r-n*i-h*e-o*s,this}fromAxis(t,i,e){const s=t.x+i.y+e.z;if(s>0){const r=Math.sqrt(s+1);this.w=.5*r;const n=.5/r;this.x=(i.z-e.y)*n,this.y=(e.x-t.z)*n,this.z=(t.y-i.x)*n}else{const s=[t,i,e];let r=0;i.y>t.x&&(r=1),e.z>s[r][r]&&(r=2);const n=(r+1)%3,h=(r+2)%3;let o=Math.sqrt(s[r][r]-s[n][n]-s[h][h]+1);this[r]=.5*o,o=.5/o,this[3]=(s[n][h]-s[h][n])*o,this[n]=(s[n][r]+s[r][n])*o,this[h]=(s[h][r]+s[r][h])*o}return this.normalize()}rotateAroundX(t){const i=.5*t,e=this[0],s=this[1],r=this[2],n=this[3],h=Math.sin(i),o=Math.cos(i);return this[0]=e*o+n*h,this[1]=s*o+r*h,this[2]=r*o-s*h,this[3]=n*o-e*h,this}rotateAroundY(t){const i=.5*t,e=this[0],s=this[1],r=this[2],n=this[3],h=Math.sin(i),o=Math.cos(i);return this[0]=e*o-r*h,this[1]=s*o+n*h,this[2]=r*o+e*h,this[3]=n*o-s*h,this}rotateAroundZ(t){const i=.5*t,e=this[0],s=this[1],r=this[2],n=this[3],h=Math.sin(i),o=Math.cos(i);return this[0]=e*o+s*h,this[1]=s*o-e*h,this[2]=r*o+n*h,this[3]=n*o-r*h,this}toAxisZ(t){const{x:i,y:e,z:s,w:r}=this,n=i+i,h=e+e,o=i*n,a=e*h,c=s*n,u=s*h,m=r*n,l=r*h;return t.x=c+l,t.y=u-m,t.z=1-o-a,t}face(t="+X+Y+Z"){const[i,e,s,r]=l[t];return this.x=i,this.y=e,this.z=s,this.w=r,this}}const u=Math.sqrt(2)/2,m=.5,l={"+X+Y+Z":[0,0,0,1],"-Z+Y+X":[0,+u,0,+u],"-X+Y-Z":[0,1,0,0],"+Z+Y-X":[0,-u,0,+u],"+X+Z-Y":[+u,0,0,+u],"+Y+Z+X":[+m,+m,+m,+m],"-X+Z+Y":[0,+u,+u,0],"-Y+Z-X":[+m,-m,-m,+m],"+X-Y-Z":[1,0,0,0],"+X-Z+Y":[-u,0,0,+u],"-X-Y+Z":[0,0,1,0],"-X-Z-Y":[0,+u,-u,0],"+Y+X-Z":[+u,+u,0,0],"+Y-X+Z":[0,0,+u,+u],"+Y-Z-X":[+m,+m,-m,-m],"-Y+X+Z":[0,0,-u,+u],"-Y-X-Z":[+u,-u,0,0],"-Y-Z+X":[+m,-m,+m,-m],"+Z+X+Y":[+m,+m,+m,-m],"+Z-X-Y":[+m,-m,+m,+m],"+Z-Y+X":[+u,0,+u,0],"-Z+X-Y":[+m,+m,-m,+m],"-Z-X+Y":[+m,-m,-m,-m],"-Z-Y-X":[+u,0,-u,0]};class d extends Float32Array{constructor(t=1,i=0,e=0,s=0,r=1,n=0,h=0,o=0,a=1){super("number"==typeof t?[t,i,e,s,r,n,h,o,a]:t)}transpose(){let t=this.m10;return this.m10=this.m01,this.m01=t,t=this.m20,this.m20=this.m02,this.m02=t,t=this.m21,this.m21=this.m12,this.m12=t,this}fromQuat({x:t,y:i,z:e,w:s}){const r=t+t,n=i+i,h=e+e,o=t*r,a=i*r,c=i*n,u=e*r,m=e*n,l=e*h,d=s*r,g=s*n,f=s*h;return this.m00=1-c-l,this.m10=a-f,this.m20=u+g,this.m01=a+f,this.m11=1-o-l,this.m21=m-d,this.m02=u-g,this.m12=m+d,this.m22=1-o-c,this}toAxis(t,i,e){return this.toAxisX(t),this.toAxisY(i),this.toAxisZ(e)}toAxisX(t){return t.x=this.m00,t.y=this.m01,t.z=this.m02,this}toAxisY(t){return t.x=this.m10,t.y=this.m11,t.z=this.m12,this}toAxisZ(t){return t.x=this.m20,t.y=this.m21,t.z=this.m22,this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this[4]*=t,this[5]*=t,this[6]*=t,this[7]*=t,this[8]*=t,this}get m00(){return this[0]}set m00(t){this[0]=t}get m01(){return this[1]}set m01(t){this[1]=t}get m02(){return this[2]}set m02(t){this[2]=t}get m10(){return this[3]}set m10(t){this[3]=t}get m11(){return this[4]}set m11(t){this[4]=t}get m12(){return this[5]}set m12(t){this[5]=t}get m20(){return this[6]}set m20(t){this[6]=t}get m21(){return this[7]}set m21(t){this[7]=t}get m22(){return this[8]}set m22(t){this[8]=t}debug(t="Mat3"){const i=n([this.m00,this.m01,this.m02]),e=n([this.m10,this.m11,this.m12]),s=n([this.m20,this.m21,this.m22]);console.log(t),console.log("   ",[i[0],e[0],s[0]].join(" | ")),console.log("   ",[i[1],e[1],s[1]].join(" | ")),console.log("   ",[i[2],e[2],s[2]].join(" | "))}}class g{constructor(){this.dirty=!0,this.dirtyAxis=!0,this.axisX=new h,this.axisY=new h,this.axisZ=new h,this._matrixViewModel=new o,this.orientation=new c(0,0,0,1),this.target=new h(0,0,0),this._distance=10,this._zoom=1,this.tmpMat3=new d,this.tmpVec3=new h,this.orientation.face("+X+Y+Z"),this.orbitAroundY(Math.PI),this.updateAxisIfNeeded(),console.log("****************************************"),this.axisX.debug("X"),this.axisY.debug("Y"),this.axisZ.debug("Z"),this.matrixViewModel.debug(),this.orientation.debug("Quat");const t=(t,i)=>Math.abs(t-i)<1e-5,i=({x:i,y:e,z:s})=>t(i,1)?"+X":t(i,-1)?"-X":t(e,1)?"+Y":t(e,-1)?"-Y":t(s,1)?"+Z":t(s,-1)?"-Z":"??",e=[new h(1,0,0),new h(-1,0,0),new h(0,1,0),new h(0,-1,0),new h(0,0,1),new h(0,0,-1)],s=Math.sqrt(2)/2,r=({x:i,y:e,z:r,w:n})=>[i,e,r,n].map((i=>t(i,0)?"+0":t(i,1)?"+1":t(i,-1)?"-1":t(i,+s)?"+A":t(i,-s)?"-A":t(i,.5)?"+H":t(i,-.5)?"-H":i)).join(", "),n=([t,i,e],[s,r,n])=>{const h=t*s+i*r+e*n;return Math.abs(h)>.5},a=([t,i,e],[s,r,n],[h,o,a])=>{const c=i*n-r*e+h,u=s*e-t*n+o,m=t*r-s*i+a;return Math.abs(c*c+u*u+m*m)>.01},u=[];for(const t of e)for(const s of e)if(!n(t,s))for(const h of e)n(t,h)||n(s,h)||a(t,s,h)&&(this.orientation.fromAxis(t,s,h),this.updateAxis(),u.push(`\n"${i(t)}${i(s)}${i(h)}": [${r(this.orientation)}],`));console.log(u.join("")),this.orientation.face()}face(t){this.orientation.face(t),this.dirty=!0,this.dirtyAxis=!0}from({orientation:t,target:i,distance:e,zoom:s}){return this.orientation.from(t),this.target.from(i),this.distance=e,this.zoom=s,this.dirty=!0,this.dirtyAxis=!0,this}toAxisX(t){return this.updateAxisIfNeeded(),t.from(this.axisX),this}toAxisY(t){return this.updateAxisIfNeeded(),t.from(this.axisY),this}toAxisZ(t){return this.updateAxisIfNeeded(),t.from(this.axisZ),this}get matrixViewModel(){return this.updateIfNeeded(),this._matrixViewModel}setOrientation(t){const{orientation:i}=this;if(t.isEqual(i))return;const[e,s,r,n]=t;i.x=e,i.y=s,i.z=r,i.w=n,this.dirty=!0,this.dirtyAxis=!0}setTarget(t){const{target:i}=this;if(t.isEqual(i))return;const[e,s,r]=t;i.x=e,i.y=s,i.z=r,this.dirty=!0}get x(){return this.target.x}set x(t){const{target:i}=this;t!==i.x&&(this.x=t,this.dirty=!0)}get y(){return this.target.y}set y(t){const{target:i}=this;t!==i.y&&(this.y=t,this.dirty=!0)}get z(){return this.target.z}set z(t){const{target:i}=this;t!==i.z&&(this.z=t,this.dirty=!0)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t,this.dirty=!0)}get zoom(){return this._zoom}set zoom(t){this._zoom!==t&&(this._zoom=t,this.dirty=!0)}moveTarget(t,i,e){const{target:s}=this;this.updateAxisIfNeeded();const{axisX:r,axisY:n,axisZ:h,tmpVec3:o}=this;o.from(r).scale(t).addWithScale(n,i).addWithScale(h,e),s.x+=o.x,s.y+=o.y,s.z+=o.z,this.dirty=!0}orbitAroundX(t){this.updateAxisIfNeeded();const{axisX:i,axisY:e,axisZ:s,orientation:r}=this;return e.rotateAround(i,t),s.rotateAround(i,t),r.fromAxis(i,e,s),this.dirty=!0,this}orbitAroundY(t){this.updateAxisIfNeeded();const{axisX:i,axisY:e,axisZ:s,orientation:r}=this;return i.rotateAround(e,t),s.rotateAround(e,t),r.fromAxis(i,e,s),this.dirty=!0,this}orbitAroundZ(t){this.updateAxisIfNeeded();const{axisX:i,axisY:e,axisZ:s,orientation:r}=this;return i.rotateAround(s,t),e.rotateAround(s,t),r.fromAxis(i,e,s),this.dirty=!0,this}debug(t="Camera"){this.orientation.debug(`${t} quaternion:`)}updateAxisIfNeeded(){this.dirtyAxis&&this.updateAxis()}updateAxis(){const{tmpMat3:t}=this;if(t.fromQuat(this.orientation),t.toAxis(this.axisX,this.axisY,this.axisZ),this.dirtyAxis=!1,Math.abs(1-this.axisX.size)>.1||Math.abs(1-this.axisY.size)>.1||Math.abs(1-this.axisZ.size)>.1)throw this.axisX.debug("Axis X"),this.axisY.debug("Axis Y"),this.axisZ.debug("Axis Z"),Error("STOP!")}updateIfNeeded(){if(!this.dirty)return;const{tmpMat3:t,tmpVec3:i}=this,e=this._matrixViewModel;this.updateAxis();const s=this._distance,{x:r,y:n,z:h}=this.target,{x:o,y:a,z:c}=this.axisZ;i.x=r+s*o,i.y=n+s*a,i.z=h+s*c,i.applyMatrix(t.transpose()).scale(-1),e.m30=i.x,e.m31=i.y,e.m32=i.z;const u=this._zoom;1!==u&&t.scale(u),e.fromMat3(t),this.dirty=!1}}class f extends g{constructor(){super(),this.dirtyProjection=!0,this._matrixProjection=new o,this._width=1920,this._height=1080,this._spaceHeight=10,this._near=.001,this._far=1e3}get spaceHeight(){return this._spaceHeight}set spaceHeight(t){t!==this._spaceHeight&&(this._spaceHeight=t,this.dirtyProjection=!0)}get screenWidth(){return this._width}set screenWidth(t){t!==this._width&&(this._width=t,this.dirtyProjection=!0)}get screenHeight(){return this._height}set screenHeight(t){t!==this._height&&(this._height=t,this.dirtyProjection=!0)}get near(){return this._near}set near(t){t!==this._near&&(this._near=t,this.dirtyProjection=!0)}get far(){return this._far}set far(t){t!==this._far&&(this._far=t,this.dirtyProjection=!0)}get matrixProjection(){return this.updateProjectionIfNeeded(),this._matrixProjection}updateProjectionIfNeeded(){if(!this.dirtyProjection)return;const{near:t,far:i,_width:e,_height:s,_spaceHeight:r}=this,n=.5*r,h=-n,o=n*e/s,a=-o,c=this._matrixProjection,u=1/(a-o),m=1/(h-n),l=1/(t-i);c[0]=-2*u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*m,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=l,c[11]=0,c[12]=(a+o)*u,c[13]=(n+h)*m,c[14]=t*l,c[15]=1,this.dirtyProjection=!0}}class x extends g{constructor(){super(),this.dirtyProjection=!0,this._matrixProjection=new o,this._width=1920,this._height=1080,this._fovy=Math.PI/4,this._near=.001,this._far=1/0}get screenWidth(){return this._width}set screenWidth(t){t!==this._width&&(this._width=t,this.dirtyProjection=!0)}get screenHeight(){return this._height}set screenHeight(t){t!==this._height&&(this._height=t,this.dirtyProjection=!0)}get fovy(){return this._fovy}set fovy(t){t!==this._fovy&&(this._fovy=t,this.dirtyProjection=!0)}get near(){return this._near}set near(t){t!==this._near&&(this._near=t,this.dirtyProjection=!0)}get far(){return this._far}set far(t){t!==this._far&&(this._far=t,this.dirtyProjection=!0)}get matrixProjection(){return this.updateProjectionIfNeeded(),this._matrixProjection}updateProjectionIfNeeded(){if(!this.dirtyProjection)return;const t=this._fovy,i=this._width/this._height,e=this._near,s=this._far,r=this._matrixProjection,n=1/Math.tan(t/2);if(r[0]=n/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,s!==1/0){const t=1/(e-s);r[10]=(s+e)*t,r[14]=2*s*e*t}else r[10]=-1,r[14]=-2*e;this.dirtyProjection=!0}}class p{constructor(t=[]){this.enabled=!0,this.painters=[...t]}add(...t){for(const i of t)this.painters.push(i)}remove(...t){for(const i of t){const t=this.painters.indexOf(i);t<0||(this.painters.splice(t,1),i.delete())}}delete(){for(const t of this.painters)t.delete();this.painters.splice(0,this.painters.length)}paint(t,i){if(this.enabled)for(const e of this.painters)e.paint(t,i)}update(t,i){if(this.enabled)for(const e of this.painters)e.update(t,i)}}class y{constructor(){this.keys=new Map,this.objects=new Map,this.references=new Map}create(t){var i;const e=this.makeKeyFromInput(t),s=null!==(i=this.references.get(e))&&void 0!==i?i:0;if(s<1){const i=this.actualCreate(t);return this.keys.set(i,e),this.objects.set(e,i),this.references.set(e,1),i}const r=this.objects.get(e);if(!r)throw Error("[TgdResource.create] Panic!");return this.references.set(e,s+1),r}delete(t){var i;const e=this.keys.get(t);if(!e)return;const s=null!==(i=this.references.get(e))&&void 0!==i?i:0;s<1||(s>1?this.references.set(e,s-1):(this.keys.delete(t),this.objects.delete(e),this.references.delete(e),this.actualDelete(t)))}}class v{constructor(t,i){var e;this.gl=t;const s=t.createProgram();if(!s)throw Error("Unable to create WebGLProgram!");const r=this.createShader("VERTEX_SHADER",i.vert);t.attachShader(s,r);const n=this.createShader("FRAGMENT_SHADER",i.frag);if(t.attachShader(s,n),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)){var h=null!==(e=t.getProgramInfoLog(s))&&void 0!==e?e:"";console.warn(h);const r=b(h);throw _("Vertex Shader",i.vert,...r),_("Fragment Shader",i.frag,...r),new Error("Could NOT link WebGL2 program!\n"+h)}this.program=s,this.shaders=[r,n],this.uniformsLocations=this.getUniformsLocations()}getAttribLocation(t){const{gl:i,program:e}=this,s=i.getAttribLocation(e,t);if(s<0)throw Error(`Attribute "${t}" not found!`);return s}getUniformLocation(t){const{uniformsLocations:i}=this,e=Object.keys(i);if(0===t.length)throw Error(`Uniform "${t}" has not been found: there is no active uniform in this program!`);const s=i[t];if(!s)throw Error(`No active uniform found with name "${t}"!\nAvailable names are: ${e.join(", ")}.`);return s}uniform1f(t,i){const{gl:e}=this;e.uniform1f(this.getUniformLocation(t),i)}uniform2f(t,i,e){const{gl:s}=this;s.uniform2f(this.getUniformLocation(t),i,e)}uniform3f(t,i,e,s){const{gl:r}=this;r.uniform3f(this.getUniformLocation(t),i,e,s)}uniform3fv(t,i){const{gl:e}=this;e.uniform3fv(this.getUniformLocation(t),i)}uniform4f(t,i,e,s,r){const{gl:n}=this;n.uniform4f(this.getUniformLocation(t),i,e,s,r)}uniform4fv(t,i){const{gl:e}=this;e.uniform4fv(this.getUniformLocation(t),i)}uniform1i(t,i){const{gl:e}=this;e.uniform1i(this.getUniformLocation(t),i)}uniform2i(t,i,e){const{gl:s}=this;s.uniform2i(this.getUniformLocation(t),i,e)}uniform3i(t,i,e,s){const{gl:r}=this;r.uniform3i(this.getUniformLocation(t),i,e,s)}uniform4i(t,i,e,s,r){const{gl:n}=this;n.uniform4i(this.getUniformLocation(t),i,e,s,r)}uniform1ui(t,i){const{gl:e}=this;e.uniform1ui(this.getUniformLocation(t),i)}uniform2ui(t,i,e){const{gl:s}=this;s.uniform2ui(this.getUniformLocation(t),i,e)}uniform3ui(t,i,e,s){const{gl:r}=this;r.uniform3ui(this.getUniformLocation(t),i,e,s)}uniform4ui(t,i,e,s,r){const{gl:n}=this;n.uniform4ui(this.getUniformLocation(t),i,e,s,r)}uniformMatrix4fv(t,i){const{gl:e}=this;e.uniformMatrix4fv(this.getUniformLocation(t),!1,i)}use(){const{gl:t,program:i}=this;t.useProgram(i)}delete(){const{gl:t}=this;this.shaders.forEach((i=>t.deleteShader(i))),t.deleteProgram(this.program)}createShader(t,i){const{gl:e}=this,s=e.createShader(e[t]);if(!s)throw Error(`Unable to create a WebGLShader of type "${t}"!`);e.shaderSource(s,i),e.compileShader(s);const r=e.getShaderInfoLog(s);if(r)throw console.error(`Error in ${t} code:`,r),_(t,i,...b(r)),Error(`Unable to compile ${t}!`);return s}getUniformsLocations(){const{gl:t,program:i}=this,e=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);if("number"!=typeof e)throw Error("Unable to get the number of uniforms in a WebGLProgram!");const s={};for(let r=0;r<e;r++){const e=t.getActiveUniform(i,r);if(!e)continue;const n=t.getUniformLocation(i,e.name);if(null===n)throw Error(`Unable to get location for uniform "${e.name}"!`);s[e.name]=n}return s}}const w=/^ERROR:[ \t]+([0-9]+):([0-9]+):/g;function b(t){const i=[];for(const e of t.split("\n")){w.lastIndex=-1;const t=w.exec(e);t&&i.push(parseInt(t[2],10))}return i}function E(t,i=!1){return`color:#fff;background:${t};font-family:monospace;font-size:80%;font-weight:${i?"bolder":"100"}`}function _(t,i,...e){console.log(`%c${t}`,"font-weight:bolder;font-size:120%"),i.split("\n").forEach(((t,i)=>{const s=i+1,r=(1e-4*s).toFixed(4).substring(2),n=e.includes(s)?"#f00":"#000";console.log(`%c${r}  %c${t}`,E(n),E(n,!0))}))}class A extends y{constructor(t){super(),this.gl=t}actualCreate(t){return new v(this.gl,t)}actualDelete(t){t instanceof v&&t.delete()}makeKeyFromInput(t){return JSON.stringify(t)}}var T=function(t,i,e,s){return new(e||(e=Promise))((function(r,n){function h(t){try{a(s.next(t))}catch(t){n(t)}}function o(t){try{a(s.throw(t))}catch(t){n(t)}}function a(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(h,o)}a((s=s.apply(t,i||[])).next())}))};class P{static image(t){return T(this,void 0,void 0,(function*(){return new Promise((i=>{const e=new Image;e.onload=()=>i(e),e.onerror=()=>{console.error("Unable to load image: ",t),i(null)},e.src=t}))}))}static canvas(t){return T(this,void 0,void 0,(function*(){const i=yield P.image(t);if(!i)return null;const e=document.createElement("canvas");e.width=i.naturalWidth,e.height=i.naturalHeight;const s=e.getContext("2d");if(!s)throw Error("Unable to get a 2D context!");return s.drawImage(i,0,0),e}))}}class U{constructor(){this.listeners=new Set}addListener(t){this.listeners.add(t)}removeListener(t){this.listeners.delete(t)}dispatch(t){this.listeners.forEach((i=>i(t)))}}const M=new Uint8Array([200,200,200,255]);class I{constructor(t,i,e={}){this.gl=t,this.refresh=i,this.eventImageUpdate=new U,this._width=0,this._height=0,this._image=null,this.options=Object.assign({wrapS:"REPEAT",wrapT:"REPEAT",wrapR:"REPEAT",minFilter:"NEAREST_MIPMAP_LINEAR",magFilter:"LINEAR"},e);const s=t.createTexture();if(!s)throw Error("Unable to create a WebGLTexture!");this.texture=s,t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,M);const{wrapS:r,wrapT:n,wrapR:h,minFilter:o,magFilter:a}=this.options;t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[r]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[n]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_R,t[h]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[o]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[a]),e.image&&this.loadImage(e.image)}delete(){this.gl.deleteTexture(this.texture)}get image(){return this._image}get width(){return this._width}get height(){return this._height}bind(){const{gl:t}=this;t.bindTexture(t.TEXTURE_2D,this.texture)}activate(t,i,e=0){const{gl:s,texture:r}=this;s.activeTexture(s.TEXTURE0+e),s.bindTexture(s.TEXTURE_2D,r),t.uniform1i(i,e)}loadImage(t){if("string"==typeof t)return void P.image(t).then((i=>{i?(this.loadImage(i),this.refresh()):console.error("[TgdTexture2D] Unable to load image:",t)})).catch(console.error);const{gl:i,texture:e}=this;i.bindTexture(i.TEXTURE_2D,e),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),i.generateMipmap(i.TEXTURE_2D),this._width=t.width,this._height=t.height,this._image=t,this.eventImageUpdate.dispatch(this)}}class z{constructor(t,i,e){this.gl=t,this.refresh=i,this._width=0,this._height=0,this.numberOfImagesToLoad=6;const s=t.createTexture();if(!s)throw Error("Unable to create a WebGLTexture!");this.texture=s,this.loadImage(t.TEXTURE_CUBE_MAP_POSITIVE_X,e.imagePosX),this.loadImage(t.TEXTURE_CUBE_MAP_NEGATIVE_X,e.imageNegX),this.loadImage(t.TEXTURE_CUBE_MAP_POSITIVE_Y,e.imagePosY),this.loadImage(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.imageNegY),this.loadImage(t.TEXTURE_CUBE_MAP_POSITIVE_Z,e.imagePosZ),this.loadImage(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,e.imageNegZ)}delete(){this.gl.deleteTexture(this.texture)}get ready(){return 0===this.numberOfImagesToLoad}get width(){return this._width}get height(){return this._height}bind(){const{gl:t}=this;t.bindTexture(t.TEXTURE_CUBE_MAP,this.texture)}activate(t,i,e=0){if(!this.ready)return;const{gl:s,texture:r}=this;s.activeTexture(s.TEXTURE0+e),s.bindTexture(s.TEXTURE_CUBE_MAP,r),t.uniform1i(i,e)}loadImage(t,i){if("string"==typeof i)return void P.image(i).then((e=>{e?this.loadImage(t,e):console.error(`[TgdTextureCube] Unable to load image "${i}":`,i)})).catch((t=>{console.error(`[TgdTextureCube] Unable to load image "${i}":`,t)}));const{width:e,height:s}=i;if(e!==s)throw Error(`Images in a CubeMap must be squares, but we got ${e}×${s}!`);if(0===this._width)this._width=e,this._height=s;else if(this._width!==e||this._height!==s)throw Error(`Images in a CubeMap must all have the same size, but we got ${this._width}×${this._height} and ${e}×${s}!`);const{gl:r,texture:n}=this;r.bindTexture(r.TEXTURE_CUBE_MAP,n),r.texImage2D(t,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i),this.numberOfImagesToLoad--,0===this.numberOfImagesToLoad&&(console.log("All images have been loaded!"),console.log(this.width,this.height),r.generateMipmap(r.TEXTURE_CUBE_MAP),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),this.refresh())}}class R extends y{constructor(t,i){super(),this.gl=t,this.refresh=i}actualCreate(t){return new I(this.gl,this.refresh,t)}actualDelete(t){t instanceof I&&t.delete()}makeKeyFromInput(t){return t}}class X extends y{constructor(t,i){super(),this.gl=t,this.refresh=i}actualCreate(t){return new z(this.gl,this.refresh,t)}actualDelete(t){t instanceof z&&t.delete()}makeKeyFromInput(t){return t}}class L{constructor(t,i,e){var s,r;this.gl=t;const n=t.createBuffer();if(!n)throw Error("Unable to create WebGLBuffer!");this._target=null!==(s=null==e?void 0:e.target)&&void 0!==s?s:"ARRAY_BUFFER",this._usage=null!==(r=null==e?void 0:e.usage)&&void 0!==r?r:"STATIC_DRAW",this.buffer=n,i&&this.bufferData(i,e)}get target(){return this._target}bind(t){const{gl:i,buffer:e}=this;this._target=null!=t?t:this._target,i.bindBuffer(i[this._target],e)}bufferData(t,i={}){var e;const{gl:s}=this;this.bind(i.target),this._usage=null!==(e=i.usage)&&void 0!==e?e:this._usage,s.bufferData(s[this._target],t,s[this._usage])}delete(){const{gl:t,buffer:i}=this;t.deleteBuffer(i)}}class Y{constructor(t,i,e,s){this.gl=t,this.drawBuffers=[],this.elemBuffer=null;const r=t.createVertexArray();if(!r)throw Error("Unable to create VertexArrayObject!");if(this.vao=r,i&&e){if(t.bindVertexArray(r),this.drawBuffers=e.map((e=>{const s=new L(t,e.dataView,{target:e.target,usage:e.usage});return s.bind(),e.defineAttributes(t,i),s})),s){const i=new L(t,s,{target:"ELEMENT_ARRAY_BUFFER"});i.bind(),this.elemBuffer=i}t.bindVertexArray(null)}}bind(){this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}delete(){const{gl:t,vao:i,drawBuffers:e,elemBuffer:s}=this;t.deleteVertexArray(i),e.forEach((t=>t.delete())),s&&s.delete()}}class D{constructor(t,i={}){var e;this.canvas=t,this.painters=new p,this.isPlaying=!1,this.requestAnimationFrame=-1,this.lastTime=-1,this.paint=()=>{window.cancelAnimationFrame(this.requestAnimationFrame),this.requestAnimationFrame=window.requestAnimationFrame(this.actualPaint)},this.actualPaint=t=>{const{lastTime:i}=this;if(i<0)return this.lastTime=t,void this.paint();const e=t-this.lastTime;this.lastTime=t,this.painters.paint(t,e),this.painters.update(t,e),this.isPlaying&&this.paint()};const s=t.getContext("webgl2",i);if(!s)throw Error("Unable to create a WebGL2 context!");this.gl=s,this.programs=new A(s),this.textures2D=new R(s,this.paint),this.texturesCube=new X(s,this.paint);const r=null!==(e=i.onResize)&&void 0!==e?e:N;this.observer=new ResizeObserver((()=>{r(s,t.clientWidth,t.clientHeight)})),this.observer.observe(t),t.style.touchAction="none"}get width(){return this.gl.drawingBufferWidth}get height(){return this.gl.drawingBufferHeight}get playing(){return this.isPlaying}set playing(t){t!==this.isPlaying&&(t&&this.paint(),this.isPlaying=t)}play(){this.playing=!0}pause(){this.playing=!1}add(...t){this.painters.add(...t)}remove(...t){this.painters.remove(...t)}createBuffer(t,i){return new L(this.gl,t,i)}createVAO(t,i,e){return new Y(this.gl,t,i,e)}destroy(){window.cancelAnimationFrame(this.requestAnimationFrame),this.playing=!1,this.painters.delete(),this.observer.unobserve(this.canvas)}}function N(t,i,e){const s=t.canvas;s.width=i,s.height=e,t.viewport(0,0,i,e)}class S{constructor(){this.keysDown=new Set,this.keysUp=new Set,this.attached=!1,this.handleKeyDown=t=>{this.keysDown.add(t.key),this.keysUp.delete(t.key)},this.handleKeyUp=t=>{this.keysDown.delete(t.key),this.keysUp.add(t.key)},document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),this.attached=!0}detach(){this.attached&&(document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.attached=!1)}isPressed(...t){for(const i of t)if(!this.keysDown.has(i))return!1;return!0}hasClicked(t){return!!this.keysUp.has(t)&&(this.keysUp.delete(t),!0)}}class j{constructor(t){var i;this.options=t,this.start={x:0,y:0,t:0},this.current={x:0,y:0,t:0},this.previous={x:0,y:0,t:0},this.canvas=null,this.active=!1,this.canvasX=0,this.canvasY=0,this.screenX=0,this.screenY=0,this.inertiaDirX=0,this.inertiaDirY=0,this.inertiaStop=!0,this.inertiaRunning=!1,this.inertiaTimeStamp=0,this.inertiaLastRefresh=0,this.handleCanvasWheel=t=>{const{onZoom:i}=this.options;i&&i(t.deltaY,(()=>t.preventDefault()))},this.handleCanvasPointerDown=t=>{t.isPrimary&&(t.preventDefault(),this.canvasX=t.clientX,this.canvasY=t.clientY,this.active=!0,this.inertiaStop=!0)},this.handlePointerDown=t=>{var i,e;if(!t.isPrimary||!this.active)return;t.preventDefault(),this.screenX=t.clientX,this.screenY=t.clientY;const s=this.getPoint(t);this.start=this.current=s,null===(e=(i=this.options).onMoveStart)||void 0===e||e.call(i,s)},this.handlePointerMove=t=>{var i,e;t.isPrimary&&this.active&&this.canvas&&(t.preventDefault(),this.previous=this.current,this.current=this.getPoint(t),null===(e=(i=this.options).onMove)||void 0===e||e.call(i,this))},this.handlePointerUp=t=>{var i,e;if(!t.isPrimary||!this.active)return;t.preventDefault(),this.current=this.getPoint(t),null===(e=(i=this.options).onMoveEnd)||void 0===e||e.call(i,this.current),this.active=!1,this.inertiaStop=!1,this.inertiaRunning=!1;const s=this.current.t-this.previous.t,r=s>0?1/s:0;this.inertiaDirX=r*(this.current.x-this.previous.x),this.inertiaDirY=r*(this.current.y-this.previous.y),window.requestAnimationFrame(this.simulateInertia)},this.simulateInertia=t=>{const{onMove:i}=this.options;if(!i||this.inertiaDuration<=0)return;if(this.inertiaStop)return;this.inertiaRunning||(this.inertiaTimeStamp=t,this.inertiaLastRefresh=t,this.inertiaRunning=!0);const e=t-this.inertiaTimeStamp,s=1-e/this.inertiaDuration;if(s<=0||s>1)return;const r=e-this.inertiaLastRefresh;this.inertiaLastRefresh=e;const n=this.inertiaDirX*r*s,h=this.inertiaDirY*r*s;this.previous=Object.assign({},this.current),this.current.t=this.previous.t+r,this.current.x+=n,this.current.y+=h;const{current:o,previous:a,start:c}=this;i({current:o,previous:a,start:c}),window.requestAnimationFrame(this.simulateInertia)},this.inertiaDuration=null!==(i=t.inertia)&&void 0!==i?i:0,t.canvas&&this.attach(t.canvas)}get element(){return this.canvas}attach(t){this.detach(),this.canvas=t,t.addEventListener("pointerdown",this.handleCanvasPointerDown,!0),t.addEventListener("wheel",this.handleCanvasWheel),document.addEventListener("pointerdown",this.handlePointerDown),document.addEventListener("pointermove",this.handlePointerMove),document.addEventListener("pointerup",this.handlePointerUp)}detach(){const{canvas:t}=this;t&&(t.removeEventListener("pointerdown",this.handleCanvasPointerDown),t.removeEventListener("wheel",this.handleCanvasWheel),document.removeEventListener("pointerdown",this.handlePointerDown),document.removeEventListener("pointermove",this.handlePointerMove),document.removeEventListener("pointerup",this.handlePointerUp),this.canvas=null)}getPoint(t){if(!this.canvas)throw Error("No canvas has been defined!");const{left:i,top:e,width:s,height:r}=this.canvas.getBoundingClientRect();return{x:2*((this.canvasX+t.clientX-this.screenX-i)/s-.5),y:-2*((this.canvasY+t.clientY-this.screenY-e)/r-.5),t:t.timeStamp}}}class Z{constructor(t,i={}){this.camera=t,this.pointer=null,this.keyboard=new S,this.handleMove=t=>{const{camera:i,keyboard:e}=this;if(t.current.t-t.previous.t<=0)return;if(e.isPressed("z")){const e=t.previous.x,s=t.previous.y;if(Math.abs(e)+Math.abs(s)===0)return;const r=t.current.x,n=t.current.y;if(Math.abs(r)+Math.abs(n)===0)return;const h=e*r+s*n,o=e*n-s*r,a=Math.atan2(o,h);return void i.orbitAroundZ(-a)}const s=2*(t.current.x-t.previous.x),r=2*(t.current.y-t.previous.y);e.isPressed("x")||i.orbitAroundY(-s),e.isPressed("y")||i.orbitAroundX(r)},this.handleZoom=(t,i)=>{const{camera:e}=this,s=.001*-t;e.zoom=Math.max(1,e.zoom+s),i()},this.options=Object.assign({inertia:500},i)}attach(t){this.pointer&&this.pointer.detach(),this.pointer=new j({canvas:t,onMove:this.handleMove,onZoom:this.handleZoom,inertia:this.options.inertia})}detach(){this.pointer&&(this.pointer.detach(),this.pointer=null)}}class F{constructor(t,i={}){var e,s,r;this.data=null,this.count=0,this.target=null!==(e=i.target)&&void 0!==e?e:"ARRAY_BUFFER",this.usage=null!==(s=i.usage)&&void 0!==s?s:"STATIC_DRAW";const n=null!==(r=i.divisor)&&void 0!==r?r:0;let h=0;const o={},a={};for(const i of Object.keys(t)){const e=i;o[i]=new ArrayBuffer(0);const s={dimension:V[t[e]],bytesOffset:h,bytesPerElement:Float32Array.BYTES_PER_ELEMENT,divisor:n,getter:(t,i)=>(i>=t.byteLength&&(i%=t.byteLength),t.getFloat32(i)),setter(t,i,e){t.setFloat32(i,e)}};a[i]=s,h+=s.bytesPerElement*s.dimension}this.dataPerAttribute=o,this.definitions=a,this.stride=h}set(t,i){var e;if((e=i)&&"object"==typeof e&&i.buffer instanceof ArrayBuffer&&(i=i.buffer),this.dataPerAttribute[t]===i)return;this.dataPerAttribute[t]=i;const{bytesPerElement:s,dimension:r}=this.definitions[t];this.count=Math.max(this.count,Math.ceil(i.byteLength/(s*r))),this.data=null}get dataView(){if(!this.data){const t=new ArrayBuffer(this.stride*this.count),i=new DataView(t);let e=0;const{dataPerAttribute:s,definitions:r}=this;for(let t=0;t<this.count;t++)for(const n of Object.keys(r)){const h=r[n],o=s[n],a=new DataView(o);let c=h.bytesPerElement*h.dimension*t;for(let t=0;t<h.dimension;t++)h.setter(i,e,h.getter(a,c)),c+=h.bytesPerElement,e+=h.bytesPerElement}this.data=new DataView(t)}return this.data}defineAttributes(t,i){let e=0;const{definitions:s}=this;for(const r of Object.keys(s)){const n=s[r],h=i.getAttribLocation(r);t.enableVertexAttribArray(h),t.vertexAttribPointer(h,n.dimension,t.FLOAT,!1,this.stride,e),t.vertexAttribDivisor(h,n.divisor),e+=n.dimension*n.bytesPerElement}}}const V={float:1,vec2:2,vec3:3,vec4:4};class k{}class C{constructor(t,i,{x:e=0,y:s=0,z:r=1,zoom:n=1}={}){this.context=t,this.zoom=1,this.x=0,this.y=0,this.z=1,this.x=e,this.y=s,this.z=r,this.zoom=n,this.texture=i,this.program=t.programs.create({vert:"#version 300 es\n\nuniform float uniZoom;\nuniform vec2 uniScale;\nuniform vec2 uniScroll;\nuniform float uniZ;\nin vec2 attPoint;\nin vec2 attUV;\nout vec2 varUV;\n\nvoid main() {\n    varUV = (attUV + uniScroll) * uniZoom;\n    float x = uniScale.x * attPoint.x;\n    float y = uniScale.y * attPoint.y;\n    gl_Position = vec4(x, y, uniZ, 1.0);\n}",frag:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D uniTexture;\nin vec2 varUV;\nout vec4 FragColor;\n\nvoid main() {\n    FragColor = texture(uniTexture, varUV);\n}"});const h=new F({attPoint:"vec2",attUV:"vec2"});h.set("attPoint",new Float32Array([-1,1,1,1,-1,-1,1,-1])),h.set("attUV",new Float32Array([0,0,1,0,0,1,1,1])),this.vao=t.createVAO(this.program,[h])}delete(){const{vao:t}=this;t.delete}paint(t,i){const{gl:e}=this.context,{vao:s,program:r,texture:n,zoom:h,x:o,y:a,z:c}=this;r.use();const{width:u,height:m}=this.context,l=n.width*m>n.height*u,d=l?n.width*m/(u*n.height):1,g=l?1:n.height*u/(m*n.width);r.uniform2f("uniScale",d,g),r.uniform2f("uniScroll",o,a),r.uniform1f("uniZoom",1/h),r.uniform1f("uniZ",c),n.activate(r,"uniTexture"),s.bind(),e.drawArrays(e.TRIANGLE_STRIP,0,4)}update(t,i){}}class B{constructor(t,i={}){var e,s;this.context=t,this.clearMask=0,this.red=1,this.green=.7,this.blue=0,this.alpha=1,this.depth=1;const{gl:r}=t,n=null!==(e=i.color)&&void 0!==e?e:[0,0,0,1],h=null!==(s=i.depth)&&void 0!==s?s:1;this.clearMask=0;let o=!1;if(i.color&&(this.clearMask|=r.COLOR_BUFFER_BIT,o=!0),"number"==typeof i.depth&&(this.clearMask|=r.DEPTH_BUFFER_BIT,o=!0),!o)throw Error("[TgdPainterClear] You must give at least a color or a depth in the constructor!");[this.red,this.green,this.blue,this.alpha]=n,this.depth=h}delete(){}paint(t,i){const{clearMask:e,context:s,red:r,green:n,blue:h,alpha:o,depth:a}=this,{gl:c}=s;c.clearColor(r,n,h,o),c.clearDepth(a),c.clear(e)}update(t,i){}}class O{constructor(t){this.logicFunction=t}delete(){}paint(t,i){}update(t,i){this.logicFunction(t,i)}}class W{constructor(t,i){this.context=t,this.matrix=new o,this.tmpMat=new o,this.camera=i.camera,this.texture=t.texturesCube.create(i),this.program=t.programs.create({vert:"#version 300 es\n\nin vec4 attPoint;\n\nout vec4 varPoint;\n\nvoid main() {\n    varPoint = attPoint;\n    gl_Position = vec4(attPoint.xy, 0.999, 1.0);\n}",frag:"#version 300 es\n\nprecision highp float;\n\nuniform samplerCube uniTexture;\nuniform mat4 uniMatrix;\n\nin vec4 varPoint;\n\nout vec4 FragColor;\n\nvoid main() {\n    vec4 t = uniMatrix * varPoint;\n    FragColor = texture(uniTexture, normalize(t.xyz / t.w));\n}"});const e=new F({attPoint:"vec2"});e.set("attPoint",new Float32Array([-1,1,1,1,-1,-1,1,-1])),this.vao=t.createVAO(this.program,[e])}delete(){const{vao:t}=this;t.delete}paint(t,i){const{gl:e}=this.context,{vao:s,program:r,texture:n}=this;e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),r.use(),r.uniformMatrix4fv("uniMatrix",this.matrix),n.activate(r,"uniTexture"),s.bind(),e.drawArrays(e.TRIANGLE_STRIP,0,4)}update(t,i){const{camera:e,matrix:s,tmpMat:r}=this;s.from(e.matrixProjection),r.fromMat3(e.matrixViewModel),r.m30=0,r.m31=0,r.m32=0,r.m33=1,r.m03=0,r.m13=0,r.m23=0,s.multiply(r).invert()}}class G{constructor(){this.name="Mesh",this.attPosition=[],this.attNormal=[],this.attUV=[],this.elements=[],this.elementIndex=0,this.vertices=[],this.normals=[],this.uvs=[],this.map=new Map,this.onObject=t=>{this.name=t},this.onVertex=(t,i,e)=>{this.vertices.push([t,i,e])},this.onNormal=(t,i,e)=>{this.normals.push([t,i,e])},this.onTexture=(t,i)=>{this.uvs.push([t,i])},this.onFace=t=>{if(3!==t.length)throw Error("We can only deal with triangles!");t.forEach((t=>this.elements.push(this.getElem(t))))}}parse(t){this.reset();const{onVertex:i,onNormal:e,onTexture:s,onFace:r,onObject:n,name:h,elements:o}=this;!function(t,i={}){const{onVertex:e,onNormal:s,onTexture:r,onFace:n,onObject:h}=i;for(const i of function*(t){const i=t.length;let e=0,s=0;for(;e>-1&&e<i&&(e=t.indexOf("\n",s),!(e<0));)yield t.substring(s,e).trim(),s=e+1;return t.substring(s).trim()}(t)){const t=i.trimStart();if(e&&t.startsWith("v ")){const i=t.substring(2).split(" ").map((t=>Number(t)));$(i)&&e(...i)}else if(n&&t.startsWith("f "))n(t.substring(2).split(" ").map((t=>{const[i,e,s]=t.split("/");return{vertex:Number(i)-1,normal:s?Number(s)-1:void 0,uv:e?Number(e)-1:void 0}})));else if(s&&t.startsWith("vn ")){const i=t.substring(3).split(" ").map((t=>Number(t)));$(i)&&s(...i)}else if(r&&t.startsWith("vt ")){const[i,e,s]=t.substring(3).split(" ").map((t=>Number(t)));r(i,e,s)}else h&&t.startsWith("o ")&&h(t.substring(2))}}(t,{onVertex:i,onNormal:e,onTexture:s,onFace:r,onObject:n});const a={name:h,count:Math.floor(o.length/3),attPosition:new Float32Array(this.attPosition)};this.attNormal.length>0&&(a.attNormal=new Float32Array(this.attNormal)),this.attUV.length>0&&(a.attUV=new Float32Array(this.attUV)),console.log("🚀 [wavefront] this.attUV = ",this.attUV);const{elementIndex:c}=this;return c<=256?(console.log("UNSIGNED_BYTE"),Object.assign(Object.assign({},a),{type:"UNSIGNED_BYTE",elements:new Uint8Array(o)})):c<=65536?(console.log("UNSIGNED_SHORT"),Object.assign(Object.assign({},a),{type:"UNSIGNED_SHORT",elements:new Uint16Array(o)})):(console.log("UNSIGNED_INT"),Object.assign(Object.assign({},a),{type:"UNSIGNED_INT",elements:new Uint32Array(o)}))}reset(){this.name="Mesh",this.attPosition=[],this.attNormal=[],this.attUV=[],this.elements=[],this.elementIndex=0,this.vertices=[],this.normals=[],this.uvs=[],this.map.clear()}getElem(t){var i;const e=this.key(t),s=null!==(i=this.map.get(e))&&void 0!==i?i:-1;if(s>-1)return s;const[r,n,h]=this.vertices[t.vertex];if(this.attPosition.push(r,n,h),"number"==typeof t.normal){const[i,e,s]=this.normals[t.normal];this.attNormal.push(i,e,s)}if("number"==typeof t.uv){const[i,e]=this.uvs[t.uv];this.attUV.push(i,e)}return this.map.set(e,this.elementIndex),this.elementIndex++}key(t){return`${t.vertex}/${t.normal}`}}function $(t){return 3===t.length}var q=r.OE,H=r.op,K=r._G,Q=r.ED,J=r.sT,tt=r.ck,it=r.Wk,et=r.cL,st=r.ML,rt=r.mI,nt=r.aW,ht=r.yo}}]);